(function(){var t,e,r,o,i,n,s,u,c,l=function(t,e){function r(){this.constructor=t}for(var o in e)h.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},h={}.hasOwnProperty;require("atom").Disposable,require("atom").BufferedProcess,c=require("atom-space-pen-views"),t=c.$,e=c.$$$,o=c.View,i=require("underscore-plus"),n=require("node-emoji"),s=require("../git"),r=require("../models/git-show"),u=function(){return atom.config.get("git-plus.logs.numberOfCommitsToShow")},module.exports=function(o){function c(){return c.__super__.constructor.apply(this,arguments)}return l(c,o),c.content=function(){return this.div({class:"git-plus-log",tabindex:-1},function(t){return function(){return t.table({id:"git-plus-commits",outlet:"commitsListView"}),t.div({class:"show-more"},function(){return t.a({id:"show-more"},"Show More")})}}(this))},c.prototype.getURI=function(){return"atom://git-plus:log"},c.prototype.getTitle=function(){return"git-plus: Log"},c.prototype.initialize=function(){var t;return this.skipCommits=0,this.finished=!1,t=i.debounce(function(t){return function(){if(t.prop("scrollHeight")-t.scrollTop()-t.height()<20)return t.getLog()}}(this),50),this.on("click",".commit-row",function(t){return function(e){var r;return r=e.currentTarget,t.showCommitLog(r.getAttribute("hash"))}}(this)),this.on("click","#show-more",t),this.scroll(t)},c.prototype.attached=function(){return this.commandSubscription=atom.commands.add(this.element,{"core:move-down":function(t){return function(){return t.selectNextResult()}}(this),"core:move-up":function(t){return function(){return t.selectPreviousResult()}}(this),"core:page-up":function(t){return function(){return t.selectPreviousResult(10)}}(this),"core:page-down":function(t){return function(){return t.selectNextResult(10)}}(this),"core:move-to-top":function(t){return function(){return t.selectFirstResult()}}(this),"core:move-to-bottom":function(t){return function(){return t.selectLastResult()}}(this),"core:confirm":function(t){return function(){var e;return e=t.find(".selected").attr("hash"),e&&t.showCommitLog(e),!1}}(this)})},c.prototype.detached=function(){return this.commandSubscription.dispose(),this.commandSubscription=null},c.prototype.parseData=function(t){var e,r,o;return t.length<1?void(this.finished=!0):(o=";|",r="_.;._",t=t.substring(0,t.length-r.length-1),e=t.split(r).map(function(t){var e;if(""!==t.trim())return e=t.trim().split(o),{hashShort:e[0],hash:e[1],author:e[2],email:e[3],message:e[4],date:e[5]}}),this.renderLog(e))},c.prototype.renderHeader=function(){var t;return t=e(function(){return this.tr({class:"commit-header"},function(t){return function(){return t.td("Date"),t.td("Message"),t.td({class:"hashShort"},"Short Hash")}}(this))}),this.commitsListView.append(t)},c.prototype.renderLog=function(t){return t.forEach(function(t){return function(e){return t.renderCommit(e)}}(this)),this.skipCommits+=u()},c.prototype.renderCommit=function(t){var r;return r=e(function(){return this.tr({class:"commit-row",hash:""+t.hash},function(e){return function(){return e.td({class:"date"},t.date+" by "+t.author),e.td({class:"message"},""+n.emojify(t.message)),e.td({class:"hashShort"},""+t.hashShort)}}(this))}),this.commitsListView.append(r)},c.prototype.showCommitLog=function(t){return r(this.repo,t,this.onlyCurrentFile?this.currentFile:void 0)},c.prototype.branchLog=function(t){return this.repo=t,this.skipCommits=0,this.commitsListView.empty(),this.onlyCurrentFile=!1,this.currentFile=null,this.renderHeader(),this.getLog()},c.prototype.currentFileLog=function(t,e){return this.repo=t,this.currentFile=e,this.onlyCurrentFile=!0,this.skipCommits=0,this.commitsListView.empty(),this.renderHeader(),this.getLog()},c.prototype.getLog=function(){var t;if(!this.finished)return t=["log","--pretty=%h;|%H;|%aN;|%aE;|%s;|%ai_.;._","-"+u(),"--skip="+this.skipCommits],this.onlyCurrentFile&&null!=this.currentFile&&t.push(this.currentFile),s.cmd(t,{cwd:this.repo.getWorkingDirectory()}).then(function(t){return function(e){return t.parseData(e)}}(this))},c.prototype.selectFirstResult=function(){return this.selectResult(this.find(".commit-row:first")),this.scrollToTop()},c.prototype.selectLastResult=function(){return this.selectResult(this.find(".commit-row:last")),this.scrollToBottom()},c.prototype.selectNextResult=function(t){var e,r;return null==t&&(t=1),r=this.find(".selected"),r.length<1?this.selectFirstResult():(e=this.getNextResult(r,t),this.selectResult(e),this.scrollTo(e))},c.prototype.selectPreviousResult=function(t){var e,r;return null==t&&(t=1),r=this.find(".selected"),r.length<1?this.selectFirstResult():(e=this.getPreviousResult(r,t),this.selectResult(e),this.scrollTo(e))},c.prototype.getNextResult=function(e,r){var o,i;if(null!=e?e.length:void 0)return i=this.find(".commit-row"),o=i.index(e),t(i[Math.min(o+r,i.length-1)])},c.prototype.getPreviousResult=function(e,r){var o,i;if(null!=e?e.length:void 0)return i=this.find(".commit-row"),o=i.index(e),t(i[Math.max(o-r,0)])},c.prototype.selectResult=function(t){if(null!=t?t.length:void 0)return this.find(".selected").removeClass("selected"),t.addClass("selected")},c.prototype.scrollTo=function(t){var e,r;if(null!=t?t.length:void 0)return r=this.scrollTop()+t.offset().top-this.offset().top,e=r+t.outerHeight(),e>this.scrollBottom()&&this.scrollBottom(e),r<this.scrollTop()?this.scrollTop(r):void 0},c}(o)}).call(this);