(function() {
  var _, exec, link, mergeObject, mutateSelectedText, pathToFunctionsFile, shell, url;

  pathToFunctionsFile = "./functions";

  global.functions = require(pathToFunctionsFile);

  Object.defineProperty(global, 'functions', {
    get: function() {
      delete require.cache[require.resolve(pathToFunctionsFile)];
      return require(pathToFunctionsFile);
    }
  });

  atom.workspace.observeTextEditors(function(editor) {
    return editor.onDidSave(function() {
      return functions.onSave(editor);
    });
  });

  url = require('url');

  shell = require('electron').shell;

  _ = require('underscore-plus');

  link = require('link');

  exec = require('child_process').exec;

  global.activeEditor = function() {
    return atom.workspace.getActiveTextEditor();
  };

  global.exec = exec;

  mergeObject = function(obj, source) {
    var key, value;
    if (obj == null) {
      obj = {};
    }
    if (source == null) {
      source = {};
    }
    if (source && Object.getOwnPropertyNames(source).length > 0) {
      for (key in source) {
        value = source[key];
        obj[key] = value;
      }
    }
    return obj;
  };

  mutateSelectedText = function(selections, options) {
    var i, insertText, len, results, selectedText, selection;
    if (options == null) {
      options = {};
    }
    options = mergeObject({
      select: true,
      skip: false,
      undo: ''
    }, options);
    results = [];
    for (i = 0, len = selections.length; i < len; i++) {
      selection = selections[i];
      insertText = "/*{{replacement}}*/";
      selectedText = selection.getText();
      insertText = insertText.replace("{{replacement}}", "" + selectedText);
      selection.retainSelection = true;
      selection.plantTail();
      selection.insertText(insertText, options);
      results.push(selection.retainSelection = false);
    }
    return results;
  };

  atom.workspace.observeActiveTextEditor(function() {
    var editor;
    return editor = activeEditor();
  });

  atom.commands.add("atom-text-editor", "nerd:wrap-inline-comment", function() {
    var editor, options, selections;
    options = {
      select: true,
      undo: 'skip',
      skip: true
    };
    editor = atom.workspace.getActiveTextEditor();
    selections = editor.getSelections();
    if (selections && selections.length > 0) {
      return mutateSelectedText(selections, options);
    }
  });

  atom.commands.add('atom-text-editor', 'nerd:bio-link', function() {
    var clipboardText, editor, selectedText, snippets, snippetsService;
    editor = atom.workspace.getActiveTextEditor();
    clipboardText = '';
    selectedText = '';
    if (editor.getSelectedText()) {
      selectedText = editor.getSelectedText();
    }
    if (atom.clipboard.read()) {
      clipboardText = atom.clipboard.read();
    }
    if (!selectedText || !clipboardText) {
      return;
    }
    snippets = atom.packages.getActivePackage('snippets');
    if (snippets) {
      snippetsService = snippets.mainModule;
      return snippetsService.insert("<a href=\"" + clipboardText + "\"${1: ${2:title=\"${3:" + selectedText + "}\"}}>${4:" + selectedText + "}</a>$0");
    }
  });

  atom.commands.add('atom-text-editor', 'nerd:link-open', function() {
    var editor, protocol, selectedText;
    editor = atom.workspace.getActiveTextEditor();
    selectedText = editor.getSelectedText();
    if (selectedText) {
      protocol = url.parse(selectedText).protocol;
      if (protocol === 'http:' || protocol === 'https:') {
        return shell.openExternal(selectedText);
      } else {
        return shell.openExternal("http://" + selectedText);
      }
    } else {
      return link.openLink();
    }
  });

  atom.commands.add('atom-text-editor', 'nerd:select-outside-bracket', function() {
    var editor;
    editor = atom.workspace.getActiveTextEditor();
    atom.commands.dispatch(atom.views.getView(editor), "bracket-matcher:select-inside-brackets");
    atom.commands.dispatch(atom.views.getView(editor), "core:move-right");
    return atom.commands.dispatch(atom.views.getView(editor), "bracket-matcher:select-inside-brackets");
  });

  atom.commands.add('atom-text-editor', 'nerd:select-line', function() {
    var editor;
    editor = atom.workspace.getActiveTextEditor();
    atom.commands.dispatch(atom.views.getView(editor), "editor:move-to-end-of-line");
    atom.commands.dispatch(atom.views.getView(editor), "editor:select-to-beginning-of-line");
    return atom.commands.dispatch(atom.views.getView(editor), "editor:select-to-first-character-of-line");
  });

  atom.commands.add('atom-text-editor', 'nerd:select-line-copy', function() {
    var editor;
    editor = atom.workspace.getActiveTextEditor();
    atom.commands.dispatch(atom.views.getView(editor), "editor:move-to-end-of-line");
    atom.commands.dispatch(atom.views.getView(editor), "editor:select-to-beginning-of-line");
    atom.commands.dispatch(atom.views.getView(editor), "editor:select-to-first-character-of-line");
    return atom.commands.dispatch(atom.views.getView(editor), "core:copy");
  });

  atom.commands.add('atom-text-editor', 'nerd:reveal-in-finder', function() {
    var editor, filepath, treeView, treeViewService;
    editor = atom.workspace.getActiveTextEditor();
    filepath = editor.getPath();
    if (filepath) {
      treeView = atom.packages.getActivePackage("tree-view");
      if (treeView) {
        treeViewService = treeView.mainModule;
        return treeViewService.treeView.showCurrentFileInFileManager();
      }
    }
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL1VzZXJzL3N1ZHByYXdhdC8uYXRvbS9pbml0LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQTtBQUFBLE1BQUE7O0VBQUEsbUJBQUEsR0FBc0I7O0VBRXRCLE1BQU0sQ0FBQyxTQUFQLEdBQW1CLE9BQUEsQ0FBUSxtQkFBUjs7RUFFbkIsTUFBTSxDQUFDLGNBQVAsQ0FBc0IsTUFBdEIsRUFBOEIsV0FBOUIsRUFBMkM7SUFBQSxHQUFBLEVBQUssU0FBQTtNQUM5QyxPQUFPLE9BQU8sQ0FBQyxLQUFNLENBQUEsT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsbUJBQWhCLENBQUE7YUFDckIsT0FBQSxDQUFRLG1CQUFSO0lBRjhDLENBQUw7R0FBM0M7O0VBSUEsSUFBSSxDQUFDLFNBQVMsQ0FBQyxrQkFBZixDQUFrQyxTQUFDLE1BQUQ7V0FDaEMsTUFBTSxDQUFDLFNBQVAsQ0FBaUIsU0FBQTthQUNmLFNBQVMsQ0FBQyxNQUFWLENBQWlCLE1BQWpCO0lBRGUsQ0FBakI7RUFEZ0MsQ0FBbEM7O0VBS0EsR0FBQSxHQUFNLE9BQUEsQ0FBUSxLQUFSOztFQUNMLFFBQVMsT0FBQSxDQUFRLFVBQVI7O0VBQ1YsQ0FBQSxHQUFJLE9BQUEsQ0FBUSxpQkFBUjs7RUFDSixJQUFBLEdBQU8sT0FBQSxDQUFRLE1BQVI7O0VBQ04sT0FBUSxPQUFBLENBQVEsZUFBUjs7RUFJVCxNQUFNLENBQUMsWUFBUCxHQUFzQixTQUFBO0FBQ3BCLFdBQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxtQkFBZixDQUFBO0VBRGE7O0VBR3RCLE1BQU0sQ0FBQyxJQUFQLEdBQWM7O0VBZ0JkLFdBQUEsR0FBYyxTQUFDLEdBQUQsRUFBVyxNQUFYO0FBQ1osUUFBQTs7TUFEYSxNQUFNOzs7TUFBSSxTQUFTOztJQUNoQyxJQUFHLE1BQUEsSUFBVSxNQUFNLENBQUMsbUJBQVAsQ0FBMkIsTUFBM0IsQ0FBa0MsQ0FBQyxNQUFuQyxHQUE0QyxDQUF6RDtB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QUF2SkEiLCJzb3VyY2VzQ29udGVudCI6WyIjIH4vLmF0b20vaW5pdC5jb2ZmZWVcblxucGF0aFRvRnVuY3Rpb25zRmlsZSA9IFwiLi9mdW5jdGlvbnNcIlxuXG5nbG9iYWwuZnVuY3Rpb25zID0gcmVxdWlyZShwYXRoVG9GdW5jdGlvbnNGaWxlKVxuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkgZ2xvYmFsLCAnZnVuY3Rpb25zJywgZ2V0OiAtPlxuICBkZWxldGUgcmVxdWlyZS5jYWNoZVtyZXF1aXJlLnJlc29sdmUocGF0aFRvRnVuY3Rpb25zRmlsZSldXG4gIHJlcXVpcmUocGF0aFRvRnVuY3Rpb25zRmlsZSlcblxuYXRvbS53b3Jrc3BhY2Uub2JzZXJ2ZVRleHRFZGl0b3JzIChlZGl0b3IpIC0+XG4gIGVkaXRvci5vbkRpZFNhdmUgLT5cbiAgICBmdW5jdGlvbnMub25TYXZlKGVkaXRvcilcblxuXG51cmwgPSByZXF1aXJlKCd1cmwnKVxue3NoZWxsfSA9IHJlcXVpcmUoJ2VsZWN0cm9uJylcbl8gPSByZXF1aXJlKCd1bmRlcnNjb3JlLXBsdXMnKVxubGluayA9IHJlcXVpcmUgJ2xpbmsnXG57ZXhlY30gPSByZXF1aXJlICdjaGlsZF9wcm9jZXNzJ1xuIyBsaW5rID0gcmVxdWlyZSAnLi9wYWNrYWdlcy9saW5rL2xpYi9saW5rLmpzJ1xuXG5cbmdsb2JhbC5hY3RpdmVFZGl0b3IgPSAoKSAtPlxuICByZXR1cm4gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpXG5cbmdsb2JhbC5leGVjID0gZXhlY1xuXG5cbiMgYWRkRXZlbnRMaXN0ZW5lcignZmV0Y2gnLCBldmVudCA9PiB7XG4jICAgZXZlbnQucmVzcG9uZFdpdGgoaGFuZGxlUmVxdWVzdChldmVudC5yZXF1ZXN0KSlcbiMgfSlcbiNcbiMgIyBSZXNwb25kIHRvIHRoZSByZXF1ZXN0XG4jICMgQHBhcmFtIHtSZXF1ZXN0fSByZXF1ZXN0XG4jIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlcXVlc3QocmVxdWVzdCkge1xuIyAgIHJldHVybiBuZXcgUmVzcG9uc2UoJ2hlbGxvIHdvcmxkJywge1xuIyAgICAgc3RhdHVzOiAyMDAsXG4jICAgfSlcbiMgfVxuXG5cbm1lcmdlT2JqZWN0ID0gKG9iaiA9IHt9LCBzb3VyY2UgPSB7fSkgLT5cbiAgaWYgc291cmNlICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHNvdXJjZSkubGVuZ3RoID4gMFxuICAgIGZvciBrZXksIHZhbHVlIG9mIHNvdXJjZVxuICAgICAgb2JqW2tleV0gPSB2YWx1ZVxuXG4gIHJldHVybiBvYmpcblxuXG5tdXRhdGVTZWxlY3RlZFRleHQgPSAoc2VsZWN0aW9ucywgb3B0aW9ucyA9IHt9KSAtPlxuICBvcHRpb25zID0gbWVyZ2VPYmplY3Qoe1xuICAgIHNlbGVjdDogdHJ1ZSxcbiAgICBza2lwOiBmYWxzZSxcbiAgICB1bmRvOiAnJyxcbiAgfSwgb3B0aW9ucylcblxuICBmb3Igc2VsZWN0aW9uIGluIHNlbGVjdGlvbnNcbiAgICBpbnNlcnRUZXh0ID0gXCIvKnt7cmVwbGFjZW1lbnR9fSovXCJcbiAgICBzZWxlY3RlZFRleHQgPSBzZWxlY3Rpb24uZ2V0VGV4dCgpXG4gICAgaW5zZXJ0VGV4dCA9IGluc2VydFRleHQucmVwbGFjZShcInt7cmVwbGFjZW1lbnR9fVwiLCBcIiN7c2VsZWN0ZWRUZXh0fVwiKVxuXG4gICAgc2VsZWN0aW9uLnJldGFpblNlbGVjdGlvbiA9IHRydWVcbiAgICBzZWxlY3Rpb24ucGxhbnRUYWlsKClcbiAgICBzZWxlY3Rpb24uaW5zZXJ0VGV4dChpbnNlcnRUZXh0LCBvcHRpb25zKVxuICAgIHNlbGVjdGlvbi5yZXRhaW5TZWxlY3Rpb24gPSBmYWxzZVxuXG5cbiMjIEN1c3RvbSBDb21tYW5kc1xuXG4jXG5hdG9tLndvcmtzcGFjZS5vYnNlcnZlQWN0aXZlVGV4dEVkaXRvciAtPlxuICBlZGl0b3IgPSBhY3RpdmVFZGl0b3IoKVxuICAjIGZ1bmN0aW9ucy5vblNhdmUoZWRpdG9yKVxuXG5cbiMgQ29tbWVudCB3cmFwIHdpdGggLyogLi4uICovXG5hdG9tLmNvbW1hbmRzLmFkZCBcImF0b20tdGV4dC1lZGl0b3JcIiwgXCJuZXJkOndyYXAtaW5saW5lLWNvbW1lbnRcIiwgLT5cbiAgIyBlZGl0b3IuYXV0b0luZGVudFNlbGVjdGVkUm93cygpXG5cbiAgb3B0aW9ucyA9IHtcbiAgICBzZWxlY3Q6IHRydWUsXG4gICAgdW5kbzogJ3NraXAnLFxuICAgIHNraXA6IHRydWUsXG4gIH1cbiAgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpXG4gIHNlbGVjdGlvbnMgPSBlZGl0b3IuZ2V0U2VsZWN0aW9ucygpXG4gICMgY29uc29sZS5sb2cgc2VsZWN0aW9uc1xuICBpZiBzZWxlY3Rpb25zICYmIHNlbGVjdGlvbnMubGVuZ3RoID4gMFxuICAgIG11dGF0ZVNlbGVjdGVkVGV4dChzZWxlY3Rpb25zLCBvcHRpb25zKVxuXG5cbiNcbmF0b20uY29tbWFuZHMuYWRkICdhdG9tLXRleHQtZWRpdG9yJywgJ25lcmQ6YmlvLWxpbmsnLCAtPlxuICBlZGl0b3IgPSBhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKClcbiAgY2xpcGJvYXJkVGV4dCA9ICcnXG4gIHNlbGVjdGVkVGV4dCA9ICcnXG4gIGlmIGVkaXRvci5nZXRTZWxlY3RlZFRleHQoKVxuICAgIHNlbGVjdGVkVGV4dCA9IGVkaXRvci5nZXRTZWxlY3RlZFRleHQoKVxuXG4gIGlmIGF0b20uY2xpcGJvYXJkLnJlYWQoKVxuICAgIGNsaXBib2FyZFRleHQgPSBhdG9tLmNsaXBib2FyZC5yZWFkKClcblxuICBpZiAhc2VsZWN0ZWRUZXh0IHx8ICFjbGlwYm9hcmRUZXh0XG4gICAgcmV0dXJuXG5cbiAgc25pcHBldHMgPSBhdG9tLnBhY2thZ2VzLmdldEFjdGl2ZVBhY2thZ2UoJ3NuaXBwZXRzJylcbiAgaWYgKHNuaXBwZXRzKVxuICAgIHNuaXBwZXRzU2VydmljZSA9IHNuaXBwZXRzLm1haW5Nb2R1bGVcbiAgICBzbmlwcGV0c1NlcnZpY2UuaW5zZXJ0IFwiPGEgaHJlZj1cXFwiI3tjbGlwYm9hcmRUZXh0fVxcXCIkezE6ICR7Mjp0aXRsZT1cXFwiJHszOiN7c2VsZWN0ZWRUZXh0fX1cXFwifX0+JHs0OiN7c2VsZWN0ZWRUZXh0fX08L2E+JDBcIlxuICAjIGF0b20ucGFja2FnZXMuYWN0aXZlUGFja2FnZXMuc25pcHBldHM/Lm1haW5Nb2R1bGU/Lmluc2VydCBcIjxhIGhyZWY9XFxcIiN7Y2xpcGJvYXJkVGV4dH1cXFwiIHRpdGxlPVxcXCIkezE6I3tzZWxlY3RlZFRleHR9fVxcXCI+JHsyOiN7c2VsZWN0ZWRUZXh0fX08L2E+JDBcIlxuXG5cbiMgT3BlbiBsaW5rXG5hdG9tLmNvbW1hbmRzLmFkZCAnYXRvbS10ZXh0LWVkaXRvcicsICduZXJkOmxpbmstb3BlbicsIC0+XG4gIGVkaXRvciA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKVxuICBzZWxlY3RlZFRleHQgPSBlZGl0b3IuZ2V0U2VsZWN0ZWRUZXh0KClcbiAgaWYgc2VsZWN0ZWRUZXh0XG4gICAge3Byb3RvY29sfSA9IHVybC5wYXJzZShzZWxlY3RlZFRleHQpXG4gICAgaWYgcHJvdG9jb2wgPT0gJ2h0dHA6JyB8fCBwcm90b2NvbCA9PSAnaHR0cHM6J1xuICAgICAgc2hlbGwub3BlbkV4dGVybmFsKHNlbGVjdGVkVGV4dClcbiAgICBlbHNlXG4gICAgICBzaGVsbC5vcGVuRXh0ZXJuYWwoXCJodHRwOi8vI3tzZWxlY3RlZFRleHR9XCIpXG4gIGVsc2VcbiAgICBsaW5rLm9wZW5MaW5rKClcblxuXG4jIHNzc1xuYXRvbS5jb21tYW5kcy5hZGQgJ2F0b20tdGV4dC1lZGl0b3InLCAnbmVyZDpzZWxlY3Qtb3V0c2lkZS1icmFja2V0JywgLT5cbiAgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpXG4gIGF0b20uY29tbWFuZHMuZGlzcGF0Y2goYXRvbS52aWV3cy5nZXRWaWV3KGVkaXRvciksIFwiYnJhY2tldC1tYXRjaGVyOnNlbGVjdC1pbnNpZGUtYnJhY2tldHNcIilcbiAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChhdG9tLnZpZXdzLmdldFZpZXcoZWRpdG9yKSwgXCJjb3JlOm1vdmUtcmlnaHRcIilcbiAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChhdG9tLnZpZXdzLmdldFZpZXcoZWRpdG9yKSwgXCJicmFja2V0LW1hdGNoZXI6c2VsZWN0LWluc2lkZS1icmFja2V0c1wiKVxuXG5cbiMgc3NzXG5hdG9tLmNvbW1hbmRzLmFkZCAnYXRvbS10ZXh0LWVkaXRvcicsICduZXJkOnNlbGVjdC1saW5lJywgLT5cbiAgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpXG4gIGF0b20uY29tbWFuZHMuZGlzcGF0Y2goYXRvbS52aWV3cy5nZXRWaWV3KGVkaXRvciksIFwiZWRpdG9yOm1vdmUtdG8tZW5kLW9mLWxpbmVcIilcbiAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChhdG9tLnZpZXdzLmdldFZpZXcoZWRpdG9yKSwgXCJlZGl0b3I6c2VsZWN0LXRvLWJlZ2lubmluZy1vZi1saW5lXCIpXG4gICMgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChhdG9tLnZpZXdzLmdldFZpZXcoZWRpdG9yKSwgXCJjb3JlOnNlbGVjdC1sZWZ0XCIpXG4gIGF0b20uY29tbWFuZHMuZGlzcGF0Y2goYXRvbS52aWV3cy5nZXRWaWV3KGVkaXRvciksIFwiZWRpdG9yOnNlbGVjdC10by1maXJzdC1jaGFyYWN0ZXItb2YtbGluZVwiKVxuXG5hdG9tLmNvbW1hbmRzLmFkZCAnYXRvbS10ZXh0LWVkaXRvcicsICduZXJkOnNlbGVjdC1saW5lLWNvcHknLCAtPlxuICBlZGl0b3IgPSBhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKClcbiAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChhdG9tLnZpZXdzLmdldFZpZXcoZWRpdG9yKSwgXCJlZGl0b3I6bW92ZS10by1lbmQtb2YtbGluZVwiKVxuICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGF0b20udmlld3MuZ2V0VmlldyhlZGl0b3IpLCBcImVkaXRvcjpzZWxlY3QtdG8tYmVnaW5uaW5nLW9mLWxpbmVcIilcbiAgIyBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGF0b20udmlld3MuZ2V0VmlldyhlZGl0b3IpLCBcImNvcmU6c2VsZWN0LWxlZnRcIilcbiAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChhdG9tLnZpZXdzLmdldFZpZXcoZWRpdG9yKSwgXCJlZGl0b3I6c2VsZWN0LXRvLWZpcnN0LWNoYXJhY3Rlci1vZi1saW5lXCIpXG4gIGF0b20uY29tbWFuZHMuZGlzcGF0Y2goYXRvbS52aWV3cy5nZXRWaWV3KGVkaXRvciksIFwiY29yZTpjb3B5XCIpXG5cblxuIyBSZXZlYWwgYWN0aXZlIGZpbGUgaW4gRmluZGVyXG5hdG9tLmNvbW1hbmRzLmFkZCAnYXRvbS10ZXh0LWVkaXRvcicsICduZXJkOnJldmVhbC1pbi1maW5kZXInLCAtPlxuICBlZGl0b3IgPSBhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKClcbiAgZmlsZXBhdGggPSBlZGl0b3IuZ2V0UGF0aCgpXG4gIGlmIGZpbGVwYXRoXG4gICAgdHJlZVZpZXcgPSBhdG9tLnBhY2thZ2VzLmdldEFjdGl2ZVBhY2thZ2UoXCJ0cmVlLXZpZXdcIilcbiAgICBpZiB0cmVlVmlld1xuICAgICAgdHJlZVZpZXdTZXJ2aWNlID0gdHJlZVZpZXcubWFpbk1vZHVsZVxuICAgICAgdHJlZVZpZXdTZXJ2aWNlLnRyZWVWaWV3LnNob3dDdXJyZW50RmlsZUluRmlsZU1hbmFnZXIoKVxuXG4gICAgIyBleGVjIFwibHMgXFxcIiN7ZmlsZXBhdGh9XFxcIiAyPi9kZXYvbnVsbFwiLCAoZXJyb3IsIHN0ZG91dCwgc3RkZXJyKSA9PlxuICAgICMgICBpZiBlcnJvclxuICAgICMgICAgIGVycm9yID0gZXJyb3IudG9TdHJpbmcoKS5yZXBsYWNlKFwiRXJyb3I6IFwiLCBcIlwiKVxuICAgICMgICAgIGNvbnNvbGUuZXJyb3IgXCJleGVjIGVycm9yOiAje2Vycm9yfVwiXG4gICAgIyAgIGVsc2VcbiAgICAjICAgICB0cmVlVmlldyA9IGF0b20ucGFja2FnZXMuZ2V0QWN0aXZlUGFja2FnZShcInRyZWUtdmlld1wiKVxuICAgICMgICAgIGlmIHRyZWVWaWV3XG4gICAgIyAgICAgICB0cmVlVmlld1NlcnZpY2UgPSB0cmVlVmlldy5tYWluTW9kdWxlXG4gICAgIyAgICAgICB0cmVlVmlld1NlcnZpY2UudHJlZVZpZXcuc2hvd0N1cnJlbnRGaWxlSW5GaWxlTWFuYWdlcigpXG5cblxuIyBJbiBpbml0LmNvZmZlZVxuIyBhdG9tLnBhY2thZ2VzLm9uRGlkQWN0aXZhdGVJbml0aWFsUGFja2FnZXMoKCkgPT4ge1xuIyAgIGNvbnN0IGdpdFBsdXMgPSBhdG9tLnBhY2thZ2VzLmdldEFjdGl2ZVBhY2thZ2UoJ2dpdC1wbHVzJylcbiMgICBpZiAoZ2l0UGx1cykge1xuIyAgICAgY29uc3QgZ3AgPSBnaXRQbHVzLm1haW5Nb2R1bGUucHJvdmlkZVNlcnZpY2UoKVxuIyAgICAgLy8gY29tbWFuZHMgZ28gaGVyZSwgc2VlIGJlbG93XG4jICAgfVxuIyB9KVxuXG4jIGF0b20ucGFja2FnZXMub25EaWRBY3RpdmF0ZUluaXRpYWxQYWNrYWdlcyAoKSAtPlxuIyBpZiBnaXRQbHVzID0gYXRvbS5wYWNrYWdlcy5nZXRBY3RpdmVQYWNrYWdlKCdnaXQtcGx1cycpPy5tYWluTW9kdWxlLnByb3ZpZGVTZXJ2aWNlKClcbiMgICBnaXRQbHVzLnJlZ2lzdGVyQ29tbWFuZCAnYXRvbS10ZXh0LWVkaXRvcicsICdjdXN0b20tZ2l0LWNvbW1hbmRzOnVuZG8tbGFzdC1jb21taXQnLCAtPlxuIyAgICAgZ2l0UGx1cy5nZXRSZXBvKCkgIyBJZiB0aGVyZSBhcmUgbXVsdGlwbGUgcmVwb3MgaW4gdGhlIHByb2plY3QsIHlvdSB3aWxsIGJlIHByb21wdGVkIHRvIHNlbGVjdCB3aGljaCB0byB1c2VcbiMgICAgIC50aGVuIChyZXBvKSAtPiBnaXRQbHVzLnJ1biByZXBvLCAncmVzZXQgSEVBRH4xJ1xuI1xuIyAgICAgZ2l0UGx1cy5yZWdpc3RlckNvbW1hbmQgJ2F0b20tdGV4dC1lZGl0b3InLCAnYWtvbndpOnVuc3RhZ2UtbGFzdC1jb21taXQnLCAtPlxuIyAgICAgICBnaXRQbHVzLmdldFJlcG8oKSAjIElmIHRoZXJlIGFyZSBtdWx0aXBsZSByZXBvcyBpbiB0aGUgcHJvamVjdCwgeW91IHdpbGwgYmUgcHJvbXB0ZWQgdG8gc2VsZWN0IHdoaWNoIHRvIHVzZVxuIyAgICAgICAudGhlbiAocmVwbykgLT4gZ2l0UGx1cy5ydW4gcmVwbywgJ3Jlc2V0IEhFQUR+MSdcbiNcbiMgICAgIGdpdFBsdXMucmVnaXN0ZXJDb21tYW5kICdhdG9tLXRleHQtZWRpdG9yJywgJ2Frb253aTp1cGRhdGUtbGFzdC1jb21taXQnLCAtPlxuIyAgICAgICBnaXRQbHVzLmdldFJlcG8oKSAjIElmIHRoZXJlIGFyZSBtdWx0aXBsZSByZXBvcyBpbiB0aGUgcHJvamVjdCwgeW91IHdpbGwgYmUgcHJvbXB0ZWQgdG8gc2VsZWN0IHdoaWNoIHRvIHVzZVxuIyAgICAgICAudGhlbiAocmVwbykgLT4gZ2l0UGx1cy5ydW4gcmVwbywgJ2NvbW1pdCAtLWFsbCAtLWFtZW5kIC0tbm8tZWRpdCdcbiNcbiMgICAgIGdpdFBsdXMucmVnaXN0ZXJDb21tYW5kICdhdG9tLXRleHQtZWRpdG9yJywgJ2Frb253aTp1c2UtdGhlLWZvcmNlJywgLT5cbiMgICAgICAgZ2l0UGx1cy5nZXRSZXBvKCkgIyBJZiB0aGVyZSBhcmUgbXVsdGlwbGUgcmVwb3MgaW4gdGhlIHByb2plY3QsIHlvdSB3aWxsIGJlIHByb21wdGVkIHRvIHNlbGVjdCB3aGljaCB0byB1c2VcbiMgICAgICAgLnRoZW4gKHJlcG8pIC0+IGdpdFBsdXMucnVuIHJlcG8sICdwdXNoIC0tZm9yY2Utd2l0aC1sZWFzZSdcblxuXG5cbiMgd3JhcEJsb2NrID0gKCkgLT5cbiMgICBlZGl0b3IgPSBhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKClcbiMgICByYW5nZXNUb1dyYXAgPSBlZGl0b3IuZ2V0U2VsZWN0ZWRCdWZmZXJSYW5nZXMoKS5maWx0ZXIoKHIpIC0+ICFyLmlzRW1wdHkoKSlcbiMgICBpZiByYW5nZXNUb1dyYXAubGVuZ3RoXG4jICAgICByYW5nZXNUb1dyYXAuc29ydCgoYSwgYikgLT5cbiMgICAgICAgcmV0dXJuIGlmIGEuc3RhcnQucm93ID4gYi5zdGFydC5yb3cgdGhlbiAtMSBlbHNlIDFcbiMgICAgICkuZm9yRWFjaCgocmFuZ2UpIC0+XG4jICAgICAgIHRleHQgPSBlZGl0b3IuZ2V0VGV4dEluQnVmZmVyUmFuZ2UocmFuZ2UpXG4jICAgICAgIGlmICgvXlxccypcXHtcXHMqLy50ZXN0KHRleHQpICYmIC9cXHMqXFx9XFxzKi8udGVzdCh0ZXh0KSlcbiMgICAgICAgICAjIHVud3JhcCBlYWNoIHNlbGVjdGlvbiBmcm9tIGl0cyBibG9ja1xuIyAgICAgICAgIGVkaXRvci5zZXRUZXh0SW5CdWZmZXJSYW5nZShyYW5nZSwgdGV4dC5yZXBsYWNlKC9cXHtcXHMqLywgJycpLnJlcGxhY2UoL1xccypcXH0vLCAnJykpXG4jICAgICAgIGVsc2VcbiMgICAgICAgICAjIHdyYXAgZWFjaCBzZWxlY3Rpb24gaW4gYSBibG9ja1xuIyAgICAgICAgIGVkaXRvci5zZXRUZXh0SW5CdWZmZXJSYW5nZShyYW5nZSwgJ3tcXG4nICsgdGV4dCArICdcXG59JylcbiMgICAgIClcbiMgICAgIGVkaXRvci5hdXRvSW5kZW50U2VsZWN0ZWRSb3dzKClcbiMgICBlbHNlXG4jICAgICAjIGNyZWF0ZSBhbiBlbXB0eSBibG9jayBhdCBlYWNoIGN1cnNvclxuIyAgICAgZWRpdG9yLmluc2VydFRleHQoJ3tcXG5cXG59JylcbiMgICAgIGVkaXRvci5zZWxlY3RVcCgyKVxuIyAgICAgZWRpdG9yLmF1dG9JbmRlbnRTZWxlY3RlZFJvd3MoKVxuIyAgICAgZWRpdG9yLm1vdmVSaWdodCgpXG4jICAgICBlZGl0b3IubW92ZVVwKClcbiMgICAgIGVkaXRvci5tb3ZlVG9FbmRPZkxpbmUoKVxuIl19
