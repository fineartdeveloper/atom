'use babel';

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _this = this;

var atom = global.atom;
var Path = require('path');
var FileSystem = require('fs-plus');
var Minimatch = require('minimatch').Minimatch;

var ignoredPatterns = null;
var ignoredFinderPatterns = null;

var logDebug = function logDebug(param1, param2) {
  if (atom.config.get('ftp-remote-edit.dev.debug')) {
    if (param1 && param2) {
      console.log(param1, param2);
    } else if (param1) {
      console.log(param1);
    }
  }
};

exports.logDebug = logDebug;
var showMessage = function showMessage(msg) {
  var type = arguments.length <= 1 || arguments[1] === undefined ? 'info' : arguments[1];

  if (msg instanceof Error) {
    msg = msg.message;
  }

  if (typeof msg !== 'string') {
    msg = 'Unknown error';
  }

  if (type === 'success') {
    atom.notifications.addSuccess('Ftp-Remote-Edit', {
      description: msg
    });
  } else if (type === 'info') {
    atom.notifications.addInfo('Ftp-Remote-Edit', {
      description: msg
    });
  } else {
    atom.notifications.addError('Ftp-Remote-Edit', {
      description: msg
    });
  }
};

exports.showMessage = showMessage;
var getFullExtension = function getFullExtension(filePath) {
  var fullExtension = '';
  var extension = '';
  while (extension = Path.extname(filePath)) {
    fullExtension = extension + fullExtension;
    filePath = Path.basename(filePath, extension);
  }
  return fullExtension;
};

exports.getFullExtension = getFullExtension;
var createLocalPath = function createLocalPath(localpath) {
  try {
    var arrPath = localpath.split(Path.sep);
    arrPath.pop();

    arrPath.reduce(function (tmpPath, dir) {
      tmpPath += Path.sep + dir;
      if (!FileSystem.existsSync(tmpPath)) {
        FileSystem.mkdirSync(tmpPath);
      }
      return tmpPath;
    });
  } catch (err) {
    return err;
  }
};

exports.createLocalPath = createLocalPath;
var deleteLocalPath = function deleteLocalPath(localpath) {
  try {
    if (FileSystem.existsSync(localpath)) {
      FileSystem.readdirSync(localpath).forEach(function (file, index) {
        var curPath = localpath + "/" + file;
        if (FileSystem.lstatSync(curPath).isDirectory()) {
          // recurse
          return deleteLocalPath(curPath);
        } else {
          // delete file
          FileSystem.unlinkSync(curPath);
        }
      });
      FileSystem.rmdirSync(localpath);
    }
  } catch (err) {
    return err;
  }
};

exports.deleteLocalPath = deleteLocalPath;
var moveLocalPath = function moveLocalPath(srclocalpath, targetlocalpath) {
  try {
    var tmp = targetlocalpath.split(Path.sep);
    tmp.pop();
    var parentPath = tmp.join(Path.sep);

    if (!FileSystem.existsSync(parentPath)) {
      FileSystem.makeTreeSync(parentPath);
    }
    if (FileSystem.existsSync(targetlocalpath)) {
      FileSystem.removeSync(targetlocalpath);
    }
    FileSystem.moveSync(srclocalpath, targetlocalpath);
  } catch (err) {
    return err;
  }
};

exports.moveLocalPath = moveLocalPath;
var resetIgnoredPatterns = function resetIgnoredPatterns() {
  ignoredPatterns = null;
};

exports.resetIgnoredPatterns = resetIgnoredPatterns;
var loadIgnoredPatterns = function loadIgnoredPatterns() {
  var ignoredName = undefined,
      ignoredNames = undefined,
      i = undefined,
      len = undefined,
      results = undefined;

  if (!atom.config.get('ftp-remote-edit.tree.hideIgnoredNames')) {
    return;
  }

  if (ignoredPatterns) return ignoredPatterns;
  if (ignoredPatterns == null) ignoredPatterns = [];

  ignoredNames = atom.config.get('core.ignoredNames') != null ? atom.config.get('core.ignoredNames') : [];
  if (typeof ignoredNames === 'string') {
    ignoredNames = [ignoredNames];
  }
  results = [];
  for (i = 0, len = ignoredNames.length; i < len; i++) {
    ignoredName = ignoredNames[i];
    if (ignoredName) {
      try {
        ignoredPatterns.push(new Minimatch(ignoredName, {
          matchBase: true,
          dot: true
        }));
      } catch (err) {
        console.log(err, "Ftp-Remote-Edit: Error parsing ignore pattern (" + ignoredName + ")");
      }
    }
  }
  return ignoredPatterns;
};

exports.loadIgnoredPatterns = loadIgnoredPatterns;
var isPathIgnored = function isPathIgnored(filePath) {
  if (atom.config.get('ftp-remote-edit.tree.hideIgnoredNames')) {
    var _ignoredPatterns = loadIgnoredPatterns();
    for (i = 0, len = _ignoredPatterns.length; i < len; i++) {
      if (_ignoredPatterns[i].match(filePath)) {
        return true;
      }
    }
  }
  return false;
};

exports.isPathIgnored = isPathIgnored;
var resetIgnoredFinderPatterns = function resetIgnoredFinderPatterns() {
  ignoredFinderPatterns = null;
};

exports.resetIgnoredFinderPatterns = resetIgnoredFinderPatterns;
var loadIgnoredFinderPatterns = function loadIgnoredFinderPatterns() {
  var ignoredName = undefined,
      ignoredNames = undefined,
      ignoredCoreNames = undefined,
      ignoredFinderNames = undefined,
      i = undefined,
      len = undefined,
      results = undefined;

  if (ignoredFinderPatterns) return ignoredFinderPatterns;
  if (ignoredFinderPatterns == null) ignoredFinderPatterns = [];

  if (atom.config.get('ftp-remote-edit.tree.hideIgnoredNames')) {
    ignoredCoreNames = atom.config.get('core.ignoredNames') != null ? atom.config.get('core.ignoredNames') : [];
    if (typeof ignoredCoreNames === 'string') {
      ignoredCoreNames = [ignoredCoreNames];
    }
  } else {
    ignoredCoreNames = [];
  }

  ignoredFinderNames = atom.config.get('ftp-remote-edit.finder.ignoredNames') != null ? atom.config.get('ftp-remote-edit.finder.ignoredNames') : [];
  if (typeof ignoredFinderNames === 'string') {
    ignoredFinderNames = [ignoredFinderNames];
  }

  ignoredNames = [];
  ignoredNames = ignoredCoreNames.concat(ignoredFinderNames);

  results = [];
  for (i = 0, len = ignoredNames.length; i < len; i++) {
    ignoredName = ignoredNames[i];
    if (ignoredName) {
      try {
        ignoredFinderPatterns.push(new Minimatch(ignoredName, {
          matchBase: true,
          dot: true
        }));
      } catch (err) {
        console.log(err, "Ftp-Remote-Edit: Error parsing ignore pattern (" + ignoredName + ")");
      }
    }
  }
  return ignoredFinderPatterns;
};

exports.loadIgnoredFinderPatterns = loadIgnoredFinderPatterns;
var isFinderPathIgnored = function isFinderPathIgnored(filePath) {
  var ignoredPatterns = loadIgnoredFinderPatterns();
  for (i = 0, len = ignoredPatterns.length; i < len; i++) {
    if (ignoredPatterns[i].match(filePath)) {
      return true;
    }
  }

  return false;
};

exports.isFinderPathIgnored = isFinderPathIgnored;
var highlight = function highlight(path, matches, offsetIndex) {
  var lastIndex = 0;
  var matchedChars = [];
  var fragment = document.createDocumentFragment();
  for (var matchIndex of matches) {
    matchIndex -= offsetIndex;
    // If marking up the basename, omit path matches
    if (matchIndex < 0) {
      continue;
    }
    var unmatched = path.substring(lastIndex, matchIndex);
    if (unmatched) {
      if (matchedChars.length > 0) {
        var span = document.createElement('span');
        span.classList.add('character-match');
        span.textContent = matchedChars.join('');
        fragment.appendChild(span);
        matchedChars = [];
      }

      fragment.appendChild(document.createTextNode(unmatched));
    }

    matchedChars.push(path[matchIndex]);
    lastIndex = matchIndex + 1;
  }

  if (matchedChars.length > 0) {
    var span = document.createElement('span');
    span.classList.add('character-match');
    span.textContent = matchedChars.join('');
    fragment.appendChild(span);
  }

  // Remaining characters are plain text
  fragment.appendChild(document.createTextNode(path.substring(lastIndex)));
  return fragment;
};

exports.highlight = highlight;
var rightsToPermissions = function rightsToPermissions(rights) {
  var self = _this;

  if (!rights) return;

  var user = rights.user.split('');
  var group = rights.group.split('');
  var other = rights.other.split('');

  var permissionsuser = 0;
  var permissionsgroup = 0;
  var permissionsother = 0;

  user.forEach(function (right) {
    if (right == 'r') permissionsuser += 4;
    if (right == 'w') permissionsuser += 2;
    if (right == 'x') permissionsuser += 1;
  });

  group.forEach(function (right) {
    if (right == 'r') permissionsgroup += 4;
    if (right == 'w') permissionsgroup += 2;
    if (right == 'x') permissionsgroup += 1;
  });

  other.forEach(function (right) {
    if (right == 'r') permissionsother += 4;
    if (right == 'w') permissionsother += 2;
    if (right == 'x') permissionsother += 1;
  });

  return permissionsuser.toString() + permissionsgroup.toString() + permissionsother.toString();
};

exports.rightsToPermissions = rightsToPermissions;
var permissionsToRights = function permissionsToRights(permissions) {
  var self = _this;

  var groups = permissions.split('');

  var rights = {
    user: "",
    group: "",
    other: ""
  };

  if (groups[0] == 7) {
    rights.user += 'rwx';
  } else if (groups[0] == 6) {
    rights.user = 'rw';
  } else if (groups[0] == 5) {
    rights.user = 'rx';
  } else if (groups[0] == 4) {
    rights.user = 'r';
  } else if (groups[0] == 3) {
    rights.user = 'wx';
  } else if (groups[0] == 2) {
    rights.user = 'w';
  } else if (groups[0] == 1) {
    rights.user = 'x';
  } else if (groups[0] == 'x') {
    rights.user = self.rights.user;
  } else {
    rights.user = '';
  }

  if (groups[1] == 7) {
    rights.group += 'rwx';
  } else if (groups[1] == 6) {
    rights.group = 'rw';
  } else if (groups[1] == 5) {
    rights.group = 'rx';
  } else if (groups[1] == 4) {
    rights.group = 'r';
  } else if (groups[1] == 3) {
    rights.group = 'wx';
  } else if (groups[1] == 2) {
    rights.group = 'w';
  } else if (groups[1] == 1) {
    rights.group = 'x';
  } else if (groups[1] == 'x') {
    rights.group = self.rights.group;
  } else {
    rights.group = '';
  }

  if (groups[2] == 7) {
    rights.other += 'rwx';
  } else if (groups[2] == 6) {
    rights.other = 'rw';
  } else if (groups[2] == 5) {
    rights.other = 'rx';
  } else if (groups[2] == 4) {
    rights.other = 'r';
  } else if (groups[2] == 3) {
    rights.other = 'wx';
  } else if (groups[2] == 2) {
    rights.other = 'w';
  } else if (groups[2] == 1) {
    rights.other = 'x';
  } else if (groups[2] == 'x') {
    rights.other = self.rights.other;
  } else {
    rights.other = '';
  }

  return rights;
};

exports.permissionsToRights = permissionsToRights;
var parseFTPDate = function parseFTPDate(line) {
  var RE_LINE = new RegExp("^(\\w{3})\\s+(\\d{1,2})\\s+((\\d{1,2}):(\\d{1,2}))*(\\d{4})*$");
  var MONTHS = { jan: 1, feb: 2, mar: 3, apr: 4, may: 5, jun: 6, jul: 7, aug: 8, sep: 9, oct: 10, nov: 11, dec: 12 };
  var groups = line.trim().match(RE_LINE);

  try {
    if (groups) {
      var month = parseInt(MONTHS[groups[1].toLowerCase()], 10);
      var day = parseInt(groups[2], 10);
      var year = groups[6] ? parseInt(groups[6], 10) : new Date().getFullYear();
      var hour = groups[4] ? parseInt(groups[4], 10) : null;
      var mins = groups[5] ? parseInt(groups[5], 10) : null;

      if (month < 10) month = '0' + month;
      if (day < 10) day = '0' + day;
      if (hour && hour < 10) hour = '0' + hour;
      if (mins && mins < 10) mins = '0' + mins;

      if (hour) {
        return new Date(year + '-' + month + '-' + day + 'T' + hour + ':' + mins);
      } else {
        return new Date(year + '-' + month + '-' + day);
      }
    }
  } catch (error) {
    return undefined;
  }
  return undefined;
};

exports.parseFTPDate = parseFTPDate;
var getTextEditor = function getTextEditor(pathOnFileSystem) {
  var activate = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

  var foundEditor = null;
  var texteditors = atom.workspace.getTextEditors();
  texteditors.forEach(function (texteditor) {
    if (texteditor.getPath() == pathOnFileSystem) {
      foundEditor = texteditor;
      return false;
    }
  });

  if (activate && foundEditor) {
    pane = atom.workspace.paneForItem(foundEditor);
    if (pane) pane.activateItem(foundEditor);
  }

  return foundEditor;
};

exports.getTextEditor = getTextEditor;
var forEachAsync = function forEachAsync(array, callback) {
  return array.reduce(function (promise, item) {
    return promise.then(function (result) {
      return callback(item);
    });
  }, Promise.resolve());
};

exports.forEachAsync = forEachAsync;
// Return 1  if versionA > versionB
// Return 0  if versionA == versionB
// Return -1 if versionA < versionB
var compareVersions = function compareVersions(versionA, versionB) {
  if (versionA === versionB) {
    return 0;
  }

  var partsNumberA = versionA.split(".");
  var partsNumberB = versionB.split(".");

  for (var _i = 0; _i < partsNumberA.length; _i++) {
    var valueA = parseInt(partsNumberA[_i]);
    var valueB = parseInt(partsNumberB[_i]);

    if (valueA > valueB || isNaN(valueB)) {
      return 1;
    }
    if (valueA < valueB) {
      return -1;
    }
  }
};
exports.compareVersions = compareVersions;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdWRwcmF3YXQvLmF0b20vcGFja2FnZXMvZnRwLXJlbW90ZS1lZGl0L2xpYi9oZWxwZXIvaGVscGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFdBQVcsQ0FBQzs7Ozs7Ozs7QUFFWixJQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ3pCLElBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUM3QixJQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDdEMsSUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQzs7QUFFakQsSUFBSSxlQUFlLEdBQUcsSUFBSSxDQUFDO0FBQzNCLElBQUkscUJBQXFCLEdBQUcsSUFBSSxDQUFDOztBQUUxQixJQUFNLFFBQVEsR0FBRyxTQUFYLFFBQVEsQ0FBSSxNQUFNLEVBQUUsTUFBTSxFQUFLO0FBQzFDLE1BQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLENBQUMsRUFBRTtBQUNoRCxRQUFJLE1BQU0sSUFBSSxNQUFNLEVBQUU7QUFDcEIsYUFBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7S0FDN0IsTUFBTSxJQUFJLE1BQU0sRUFBRTtBQUNqQixhQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQ3JCO0dBQ0Y7Q0FDRixDQUFBOzs7QUFFTSxJQUFNLFdBQVcsR0FBRyxTQUFkLFdBQVcsQ0FBSSxHQUFHLEVBQW9CO01BQWxCLElBQUkseURBQUcsTUFBTTs7QUFDNUMsTUFBSSxHQUFHLFlBQVksS0FBSyxFQUFFO0FBQ3hCLE9BQUcsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDO0dBQ25COztBQUVELE1BQUksT0FBTyxHQUFHLEtBQUssUUFBUSxFQUFFO0FBQzNCLE9BQUcsR0FBRyxlQUFlLENBQUM7R0FDdkI7O0FBRUQsTUFB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LElBQUksR0FBRyxJQUFJLENBQUM7R0FDcEIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7R0FDbkIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7R0FDcEIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7R0FDbkIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7R0FDbkIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLEVBQUU7QUFDM0IsVUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztHQUNoQyxNQUFNO0FBQ0wsVUFBTSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7R0FDbEI7O0FBRUQsTUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ2xCLFVBQU0sQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDO0dBQ3ZCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO0dBQ3JCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO0dBQ3JCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO0dBQ3BCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO0dBQ3JCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO0dBQ3BCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO0dBQ3BCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxFQUFFO0FBQzNCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7R0FDbEMsTUFBTTtBQUNMLFVBQU0sQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO0dBQ25COztBQUVELE1BQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUNsQixVQUFNLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQztHQUN2QixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztHQUNyQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztHQUNyQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztHQUNwQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztHQUNyQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLEdB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QUFZLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN2QyxNQUFJLFlBQVksR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDOztBQUV2QyxPQUFLLElBQUksRUFBQyxHQUFHLENBQUMsRUFBRSxFQUFDLEdBQUcsWUFBWSxDQUFDLE1BQU0sRUFBRSxFQUFDLEVBQUUsRUFBRTtBQUM1QyxRQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsWUFBWSxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7QUFDdkMsUUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLFlBQVksQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDOztBQUV2QyxRQUFJLE1BQU0sR0FBRyxNQUFNLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFO0FBQ3BDLGFBQU8sQ0FBQyxDQUFDO0tBQ1Y7QUFDRCxRQUFJLE1BQU0sR0FBRyxNQUFNLEVBQUU7QUFDbkIsYUFBTyxDQUFDLENBQUMsQ0FBQztLQUNYO0dBQ0Y7Q0FDRixDQUFBIiwiZmlsZSI6Ii9Vc2Vycy9zdWRwcmF3YXQvLmF0b20vcGFja2FnZXMvZnRwLXJlbW90ZS1lZGl0L2xpYi9oZWxwZXIvaGVscGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG5cbmNvbnN0IGF0b20gPSBnbG9iYWwuYXRvbTtcbmNvbnN0IFBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5jb25zdCBGaWxlU3lzdGVtID0gcmVxdWlyZSgnZnMtcGx1cycpO1xuY29uc3QgTWluaW1hdGNoID0gcmVxdWlyZSgnbWluaW1hdGNoJykuTWluaW1hdGNoO1xuXG5sZXQgaWdub3JlZFBhdHRlcm5zID0gbnVsbDtcbmxldCBpZ25vcmVkRmluZGVyUGF0dGVybnMgPSBudWxsO1xuXG5leHBvcnQgY29uc3QgbG9nRGVidWcgPSAocGFyYW0xLCBwYXJhbTIpID0+IHtcbiAgaWYgKGF0b20uY29uZmlnLmdldCgnZnRwLXJlbW90ZS1lZGl0LmRldi5kZWJ1ZycpKSB7XG4gICAgaWYgKHBhcmFtMSAmJiBwYXJhbTIpIHtcbiAgICAgIGNvbnNvbGUubG9nKHBhcmFtMSwgcGFyYW0yKTtcbiAgICB9IGVsc2UgaWYgKHBhcmFtMSkge1xuICAgICAgY29uc29sZS5sb2cocGFyYW0xKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IHNob3dNZXNzYWdlID0gKG1zZywgdHlwZSA9ICdpbmZvJykgPT4ge1xuICBpZiAobXNnIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICBtc2cgPSBtc2cubWVzc2FnZTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgbXNnICE9PSAnc3RyaW5nJykge1xuICAgIG1zZyA9ICdVbmtub3duIGVycm9yJztcbiAgfVxuXG4gIGlmICh0eXBlID09PSAnc3VjY2VzcycpIHtcbiAgICBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkU3VjY2VzcygnRnRwLVJlbW90ZS1FZGl0Jywge1xuICAgICAgZGVzY3JpcHRpb246IG1zZ1xuICAgIH0pO1xuICB9IGVsc2UgaWYgKHR5cGUgPT09ICdpbmZvJykge1xuICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRJbmZvKCdGdHAtUmVtb3RlLUVkaXQnLCB7XG4gICAgICBkZXNjcmlwdGlvbjogbXNnXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKCdGdHAtUmVtb3RlLUVkaXQnLCB7XG4gICAgICBkZXNjcmlwdGlvbjogbXNnLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBnZXRGdWxsRXh0ZW5zaW9uID0gKGZpbGVQYXRoKSA9PiB7XG4gIGxldCBmdWxsRXh0ZW5zaW9uID0gJyc7XG4gIGxldCBleHRlbnNpb24gPSAnJztcbiAgd2hpbGUgKGV4dGVuc2lvbiA9IFBhdGguZXh0bmFtZShmaWxlUGF0aCkpIHtcbiAgICBmdWxsRXh0ZW5zaW9uID0gZXh0ZW5zaW9uICsgZnVsbEV4dGVuc2lvblxuICAgIGZpbGVQYXRoID0gUGF0aC5iYXNlbmFtZShmaWxlUGF0aCwgZXh0ZW5zaW9uKVxuICB9XG4gIHJldHVybiBmdWxsRXh0ZW5zaW9uO1xufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlTG9jYWxQYXRoID0gKGxvY2FscGF0aCkgPT4ge1xuICB0cnkge1xuICAgIGxldCBhcnJQYXRoID0gbG9jYWxwYXRoLnNwbGl0KFBhdGguc2VwKTtcbiAgICBhcnJQYXRoLnBvcCgpO1xuXG4gICAgYXJyUGF0aC5yZWR1Y2UoKHRtcFBhdGgsIGRpcikgPT4ge1xuICAgICAgdG1wUGF0aCArPSBQYXRoLnNlcCArIGRpcjtcbiAgICAgIGlmICghRmlsZVN5c3RlbS5leGlzdHNTeW5jKHRtcFBhdGgpKSB7XG4gICAgICAgIEZpbGVTeXN0ZW0ubWtkaXJTeW5jKHRtcFBhdGgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRtcFBhdGg7XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycikgeyByZXR1cm4gZXJyOyB9XG59XG5cbmV4cG9ydCBjb25zdCBkZWxldGVMb2NhbFBhdGggPSAobG9jYWxwYXRoKSA9PiB7XG4gIHRyeSB7XG4gICAgaWYgKEZpbGVTeXN0ZW0uZXhpc3RzU3luYyhsb2NhbHBhdGgpKSB7XG4gICAgICBGaWxlU3lzdGVtLnJlYWRkaXJTeW5jKGxvY2FscGF0aCkuZm9yRWFjaCgoZmlsZSwgaW5kZXgpID0+IHtcbiAgICAgICAgbGV0IGN1clBhdGggPSBsb2NhbHBhdGggKyBcIi9cIiArIGZpbGU7XG4gICAgICAgIGlmIChGaWxlU3lzdGVtLmxzdGF0U3luYyhjdXJQYXRoKS5pc0RpcmVjdG9yeSgpKSB7IC8vIHJlY3Vyc2VcbiAgICAgICAgICByZXR1cm4gZGVsZXRlTG9jYWxQYXRoKGN1clBhdGgpO1xuICAgICAgICB9IGVsc2UgeyAvLyBkZWxldGUgZmlsZVxuICAgICAgICAgIEZpbGVTeXN0ZW0udW5saW5rU3luYyhjdXJQYXRoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBGaWxlU3lzdGVtLnJtZGlyU3luYyhsb2NhbHBhdGgpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7IHJldHVybiBlcnI7IH1cbn1cblxuZXhwb3J0IGNvbnN0IG1vdmVMb2NhbFBhdGggPSAoc3JjbG9jYWxwYXRoLCB0YXJnZXRsb2NhbHBhdGgpID0+IHtcbiAgdHJ5IHtcbiAgICBsZXQgdG1wID0gdGFyZ2V0bG9jYWxwYXRoLnNwbGl0KFBhdGguc2VwKTtcbiAgICB0bXAucG9wKCk7XG4gICAgbGV0IHBhcmVudFBhdGggPSB0bXAuam9pbihQYXRoLnNlcCk7XG5cbiAgICBpZiAoIUZpbGVTeXN0ZW0uZXhpc3RzU3luYyhwYXJlbnRQYXRoKSkge1xuICAgICAgRmlsZVN5c3RlbS5tYWtlVHJlZVN5bmMocGFyZW50UGF0aCk7XG4gICAgfVxuICAgIGlmIChGaWxlU3lzdGVtLmV4aXN0c1N5bmModGFyZ2V0bG9jYWxwYXRoKSkge1xuICAgICAgRmlsZVN5c3RlbS5yZW1vdmVTeW5jKHRhcmdldGxvY2FscGF0aCk7XG4gICAgfVxuICAgIEZpbGVTeXN0ZW0ubW92ZVN5bmMoc3JjbG9jYWxwYXRoLCB0YXJnZXRsb2NhbHBhdGgpO1xuICB9IGNhdGNoIChlcnIpIHsgcmV0dXJuIGVycjsgfVxufVxuXG5leHBvcnQgY29uc3QgcmVzZXRJZ25vcmVkUGF0dGVybnMgPSAoKSA9PiB7XG4gIGlnbm9yZWRQYXR0ZXJucyA9IG51bGw7XG59XG5cbmV4cG9ydCBjb25zdCBsb2FkSWdub3JlZFBhdHRlcm5zID0gKCkgPT4ge1xuICBsZXQgaWdub3JlZE5hbWUsIGlnbm9yZWROYW1lcywgaSwgbGVuLCByZXN1bHRzO1xuXG4gIGlmICghYXRvbS5jb25maWcuZ2V0KCdmdHAtcmVtb3RlLWVkaXQudHJlZS5oaWRlSWdub3JlZE5hbWVzJykpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoaWdub3JlZFBhdHRlcm5zKSByZXR1cm4gaWdub3JlZFBhdHRlcm5zO1xuICBpZiAoaWdub3JlZFBhdHRlcm5zID09IG51bGwpIGlnbm9yZWRQYXR0ZXJucyA9IFtdO1xuXG4gIGlnbm9yZWROYW1lcyA9IChhdG9tLmNvbmZpZy5nZXQoJ2NvcmUuaWdub3JlZE5hbWVzJykpICE9IG51bGwgPyBhdG9tLmNvbmZpZy5nZXQoJ2NvcmUuaWdub3JlZE5hbWVzJykgOiBbXTtcbiAgaWYgKHR5cGVvZiBpZ25vcmVkTmFtZXMgPT09ICdzdHJpbmcnKSB7XG4gICAgaWdub3JlZE5hbWVzID0gW2lnbm9yZWROYW1lc107XG4gIH1cbiAgcmVzdWx0cyA9IFtdO1xuICBmb3IgKGkgPSAwLCBsZW4gPSBpZ25vcmVkTmFtZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICBpZ25vcmVkTmFtZSA9IGlnbm9yZWROYW1lc1tpXTtcbiAgICBpZiAoaWdub3JlZE5hbWUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlnbm9yZWRQYXR0ZXJucy5wdXNoKG5ldyBNaW5pbWF0Y2goaWdub3JlZE5hbWUsIHtcbiAgICAgICAgICBtYXRjaEJhc2U6IHRydWUsXG4gICAgICAgICAgZG90OiB0cnVlXG4gICAgICAgIH0pKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIsIFwiRnRwLVJlbW90ZS1FZGl0OiBFcnJvciBwYXJzaW5nIGlnbm9yZSBwYXR0ZXJuIChcIiArIGlnbm9yZWROYW1lICsgXCIpXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gaWdub3JlZFBhdHRlcm5zO1xufVxuXG5leHBvcnQgY29uc3QgaXNQYXRoSWdub3JlZCA9IChmaWxlUGF0aCkgPT4ge1xuICBpZiAoYXRvbS5jb25maWcuZ2V0KCdmdHAtcmVtb3RlLWVkaXQudHJlZS5oaWRlSWdub3JlZE5hbWVzJykpIHtcbiAgICBsZXQgaWdub3JlZFBhdHRlcm5zID0gbG9hZElnbm9yZWRQYXR0ZXJucygpO1xuICAgIGZvciAoaSA9IDAsIGxlbiA9IGlnbm9yZWRQYXR0ZXJucy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgaWYgKGlnbm9yZWRQYXR0ZXJuc1tpXS5tYXRjaChmaWxlUGF0aCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZXhwb3J0IGNvbnN0IHJlc2V0SWdub3JlZEZpbmRlclBhdHRlcm5zID0gKCkgPT4ge1xuICBpZ25vcmVkRmluZGVyUGF0dGVybnMgPSBudWxsO1xufVxuXG5leHBvcnQgY29uc3QgbG9hZElnbm9yZWRGaW5kZXJQYXR0ZXJucyA9ICgpID0+IHtcbiAgbGV0IGlnbm9yZWROYW1lLCBpZ25vcmVkTmFtZXMsIGlnbm9yZWRDb3JlTmFtZXMsIGlnbm9yZWRGaW5kZXJOYW1lcywgaSwgbGVuLCByZXN1bHRzO1xuXG4gIGlmIChpZ25vcmVkRmluZGVyUGF0dGVybnMpIHJldHVybiBpZ25vcmVkRmluZGVyUGF0dGVybnM7XG4gIGlmIChpZ25vcmVkRmluZGVyUGF0dGVybnMgPT0gbnVsbCkgaWdub3JlZEZpbmRlclBhdHRlcm5zID0gW107XG5cbiAgaWYgKGF0b20uY29uZmlnLmdldCgnZnRwLXJlbW90ZS1lZGl0LnRyZWUuaGlkZUlnbm9yZWROYW1lcycpKSB7XG4gICAgaWdub3JlZENvcmVOYW1lcyA9IChhdG9tLmNvbmZpZy5nZXQoJ2NvcmUuaWdub3JlZE5hbWVzJykpICE9IG51bGwgPyBhdG9tLmNvbmZpZy5nZXQoJ2NvcmUuaWdub3JlZE5hbWVzJykgOiBbXTtcbiAgICBpZiAodHlwZW9mIGlnbm9yZWRDb3JlTmFtZXMgPT09ICdzdHJpbmcnKSB7XG4gICAgICBpZ25vcmVkQ29yZU5hbWVzID0gW2lnbm9yZWRDb3JlTmFtZXNdO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZ25vcmVkQ29yZU5hbWVzID0gW107XG4gIH1cblxuICBpZ25vcmVkRmluZGVyTmFtZXMgPSAoYXRvbS5jb25maWcuZ2V0KCdmdHAtcmVtb3RlLWVkaXQuZmluZGVyLmlnbm9yZWROYW1lcycpKSAhPSBudWxsID8gYXRvbS5jb25maWcuZ2V0KCdmdHAtcmVtb3RlLWVkaXQuZmluZGVyLmlnbm9yZWROYW1lcycpIDogW107XG4gIGlmICh0eXBlb2YgaWdub3JlZEZpbmRlck5hbWVzID09PSAnc3RyaW5nJykge1xuICAgIGlnbm9yZWRGaW5kZXJOYW1lcyA9IFtpZ25vcmVkRmluZGVyTmFtZXNdO1xuICB9XG5cbiAgaWdub3JlZE5hbWVzID0gW107XG4gIGlnbm9yZWROYW1lcyA9IGlnbm9yZWRDb3JlTmFtZXMuY29uY2F0KGlnbm9yZWRGaW5kZXJOYW1lcyk7XG5cbiAgcmVzdWx0cyA9IFtdO1xuICBmb3IgKGkgPSAwLCBsZW4gPSBpZ25vcmVkTmFtZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICBpZ25vcmVkTmFtZSA9IGlnbm9yZWROYW1lc1tpXTtcbiAgICBpZiAoaWdub3JlZE5hbWUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlnbm9yZWRGaW5kZXJQYXR0ZXJucy5wdXNoKG5ldyBNaW5pbWF0Y2goaWdub3JlZE5hbWUsIHtcbiAgICAgICAgICBtYXRjaEJhc2U6IHRydWUsXG4gICAgICAgICAgZG90OiB0cnVlXG4gICAgICAgIH0pKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIsIFwiRnRwLVJlbW90ZS1FZGl0OiBFcnJvciBwYXJzaW5nIGlnbm9yZSBwYXR0ZXJuIChcIiArIGlnbm9yZWROYW1lICsgXCIpXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gaWdub3JlZEZpbmRlclBhdHRlcm5zO1xufVxuXG5leHBvcnQgY29uc3QgaXNGaW5kZXJQYXRoSWdub3JlZCA9IChmaWxlUGF0aCkgPT4ge1xuICBsZXQgaWdub3JlZFBhdHRlcm5zID0gbG9hZElnbm9yZWRGaW5kZXJQYXR0ZXJucygpO1xuICBmb3IgKGkgPSAwLCBsZW4gPSBpZ25vcmVkUGF0dGVybnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICBpZiAoaWdub3JlZFBhdHRlcm5zW2ldLm1hdGNoKGZpbGVQYXRoKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgY29uc3QgaGlnaGxpZ2h0ID0gKHBhdGgsIG1hdGNoZXMsIG9mZnNldEluZGV4KSA9PiB7XG4gIGxldCBsYXN0SW5kZXggPSAwO1xuICBsZXQgbWF0Y2hlZENoYXJzID0gW107XG4gIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICBmb3IgKGxldCBtYXRjaEluZGV4IG9mIG1hdGNoZXMpIHtcbiAgICBtYXRjaEluZGV4IC09IG9mZnNldEluZGV4O1xuICAgIC8vIElmIG1hcmtpbmcgdXAgdGhlIGJhc2VuYW1lLCBvbWl0IHBhdGggbWF0Y2hlc1xuICAgIGlmIChtYXRjaEluZGV4IDwgMCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IHVubWF0Y2hlZCA9IHBhdGguc3Vic3RyaW5nKGxhc3RJbmRleCwgbWF0Y2hJbmRleCk7XG4gICAgaWYgKHVubWF0Y2hlZCkge1xuICAgICAgaWYgKG1hdGNoZWRDaGFycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgIHNwYW4uY2xhc3NMaXN0LmFkZCgnY2hhcmFjdGVyLW1hdGNoJyk7XG4gICAgICAgIHNwYW4udGV4dENvbnRlbnQgPSBtYXRjaGVkQ2hhcnMuam9pbignJyk7XG4gICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHNwYW4pO1xuICAgICAgICBtYXRjaGVkQ2hhcnMgPSBbXTtcbiAgICAgIH1cblxuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodW5tYXRjaGVkKSlcbiAgICB9XG5cbiAgICBtYXRjaGVkQ2hhcnMucHVzaChwYXRoW21hdGNoSW5kZXhdKTtcbiAgICBsYXN0SW5kZXggPSBtYXRjaEluZGV4ICsgMTtcbiAgfVxuXG4gIGlmIChtYXRjaGVkQ2hhcnMubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgc3Bhbi5jbGFzc0xpc3QuYWRkKCdjaGFyYWN0ZXItbWF0Y2gnKTtcbiAgICBzcGFuLnRleHRDb250ZW50ID0gbWF0Y2hlZENoYXJzLmpvaW4oJycpO1xuICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHNwYW4pO1xuICB9XG5cbiAgLy8gUmVtYWluaW5nIGNoYXJhY3RlcnMgYXJlIHBsYWluIHRleHRcbiAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocGF0aC5zdWJzdHJpbmcobGFzdEluZGV4KSkpO1xuICByZXR1cm4gZnJhZ21lbnQ7XG59XG5cbmV4cG9ydCBjb25zdCByaWdodHNUb1Blcm1pc3Npb25zID0gKHJpZ2h0cykgPT4ge1xuICBjb25zdCBzZWxmID0gdGhpcztcblxuICBpZiAoIXJpZ2h0cykgcmV0dXJuO1xuXG4gIGxldCB1c2VyID0gcmlnaHRzLnVzZXIuc3BsaXQoJycpO1xuICBsZXQgZ3JvdXAgPSByaWdodHMuZ3JvdXAuc3BsaXQoJycpO1xuICBsZXQgb3RoZXIgPSByaWdodHMub3RoZXIuc3BsaXQoJycpO1xuXG4gIGxldCBwZXJtaXNzaW9uc3VzZXIgPSAwO1xuICBsZXQgcGVybWlzc2lvbnNncm91cCA9IDA7XG4gIGxldCBwZXJtaXNzaW9uc290aGVyID0gMDtcblxuICB1c2VyLmZvckVhY2goKHJpZ2h0KSA9PiB7XG4gICAgaWYgKHJpZ2h0ID09ICdyJykgcGVybWlzc2lvbnN1c2VyICs9IDQ7XG4gICAgaWYgKHJpZ2h0ID09ICd3JykgcGVybWlzc2lvbnN1c2VyICs9IDI7XG4gICAgaWYgKHJpZ2h0ID09ICd4JykgcGVybWlzc2lvbnN1c2VyICs9IDE7XG4gIH0pO1xuXG4gIGdyb3VwLmZvckVhY2goKHJpZ2h0KSA9PiB7XG4gICAgaWYgKHJpZ2h0ID09ICdyJykgcGVybWlzc2lvbnNncm91cCArPSA0O1xuICAgIGlmIChyaWdodCA9PSAndycpIHBlcm1pc3Npb25zZ3JvdXAgKz0gMjtcbiAgICBpZiAocmlnaHQgPT0gJ3gnKSBwZXJtaXNzaW9uc2dyb3VwICs9IDE7XG4gIH0pO1xuXG4gIG90aGVyLmZvckVhY2goKHJpZ2h0KSA9PiB7XG4gICAgaWYgKHJpZ2h0ID09ICdyJykgcGVybWlzc2lvbnNvdGhlciArPSA0O1xuICAgIGlmIChyaWdodCA9PSAndycpIHBlcm1pc3Npb25zb3RoZXIgKz0gMjtcbiAgICBpZiAocmlnaHQgPT0gJ3gnKSBwZXJtaXNzaW9uc290aGVyICs9IDE7XG4gIH0pO1xuXG4gIHJldHVybiBwZXJtaXNzaW9uc3VzZXIudG9TdHJpbmcoKSArIHBlcm1pc3Npb25zZ3JvdXAudG9TdHJpbmcoKSArIHBlcm1pc3Npb25zb3RoZXIudG9TdHJpbmcoKTtcbn1cblxuZXhwb3J0IGNvbnN0IHBlcm1pc3Npb25zVG9SaWdodHMgPSAocGVybWlzc2lvbnMpID0+IHtcbiAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgbGV0IGdyb3VwcyA9IHBlcm1pc3Npb25zLnNwbGl0KCcnKTtcblxuICBsZXQgcmlnaHRzID0ge1xuICAgIHVzZXI6IFwiXCIsXG4gICAgZ3JvdXA6IFwiXCIsXG4gICAgb3RoZXI6IFwiXCIsXG4gIH1cblxuICBpZiAoZ3JvdXBzWzBdID09IDcpIHtcbiAgICByaWdodHMudXNlciArPSAncnd4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMF0gPT0gNikge1xuICAgIHJpZ2h0cy51c2VyID0gJ3J3JztcbiAgfSBlbHNlIGlmIChncm91cHNbMF0gPT0gNSkge1xuICAgIHJpZ2h0cy51c2VyID0gJ3J4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMF0gPT0gNCkge1xuICAgIHJpZ2h0cy51c2VyID0gJ3InO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1swXSA9PSAzKSB7XG4gICAgcmlnaHRzLnVzZXIgPSAnd3gnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1swXSA9PSAyKSB7XG4gICAgcmlnaHRzLnVzZXIgPSAndyc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzBdID09IDEpIHtcbiAgICByaWdodHMudXNlciA9ICd4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMF0gPT0gJ3gnKSB7XG4gICAgcmlnaHRzLnVzZXIgPSBzZWxmLnJpZ2h0cy51c2VyO1xuICB9IGVsc2Uge1xuICAgIHJpZ2h0cy51c2VyID0gJyc7XG4gIH1cblxuICBpZiAoZ3JvdXBzWzFdID09IDcpIHtcbiAgICByaWdodHMuZ3JvdXAgKz0gJ3J3eCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzFdID09IDYpIHtcbiAgICByaWdodHMuZ3JvdXAgPSAncncnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1sxXSA9PSA1KSB7XG4gICAgcmlnaHRzLmdyb3VwID0gJ3J4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMV0gPT0gNCkge1xuICAgIHJpZ2h0cy5ncm91cCA9ICdyJztcbiAgfSBlbHNlIGlmIChncm91cHNbMV0gPT0gMykge1xuICAgIHJpZ2h0cy5ncm91cCA9ICd3eCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzFdID09IDIpIHtcbiAgICByaWdodHMuZ3JvdXAgPSAndyc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzFdID09IDEpIHtcbiAgICByaWdodHMuZ3JvdXAgPSAneCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzFdID09ICd4Jykge1xuICAgIHJpZ2h0cy5ncm91cCA9IHNlbGYucmlnaHRzLmdyb3VwO1xuICB9IGVsc2Uge1xuICAgIHJpZ2h0cy5ncm91cCA9ICcnO1xuICB9XG5cbiAgaWYgKGdyb3Vwc1syXSA9PSA3KSB7XG4gICAgcmlnaHRzLm90aGVyICs9ICdyd3gnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1syXSA9PSA2KSB7XG4gICAgcmlnaHRzLm90aGVyID0gJ3J3JztcbiAgfSBlbHNlIGlmIChncm91cHNbMl0gPT0gNSkge1xuICAgIHJpZ2h0cy5vdGhlciA9ICdyeCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzJdID09IDQpIHtcbiAgICByaWdodHMub3RoZXIgPSAncic7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzJdID09IDMpIHtcbiAgICByaWdodHMub3RoZXIgPSAnd3gnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1syXSA9PSAyKSB7XG4gICAgcmlnaHRzLm90aGVyID0gJ3cnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1syXSA9PSAxKSB7XG4gICAgcmlnaHRzLm90aGVyID0gJ3gnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1syXSA9PSAneCcpIHtcbiAgICByaWdodHMub3RoZXIgPSBzZWxmLnJpZ2h0cy5vdGhlcjtcbiAgfSBlbHNlIHtcbiAgICByaWdodHMub3RoZXIgPSAnJztcbiAgfVxuXG4gIHJldHVybiByaWdodHM7XG59XG5cbmV4cG9ydCBjb25zdCBwYXJzZUZUUERhdGUgPSAobGluZSkgPT4ge1xuICBjb25zdCBSRV9MSU5FID0gbmV3IFJlZ0V4cChcIl4oXFxcXHd7M30pXFxcXHMrKFxcXFxkezEsMn0pXFxcXHMrKChcXFxcZHsxLDJ9KTooXFxcXGR7MSwyfSkpKihcXFxcZHs0fSkqJFwiKTtcbiAgY29uc3QgTU9OVEhTID0geyBqYW46IDEsIGZlYjogMiwgbWFyOiAzLCBhcHI6IDQsIG1heTogNSwganVuOiA2LCBqdWw6IDcsIGF1ZzogOCwgc2VwOiA5LCBvY3Q6IDEwLCBub3Y6IDExLCBkZWM6IDEyIH07XG4gIGNvbnN0IGdyb3VwcyA9IGxpbmUudHJpbSgpLm1hdGNoKFJFX0xJTkUpXG5cbiAgdHJ5IHtcbiAgICBpZiAoZ3JvdXBzKSB7XG4gICAgICBsZXQgbW9udGggPSBwYXJzZUludChNT05USFNbZ3JvdXBzWzFdLnRvTG93ZXJDYXNlKCldLCAxMCk7XG4gICAgICBsZXQgZGF5ID0gcGFyc2VJbnQoZ3JvdXBzWzJdLCAxMClcbiAgICAgIGxldCB5ZWFyID0gKGdyb3Vwc1s2XSkgPyBwYXJzZUludChncm91cHNbNl0sIDEwKSA6IChuZXcgRGF0ZSgpKS5nZXRGdWxsWWVhcigpO1xuICAgICAgbGV0IGhvdXIgPSAoZ3JvdXBzWzRdKSA/IHBhcnNlSW50KGdyb3Vwc1s0XSwgMTApIDogbnVsbDtcbiAgICAgIGxldCBtaW5zID0gKGdyb3Vwc1s1XSkgPyBwYXJzZUludChncm91cHNbNV0sIDEwKSA6IG51bGw7XG5cbiAgICAgIGlmIChtb250aCA8IDEwKSBtb250aCA9IGAwJHttb250aH1gO1xuICAgICAgaWYgKGRheSA8IDEwKSBkYXkgPSBgMCR7ZGF5fWA7XG4gICAgICBpZiAoaG91ciAmJiBob3VyIDwgMTApIGhvdXIgPSBgMCR7aG91cn1gO1xuICAgICAgaWYgKG1pbnMgJiYgbWlucyA8IDEwKSBtaW5zID0gYDAke21pbnN9YDtcblxuICAgICAgaWYgKGhvdXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fVQke2hvdXJ9OiR7bWluc31gKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShgJHt5ZWFyfS0ke21vbnRofS0ke2RheX1gKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgY29uc3QgZ2V0VGV4dEVkaXRvciA9IChwYXRoT25GaWxlU3lzdGVtLCBhY3RpdmF0ZSA9IGZhbHNlKSA9PiB7XG4gIGxldCBmb3VuZEVkaXRvciA9IG51bGw7XG4gIGxldCB0ZXh0ZWRpdG9ycyA9IGF0b20ud29ya3NwYWNlLmdldFRleHRFZGl0b3JzKCk7XG4gIHRleHRlZGl0b3JzLmZvckVhY2goKHRleHRlZGl0b3IpID0+IHtcbiAgICBpZiAodGV4dGVkaXRvci5nZXRQYXRoKCkgPT0gcGF0aE9uRmlsZVN5c3RlbSkge1xuICAgICAgZm91bmRFZGl0b3IgPSB0ZXh0ZWRpdG9yO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSk7XG5cbiAgaWYgKGFjdGl2YXRlICYmIGZvdW5kRWRpdG9yKSB7XG4gICAgcGFuZSA9IGF0b20ud29ya3NwYWNlLnBhbmVGb3JJdGVtKGZvdW5kRWRpdG9yKTtcbiAgICBpZiAocGFuZSkgcGFuZS5hY3RpdmF0ZUl0ZW0oZm91bmRFZGl0b3IpO1xuICB9XG5cbiAgcmV0dXJuIGZvdW5kRWRpdG9yO1xufVxuXG5leHBvcnQgY29uc3QgZm9yRWFjaEFzeW5jID0gKGFycmF5LCBjYWxsYmFjaykgPT4ge1xuICByZXR1cm4gYXJyYXkucmVkdWNlKChwcm9taXNlLCBpdGVtKSA9PiB7XG4gICAgcmV0dXJuIHByb21pc2UudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soaXRlbSk7XG4gICAgfSk7XG4gIH0sIFByb21pc2UucmVzb2x2ZSgpKTtcbn1cblxuLy8gUmV0dXJuIDEgIGlmIHZlcnNpb25BID4gdmVyc2lvbkJcbi8vIFJldHVybiAwICBpZiB2ZXJzaW9uQSA9PSB2ZXJzaW9uQlxuLy8gUmV0dXJuIC0xIGlmIHZlcnNpb25BIDwgdmVyc2lvbkJcbmV4cG9ydCBjb25zdCBjb21wYXJlVmVyc2lvbnMgPSAodmVyc2lvbkEsIHZlcnNpb25CKSA9PiB7XG4gIGlmICh2ZXJzaW9uQSA9PT0gdmVyc2lvbkIpIHtcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGxldCBwYXJ0c051bWJlckEgPSB2ZXJzaW9uQS5zcGxpdChcIi5cIik7XG4gIGxldCBwYXJ0c051bWJlckIgPSB2ZXJzaW9uQi5zcGxpdChcIi5cIik7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXJ0c051bWJlckEubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgdmFsdWVBID0gcGFyc2VJbnQocGFydHNOdW1iZXJBW2ldKTtcbiAgICBsZXQgdmFsdWVCID0gcGFyc2VJbnQocGFydHNOdW1iZXJCW2ldKTtcblxuICAgIGlmICh2YWx1ZUEgPiB2YWx1ZUIgfHwgaXNOYU4odmFsdWVCKSkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIGlmICh2YWx1ZUEgPCB2YWx1ZUIpIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==