'use babel';

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _this = this;

var atom = global.atom;
var Path = require('path');
var FileSystem = require('fs-plus');
var Minimatch = require('minimatch').Minimatch;

var ignoredPatterns = null;
var ignoredFinderPatterns = null;

var logDebug = function logDebug(param1, param2) {
  if (atom.config.get('ftp-remote-edit.dev.debug')) {
    if (param1 && param2) {
      console.log(param1, param2);
    } else if (param1) {
      console.log(param1);
    }
  }
};

exports.logDebug = logDebug;
var showMessage = function showMessage(msg) {
  var type = arguments.length <= 1 || arguments[1] === undefined ? 'info' : arguments[1];

  if (msg instanceof Error) {
    msg = msg.message;
  }

  if (typeof msg !== 'string') {
    msg = 'Unknown error';
  }

  if (type === 'success') {
    atom.notifications.addSuccess('Ftp-Remote-Edit', {
      description: msg
    });
  } else if (type === 'info') {
    atom.notifications.addInfo('Ftp-Remote-Edit', {
      description: msg
    });
  } else {
    atom.notifications.addError('Ftp-Remote-Edit', {
      description: msg
    });
  }
};

exports.showMessage = showMessage;
var getFullExtension = function getFullExtension(filePath) {
  var fullExtension = '';
  var extension = '';
  while (extension = Path.extname(filePath)) {
    fullExtension = extension + fullExtension;
    filePath = Path.basename(filePath, extension);
  }
  return fullExtension;
};

exports.getFullExtension = getFullExtension;
var createLocalPath = function createLocalPath(localpath) {
  try {
    var arrPath = localpath.split(Path.sep);
    arrPath.pop();

    arrPath.reduce(function (tmpPath, dir) {
      tmpPath += Path.sep + dir;
      if (!FileSystem.existsSync(tmpPath)) {
        FileSystem.mkdirSync(tmpPath);
      }
      return tmpPath;
    });
  } catch (err) {
    return err;
  }
};

exports.createLocalPath = createLocalPath;
var deleteLocalPath = function deleteLocalPath(localpath) {
  try {
    if (FileSystem.existsSync(localpath)) {
      FileSystem.readdirSync(localpath).forEach(function (file, index) {
        var curPath = localpath + "/" + file;
        if (FileSystem.lstatSync(curPath).isDirectory()) {
          // recurse
          return deleteLocalPath(curPath);
        } else {
          // delete file
          FileSystem.unlinkSync(curPath);
        }
      });
      FileSystem.rmdirSync(localpath);
    }
  } catch (err) {
    return err;
  }
};

exports.deleteLocalPath = deleteLocalPath;
var moveLocalPath = function moveLocalPath(srclocalpath, targetlocalpath) {
  try {
    var tmp = targetlocalpath.split(Path.sep);
    tmp.pop();
    var parentPath = tmp.join(Path.sep);

    if (!FileSystem.existsSync(parentPath)) {
      FileSystem.makeTreeSync(parentPath);
    }
    if (FileSystem.existsSync(targetlocalpath)) {
      FileSystem.removeSync(targetlocalpath);
    }
    FileSystem.moveSync(srclocalpath, targetlocalpath);
  } catch (err) {
    return err;
  }
};

exports.moveLocalPath = moveLocalPath;
var resetIgnoredPatterns = function resetIgnoredPatterns() {
  ignoredPatterns = null;
};

exports.resetIgnoredPatterns = resetIgnoredPatterns;
var loadIgnoredPatterns = function loadIgnoredPatterns() {
  var ignoredName = undefined,
      ignoredNames = undefined,
      i = undefined,
      len = undefined,
      results = undefined;

  if (!atom.config.get('ftp-remote-edit.tree.hideIgnoredNames')) {
    return;
  }

  if (ignoredPatterns) return ignoredPatterns;
  if (ignoredPatterns == null) ignoredPatterns = [];

  ignoredNames = atom.config.get('core.ignoredNames') != null ? atom.config.get('core.ignoredNames') : [];
  if (typeof ignoredNames === 'string') {
    ignoredNames = [ignoredNames];
  }
  results = [];
  for (i = 0, len = ignoredNames.length; i < len; i++) {
    ignoredName = ignoredNames[i];
    if (ignoredName) {
      try {
        ignoredPatterns.push(new Minimatch(ignoredName, {
          matchBase: true,
          dot: true
        }));
      } catch (err) {
        console.log(err, "Ftp-Remote-Edit: Error parsing ignore pattern (" + ignoredName + ")");
      }
    }
  }
  return ignoredPatterns;
};

exports.loadIgnoredPatterns = loadIgnoredPatterns;
var isPathIgnored = function isPathIgnored(filePath) {
  if (atom.config.get('ftp-remote-edit.tree.hideIgnoredNames')) {
    var _ignoredPatterns = loadIgnoredPatterns();
    for (i = 0, len = _ignoredPatterns.length; i < len; i++) {
      if (_ignoredPatterns[i].match(filePath)) {
        return true;
      }
    }
  }
  return false;
};

exports.isPathIgnored = isPathIgnored;
var resetIgnoredFinderPatterns = function resetIgnoredFinderPatterns() {
  ignoredFinderPatterns = null;
};

exports.resetIgnoredFinderPatterns = resetIgnoredFinderPatterns;
var loadIgnoredFinderPatterns = function loadIgnoredFinderPatterns() {
  var ignoredName = undefined,
      ignoredNames = undefined,
      ignoredCoreNames = undefined,
      ignoredFinderNames = undefined,
      i = undefined,
      len = undefined,
      results = undefined;

  if (ignoredFinderPatterns) return ignoredFinderPatterns;
  if (ignoredFinderPatterns == null) ignoredFinderPatterns = [];

  if (atom.config.get('ftp-remote-edit.tree.hideIgnoredNames')) {
    ignoredCoreNames = atom.config.get('core.ignoredNames') != null ? atom.config.get('core.ignoredNames') : [];
    if (typeof ignoredCoreNames === 'string') {
      ignoredCoreNames = [ignoredCoreNames];
    }
  } else {
    ignoredCoreNames = [];
  }

  ignoredFinderNames = atom.config.get('ftp-remote-edit.finder.ignoredNames') != null ? atom.config.get('ftp-remote-edit.finder.ignoredNames') : [];
  if (typeof ignoredFinderNames === 'string') {
    ignoredFinderNames = [ignoredFinderNames];
  }

  ignoredNames = [];
  ignoredNames = ignoredCoreNames.concat(ignoredFinderNames);

  results = [];
  for (i = 0, len = ignoredNames.length; i < len; i++) {
    ignoredName = ignoredNames[i];
    if (ignoredName) {
      try {
        ignoredFinderPatterns.push(new Minimatch(ignoredName, {
          matchBase: true,
          dot: true
        }));
      } catch (err) {
        console.log(err, "Ftp-Remote-Edit: Error parsing ignore pattern (" + ignoredName + ")");
      }
    }
  }
  return ignoredFinderPatterns;
};

exports.loadIgnoredFinderPatterns = loadIgnoredFinderPatterns;
var isFinderPathIgnored = function isFinderPathIgnored(filePath) {
  var ignoredPatterns = loadIgnoredFinderPatterns();
  for (i = 0, len = ignoredPatterns.length; i < len; i++) {
    if (ignoredPatterns[i].match(filePath)) {
      return true;
    }
  }

  return false;
};

exports.isFinderPathIgnored = isFinderPathIgnored;
var highlight = function highlight(path, matches, offsetIndex) {
  var lastIndex = 0;
  var matchedChars = [];
  var fragment = document.createDocumentFragment();
  for (var matchIndex of matches) {
    matchIndex -= offsetIndex;
    // If marking up the basename, omit path matches
    if (matchIndex < 0) {
      continue;
    }
    var unmatched = path.substring(lastIndex, matchIndex);
    if (unmatched) {
      if (matchedChars.length > 0) {
        var span = document.createElement('span');
        span.classList.add('character-match');
        span.textContent = matchedChars.join('');
        fragment.appendChild(span);
        matchedChars = [];
      }

      fragment.appendChild(document.createTextNode(unmatched));
    }

    matchedChars.push(path[matchIndex]);
    lastIndex = matchIndex + 1;
  }

  if (matchedChars.length > 0) {
    var span = document.createElement('span');
    span.classList.add('character-match');
    span.textContent = matchedChars.join('');
    fragment.appendChild(span);
  }

  // Remaining characters are plain text
  fragment.appendChild(document.createTextNode(path.substring(lastIndex)));
  return fragment;
};

exports.highlight = highlight;
var rightsToPermissions = function rightsToPermissions(rights) {
  var self = _this;

  if (!rights) return;

  var user = rights.user.split('');
  var group = rights.group.split('');
  var other = rights.other.split('');

  var permissionsuser = 0;
  var permissionsgroup = 0;
  var permissionsother = 0;

  user.forEach(function (right) {
    if (right == 'r') permissionsuser += 4;
    if (right == 'w') permissionsuser += 2;
    if (right == 'x') permissionsuser += 1;
  });

  group.forEach(function (right) {
    if (right == 'r') permissionsgroup += 4;
    if (right == 'w') permissionsgroup += 2;
    if (right == 'x') permissionsgroup += 1;
  });

  other.forEach(function (right) {
    if (right == 'r') permissionsother += 4;
    if (right == 'w') permissionsother += 2;
    if (right == 'x') permissionsother += 1;
  });

  return permissionsuser.toString() + permissionsgroup.toString() + permissionsother.toString();
};

exports.rightsToPermissions = rightsToPermissions;
var permissionsToRights = function permissionsToRights(permissions) {
  var self = _this;

  var groups = permissions.split('');

  var rights = {
    user: "",
    group: "",
    other: ""
  };

  if (groups[0] == 7) {
    rights.user += 'rwx';
  } else if (groups[0] == 6) {
    rights.user = 'rw';
  } else if (groups[0] == 5) {
    rights.user = 'rx';
  } else if (groups[0] == 4) {
    rights.user = 'r';
  } else if (groups[0] == 3) {
    rights.user = 'wx';
  } else if (groups[0] == 2) {
    rights.user = 'w';
  } else if (groups[0] == 1) {
    rights.user = 'x';
  } else if (groups[0] == 'x') {
    rights.user = self.rights.user;
  } else {
    rights.user = '';
  }

  if (groups[1] == 7) {
    rights.group += 'rwx';
  } else if (groups[1] == 6) {
    rights.group = 'rw';
  } else if (groups[1] == 5) {
    rights.group = 'rx';
  } else if (groups[1] == 4) {
    rights.group = 'r';
  } else if (groups[1] == 3) {
    rights.group = 'wx';
  } else if (groups[1] == 2) {
    rights.group = 'w';
  } else if (groups[1] == 1) {
    rights.group = 'x';
  } else if (groups[1] == 'x') {
    rights.group = self.rights.group;
  } else {
    rights.group = '';
  }

  if (groups[2] == 7) {
    rights.other += 'rwx';
  } else if (groups[2] == 6) {
    rights.other = 'rw';
  } else if (groups[2] == 5) {
    rights.other = 'rx';
  } else if (groups[2] == 4) {
    rights.other = 'r';
  } else if (groups[2] == 3) {
    rights.other = 'wx';
  } else if (groups[2] == 2) {
    rights.other = 'w';
  } else if (groups[2] == 1) {
    rights.other = 'x';
  } else if (groups[2] == 'x') {
    rights.other = self.rights.other;
  } else {
    rights.other = '';
  }

  return rights;
};

exports.permissionsToRights = permissionsToRights;
var getTextEditor = function getTextEditor(pathOnFileSystem) {
  var activate = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

  var foundEditor = null;
  var texteditors = atom.workspace.getTextEditors();
  texteditors.forEach(function (texteditor) {
    if (texteditor.getPath() == pathOnFileSystem) {
      foundEditor = texteditor;
      return false;
    }
  });

  if (activate && foundEditor) {
    pane = atom.workspace.paneForItem(foundEditor);
    if (pane) pane.activateItem(foundEditor);
  }

  return foundEditor;
};

exports.getTextEditor = getTextEditor;
var forEachAsync = function forEachAsync(array, callback) {
  return array.reduce(function (promise, item) {
    return promise.then(function (result) {
      return callback(item);
    });
  }, Promise.resolve());
};

exports.forEachAsync = forEachAsync;
// Return 1  if versionA > versionB
// Return 0  if versionA == versionB
// Return -1 if versionA < versionB
var compareVersions = function compareVersions(versionA, versionB) {
  if (versionA === versionB) {
    return 0;
  }

  var partsNumberA = versionA.split(".");
  var partsNumberB = versionB.split(".");

  for (var _i = 0; _i < partsNumberA.length; _i++) {
    var valueA = parseInt(partsNumberA[_i]);
    var valueB = parseInt(partsNumberB[_i]);

    if (valueA > valueB || isNaN(valueB)) {
      return 1;
    }
    if (valueA < valueB) {
      return -1;
    }
  }
};
exports.compareVersions = compareVersions;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdWRwcmF3YXQvLmF0b20vcGFja2FnZXMvZnRwLXJlbW90ZS1lZGl0L2xpYi9oZWxwZXIvaGVscGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFdBQVcsQ0FBQzs7Ozs7Ozs7QUFFWixJQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ3pCLElBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUM3QixJQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDdEMsSUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQzs7QUFFakQsSUFBSSxlQUFlLEdBQUcsSUFBSSxDQUFDO0FBQzNCLElBQUkscUJBQXFCLEdBQUcsSUFBSSxDQUFDOztBQUUxQixJQUFNLFFBQVEsR0FBRyxTQUFYLFFBQVEsQ0FBSSxNQUFNLEVBQUUsTUFBTSxFQUFLO0FBQzFDLE1BQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLENBQUMsRUFBRTtBQUNoRCxRQUFJLE1BQU0sSUFBSSxNQUFNLEVBQUU7QUFDcEIsYUFBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7S0FDN0IsTUFBTSxJQUFJLE1BQU0sRUFBRTtBQUNqQixhQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQ3JCO0dBQ0Y7Q0FDRixDQUFBOzs7QUFFTSxJQUFNLFdBQVcsR0FBRyxTQUFkLFdBQVcsQ0FBSSxHQUFHLEVBQW9CO01BQWxCLElBQUkseURBQUcsTUFBTTs7QUFDNUMsTUFBSSxHQUFHLFlBQVksS0FBSyxFQUFFO0FBQ3hCLE9BQUcsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDO0dBQ25COztBQUVELE1BQUksT0FBTyxHQUFHLEtBQUssUUFBUSxFQUFFO0FBQzNCLE9BQUcsR0FBRyxlQUFlLENBQUM7R0FDdkI7O0FBRUQsTUFB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LElBQUksR0FBRyxJQUFJLENBQUM7R0FDcEIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7R0FDbkIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7R0FDcEIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7R0FDbkIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7R0FDbkIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLEVBQUU7QUFDM0IsVUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztHQUNoQyxNQUFNO0FBQ0wsVUFBTSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7R0FDbEI7O0FBRUQsTUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ2xCLFVBQU0sQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDO0dBQ3ZCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO0dBQ3JCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO0dBQ3JCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO0dBQ3BCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO0dBQ3JCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO0dBQ3BCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO0dBQ3BCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxFQUFFO0FBQzNCLFVBQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7R0FDbEMsTUFBTTtBQUNMLFVBQU0sQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO0dBQ25COztBQUVELE1BQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUNsQixVQUFNLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQztHQUN2QixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztHQUNyQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztHQUNyQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztHQUNwQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztHQUNyQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztHQUNwQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztHQUNwQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsRUFBRTtBQUMzQixVQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0dBQ2xDLE1BQU07QUFDTCxVQUFNLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztHQUNuQjs7QUFFRCxTQUFPLE1BQU0sQ0FBQztDQUNmLENBQUE7OztBQUVNLElBQU0sYUFBYSxHQUFHLFNBQWhCLGFBQWEsQ0FBSSxnQkFBZ0IsRUFBdUI7TUFBckIsUUFBUSx5REFBRyxLQUFLOztBQUM5RCxNQUFJLFdBQVcsR0FBRyxJQUFJLENBQUM7QUFDdkIsTUFBSSxXQUFXLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUNsRCxhQUFXLENBQUMsT0FBTyxDQUFDLFVBQUMsVUFBVSxFQUFLO0FBQ2xDLFFBQUksVUFBVSxDQUFDLE9BQU8sRUFBRSxJQUFJLGdCQUFnQixFQUFFO0FBQzVDLGlCQUFXLEdBQUcsVUFBVSxDQUFDO0FBQ3pCLGFBQU8sS0FBSyxDQUFDO0tBQ2Q7R0FDRixDQUFDLENBQUM7O0FBRUgsTUFBSSxRQUFRLElBQUksV0FBVyxFQUFFO0FBQzNCLFFBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUMvQyxRQUFJLElBQUksRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0dBQzFDOztBQUVELFNBQU8sV0FBVyxDQUFDO0NBQ3BCLENBQUE7OztBQUVNLElBQU0sWUFBWSxHQUFHLFNBQWYsWUFBWSxDQUFJLEtBQUssRUFBRSxRQUFRLEVBQUs7QUFDL0MsU0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsT0FBTyxFQUFFLElBQUksRUFBSztBQUNyQyxXQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBQyxNQUFNLEVBQUs7QUFDOUIsYUFBTyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDdkIsQ0FBQyxDQUFDO0dBQ0osRUFBRSxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztDQUN2QixDQUFBOzs7Ozs7QUFLTSxJQUFNLGVBQWUsR0FBRyxTQUFsQixlQUFlLENBQUksUUFBUSxFQUFFLFFBQVEsRUFBSztBQUNyRCxNQUFJLFFBQVEsS0FBSyxRQUFRLEVBQUU7QUFDekIsV0FBTyxDQUFDLENBQUM7R0FDVjs7QUFFRCxNQUFJLFlBQVksR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZDLE1BQUksWUFBWSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7O0FBRXZDLE9BQUssSUFBSSxFQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUMsR0FBRyxZQUFZLENBQUMsTUFBTSxFQUFFLEVBQUMsRUFBRSxFQUFFO0FBQzVDLFFBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxZQUFZLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQztBQUN2QyxRQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsWUFBWSxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7O0FBRXZDLFFBQUksTUFBTSxHQUFHLE1BQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7QUFDcEMsYUFBTyxDQUFDLENBQUM7S0FDVjtBQUNELFFBQUksTUFBTSxHQUFHLE1BQU0sRUFBRTtBQUNuQixhQUFPLENBQUMsQ0FBQyxDQUFDO0tBQ1g7R0FDRjtDQUNGLENBQUEiLCJmaWxlIjoiL1VzZXJzL3N1ZHByYXdhdC8uYXRvbS9wYWNrYWdlcy9mdHAtcmVtb3RlLWVkaXQvbGliL2hlbHBlci9oZWxwZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJztcblxuY29uc3QgYXRvbSA9IGdsb2JhbC5hdG9tO1xuY29uc3QgUGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IEZpbGVTeXN0ZW0gPSByZXF1aXJlKCdmcy1wbHVzJyk7XG5jb25zdCBNaW5pbWF0Y2ggPSByZXF1aXJlKCdtaW5pbWF0Y2gnKS5NaW5pbWF0Y2g7XG5cbmxldCBpZ25vcmVkUGF0dGVybnMgPSBudWxsO1xubGV0IGlnbm9yZWRGaW5kZXJQYXR0ZXJucyA9IG51bGw7XG5cbmV4cG9ydCBjb25zdCBsb2dEZWJ1ZyA9IChwYXJhbTEsIHBhcmFtMikgPT4ge1xuICBpZiAoYXRvbS5jb25maWcuZ2V0KCdmdHAtcmVtb3RlLWVkaXQuZGV2LmRlYnVnJykpIHtcbiAgICBpZiAocGFyYW0xICYmIHBhcmFtMikge1xuICAgICAgY29uc29sZS5sb2cocGFyYW0xLCBwYXJhbTIpO1xuICAgIH0gZWxzZSBpZiAocGFyYW0xKSB7XG4gICAgICBjb25zb2xlLmxvZyhwYXJhbTEpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY29uc3Qgc2hvd01lc3NhZ2UgPSAobXNnLCB0eXBlID0gJ2luZm8nKSA9PiB7XG4gIGlmIChtc2cgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIG1zZyA9IG1zZy5tZXNzYWdlO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBtc2cgIT09ICdzdHJpbmcnKSB7XG4gICAgbXNnID0gJ1Vua25vd24gZXJyb3InO1xuICB9XG5cbiAgaWYgKHR5cGUgPT09ICdzdWNjZXNzJykge1xuICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRTdWNjZXNzKCdGdHAtUmVtb3RlLUVkaXQnLCB7XG4gICAgICBkZXNjcmlwdGlvbjogbXNnXG4gICAgfSk7XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2luZm8nKSB7XG4gICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEluZm8oJ0Z0cC1SZW1vdGUtRWRpdCcsIHtcbiAgICAgIGRlc2NyaXB0aW9uOiBtc2dcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkRXJyb3IoJ0Z0cC1SZW1vdGUtRWRpdCcsIHtcbiAgICAgIGRlc2NyaXB0aW9uOiBtc2csXG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGdldEZ1bGxFeHRlbnNpb24gPSAoZmlsZVBhdGgpID0+IHtcbiAgbGV0IGZ1bGxFeHRlbnNpb24gPSAnJztcbiAgbGV0IGV4dGVuc2lvbiA9ICcnO1xuICB3aGlsZSAoZXh0ZW5zaW9uID0gUGF0aC5leHRuYW1lKGZpbGVQYXRoKSkge1xuICAgIGZ1bGxFeHRlbnNpb24gPSBleHRlbnNpb24gKyBmdWxsRXh0ZW5zaW9uXG4gICAgZmlsZVBhdGggPSBQYXRoLmJhc2VuYW1lKGZpbGVQYXRoLCBleHRlbnNpb24pXG4gIH1cbiAgcmV0dXJuIGZ1bGxFeHRlbnNpb247XG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVMb2NhbFBhdGggPSAobG9jYWxwYXRoKSA9PiB7XG4gIHRyeSB7XG4gICAgbGV0IGFyclBhdGggPSBsb2NhbHBhdGguc3BsaXQoUGF0aC5zZXApO1xuICAgIGFyclBhdGgucG9wKCk7XG5cbiAgICBhcnJQYXRoLnJlZHVjZSgodG1wUGF0aCwgZGlyKSA9PiB7XG4gICAgICB0bXBQYXRoICs9IFBhdGguc2VwICsgZGlyO1xuICAgICAgaWYgKCFGaWxlU3lzdGVtLmV4aXN0c1N5bmModG1wUGF0aCkpIHtcbiAgICAgICAgRmlsZVN5c3RlbS5ta2RpclN5bmModG1wUGF0aCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG1wUGF0aDtcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyKSB7IHJldHVybiBlcnI7IH1cbn1cblxuZXhwb3J0IGNvbnN0IGRlbGV0ZUxvY2FsUGF0aCA9IChsb2NhbHBhdGgpID0+IHtcbiAgdHJ5IHtcbiAgICBpZiAoRmlsZVN5c3RlbS5leGlzdHNTeW5jKGxvY2FscGF0aCkpIHtcbiAgICAgIEZpbGVTeXN0ZW0ucmVhZGRpclN5bmMobG9jYWxwYXRoKS5mb3JFYWNoKChmaWxlLCBpbmRleCkgPT4ge1xuICAgICAgICBsZXQgY3VyUGF0aCA9IGxvY2FscGF0aCArIFwiL1wiICsgZmlsZTtcbiAgICAgICAgaWYgKEZpbGVTeXN0ZW0ubHN0YXRTeW5jKGN1clBhdGgpLmlzRGlyZWN0b3J5KCkpIHsgLy8gcmVjdXJzZVxuICAgICAgICAgIHJldHVybiBkZWxldGVMb2NhbFBhdGgoY3VyUGF0aCk7XG4gICAgICAgIH0gZWxzZSB7IC8vIGRlbGV0ZSBmaWxlXG4gICAgICAgICAgRmlsZVN5c3RlbS51bmxpbmtTeW5jKGN1clBhdGgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIEZpbGVTeXN0ZW0ucm1kaXJTeW5jKGxvY2FscGF0aCk7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHsgcmV0dXJuIGVycjsgfVxufVxuXG5leHBvcnQgY29uc3QgbW92ZUxvY2FsUGF0aCA9IChzcmNsb2NhbHBhdGgsIHRhcmdldGxvY2FscGF0aCkgPT4ge1xuICB0cnkge1xuICAgIGxldCB0bXAgPSB0YXJnZXRsb2NhbHBhdGguc3BsaXQoUGF0aC5zZXApO1xuICAgIHRtcC5wb3AoKTtcbiAgICBsZXQgcGFyZW50UGF0aCA9IHRtcC5qb2luKFBhdGguc2VwKTtcblxuICAgIGlmICghRmlsZVN5c3RlbS5leGlzdHNTeW5jKHBhcmVudFBhdGgpKSB7XG4gICAgICBGaWxlU3lzdGVtLm1ha2VUcmVlU3luYyhwYXJlbnRQYXRoKTtcbiAgICB9XG4gICAgaWYgKEZpbGVTeXN0ZW0uZXhpc3RzU3luYyh0YXJnZXRsb2NhbHBhdGgpKSB7XG4gICAgICBGaWxlU3lzdGVtLnJlbW92ZVN5bmModGFyZ2V0bG9jYWxwYXRoKTtcbiAgICB9XG4gICAgRmlsZVN5c3RlbS5tb3ZlU3luYyhzcmNsb2NhbHBhdGgsIHRhcmdldGxvY2FscGF0aCk7XG4gIH0gY2F0Y2ggKGVycikgeyByZXR1cm4gZXJyOyB9XG59XG5cbmV4cG9ydCBjb25zdCByZXNldElnbm9yZWRQYXR0ZXJucyA9ICgpID0+IHtcbiAgaWdub3JlZFBhdHRlcm5zID0gbnVsbDtcbn1cblxuZXhwb3J0IGNvbnN0IGxvYWRJZ25vcmVkUGF0dGVybnMgPSAoKSA9PiB7XG4gIGxldCBpZ25vcmVkTmFtZSwgaWdub3JlZE5hbWVzLCBpLCBsZW4sIHJlc3VsdHM7XG5cbiAgaWYgKCFhdG9tLmNvbmZpZy5nZXQoJ2Z0cC1yZW1vdGUtZWRpdC50cmVlLmhpZGVJZ25vcmVkTmFtZXMnKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChpZ25vcmVkUGF0dGVybnMpIHJldHVybiBpZ25vcmVkUGF0dGVybnM7XG4gIGlmIChpZ25vcmVkUGF0dGVybnMgPT0gbnVsbCkgaWdub3JlZFBhdHRlcm5zID0gW107XG5cbiAgaWdub3JlZE5hbWVzID0gKGF0b20uY29uZmlnLmdldCgnY29yZS5pZ25vcmVkTmFtZXMnKSkgIT0gbnVsbCA/IGF0b20uY29uZmlnLmdldCgnY29yZS5pZ25vcmVkTmFtZXMnKSA6IFtdO1xuICBpZiAodHlwZW9mIGlnbm9yZWROYW1lcyA9PT0gJ3N0cmluZycpIHtcbiAgICBpZ25vcmVkTmFtZXMgPSBbaWdub3JlZE5hbWVzXTtcbiAgfVxuICByZXN1bHRzID0gW107XG4gIGZvciAoaSA9IDAsIGxlbiA9IGlnbm9yZWROYW1lcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIGlnbm9yZWROYW1lID0gaWdub3JlZE5hbWVzW2ldO1xuICAgIGlmIChpZ25vcmVkTmFtZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWdub3JlZFBhdHRlcm5zLnB1c2gobmV3IE1pbmltYXRjaChpZ25vcmVkTmFtZSwge1xuICAgICAgICAgIG1hdGNoQmFzZTogdHJ1ZSxcbiAgICAgICAgICBkb3Q6IHRydWVcbiAgICAgICAgfSkpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVyciwgXCJGdHAtUmVtb3RlLUVkaXQ6IEVycm9yIHBhcnNpbmcgaWdub3JlIHBhdHRlcm4gKFwiICsgaWdub3JlZE5hbWUgKyBcIilcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBpZ25vcmVkUGF0dGVybnM7XG59XG5cbmV4cG9ydCBjb25zdCBpc1BhdGhJZ25vcmVkID0gKGZpbGVQYXRoKSA9PiB7XG4gIGlmIChhdG9tLmNvbmZpZy5nZXQoJ2Z0cC1yZW1vdGUtZWRpdC50cmVlLmhpZGVJZ25vcmVkTmFtZXMnKSkge1xuICAgIGxldCBpZ25vcmVkUGF0dGVybnMgPSBsb2FkSWdub3JlZFBhdHRlcm5zKCk7XG4gICAgZm9yIChpID0gMCwgbGVuID0gaWdub3JlZFBhdHRlcm5zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBpZiAoaWdub3JlZFBhdHRlcm5zW2ldLm1hdGNoKGZpbGVQYXRoKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgY29uc3QgcmVzZXRJZ25vcmVkRmluZGVyUGF0dGVybnMgPSAoKSA9PiB7XG4gIGlnbm9yZWRGaW5kZXJQYXR0ZXJucyA9IG51bGw7XG59XG5cbmV4cG9ydCBjb25zdCBsb2FkSWdub3JlZEZpbmRlclBhdHRlcm5zID0gKCkgPT4ge1xuICBsZXQgaWdub3JlZE5hbWUsIGlnbm9yZWROYW1lcywgaWdub3JlZENvcmVOYW1lcywgaWdub3JlZEZpbmRlck5hbWVzLCBpLCBsZW4sIHJlc3VsdHM7XG5cbiAgaWYgKGlnbm9yZWRGaW5kZXJQYXR0ZXJucykgcmV0dXJuIGlnbm9yZWRGaW5kZXJQYXR0ZXJucztcbiAgaWYgKGlnbm9yZWRGaW5kZXJQYXR0ZXJucyA9PSBudWxsKSBpZ25vcmVkRmluZGVyUGF0dGVybnMgPSBbXTtcblxuICBpZiAoYXRvbS5jb25maWcuZ2V0KCdmdHAtcmVtb3RlLWVkaXQudHJlZS5oaWRlSWdub3JlZE5hbWVzJykpIHtcbiAgICBpZ25vcmVkQ29yZU5hbWVzID0gKGF0b20uY29uZmlnLmdldCgnY29yZS5pZ25vcmVkTmFtZXMnKSkgIT0gbnVsbCA/IGF0b20uY29uZmlnLmdldCgnY29yZS5pZ25vcmVkTmFtZXMnKSA6IFtdO1xuICAgIGlmICh0eXBlb2YgaWdub3JlZENvcmVOYW1lcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGlnbm9yZWRDb3JlTmFtZXMgPSBbaWdub3JlZENvcmVOYW1lc107XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGlnbm9yZWRDb3JlTmFtZXMgPSBbXTtcbiAgfVxuXG4gIGlnbm9yZWRGaW5kZXJOYW1lcyA9IChhdG9tLmNvbmZpZy5nZXQoJ2Z0cC1yZW1vdGUtZWRpdC5maW5kZXIuaWdub3JlZE5hbWVzJykpICE9IG51bGwgPyBhdG9tLmNvbmZpZy5nZXQoJ2Z0cC1yZW1vdGUtZWRpdC5maW5kZXIuaWdub3JlZE5hbWVzJykgOiBbXTtcbiAgaWYgKHR5cGVvZiBpZ25vcmVkRmluZGVyTmFtZXMgPT09ICdzdHJpbmcnKSB7XG4gICAgaWdub3JlZEZpbmRlck5hbWVzID0gW2lnbm9yZWRGaW5kZXJOYW1lc107XG4gIH1cblxuICBpZ25vcmVkTmFtZXMgPSBbXTtcbiAgaWdub3JlZE5hbWVzID0gaWdub3JlZENvcmVOYW1lcy5jb25jYXQoaWdub3JlZEZpbmRlck5hbWVzKTtcblxuICByZXN1bHRzID0gW107XG4gIGZvciAoaSA9IDAsIGxlbiA9IGlnbm9yZWROYW1lcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIGlnbm9yZWROYW1lID0gaWdub3JlZE5hbWVzW2ldO1xuICAgIGlmIChpZ25vcmVkTmFtZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWdub3JlZEZpbmRlclBhdHRlcm5zLnB1c2gobmV3IE1pbmltYXRjaChpZ25vcmVkTmFtZSwge1xuICAgICAgICAgIG1hdGNoQmFzZTogdHJ1ZSxcbiAgICAgICAgICBkb3Q6IHRydWVcbiAgICAgICAgfSkpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVyciwgXCJGdHAtUmVtb3RlLUVkaXQ6IEVycm9yIHBhcnNpbmcgaWdub3JlIHBhdHRlcm4gKFwiICsgaWdub3JlZE5hbWUgKyBcIilcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBpZ25vcmVkRmluZGVyUGF0dGVybnM7XG59XG5cbmV4cG9ydCBjb25zdCBpc0ZpbmRlclBhdGhJZ25vcmVkID0gKGZpbGVQYXRoKSA9PiB7XG4gIGxldCBpZ25vcmVkUGF0dGVybnMgPSBsb2FkSWdub3JlZEZpbmRlclBhdHRlcm5zKCk7XG4gIGZvciAoaSA9IDAsIGxlbiA9IGlnbm9yZWRQYXR0ZXJucy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIGlmIChpZ25vcmVkUGF0dGVybnNbaV0ubWF0Y2goZmlsZVBhdGgpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBjb25zdCBoaWdobGlnaHQgPSAocGF0aCwgbWF0Y2hlcywgb2Zmc2V0SW5kZXgpID0+IHtcbiAgbGV0IGxhc3RJbmRleCA9IDA7XG4gIGxldCBtYXRjaGVkQ2hhcnMgPSBbXTtcbiAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gIGZvciAobGV0IG1hdGNoSW5kZXggb2YgbWF0Y2hlcykge1xuICAgIG1hdGNoSW5kZXggLT0gb2Zmc2V0SW5kZXg7XG4gICAgLy8gSWYgbWFya2luZyB1cCB0aGUgYmFzZW5hbWUsIG9taXQgcGF0aCBtYXRjaGVzXG4gICAgaWYgKG1hdGNoSW5kZXggPCAwKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgY29uc3QgdW5tYXRjaGVkID0gcGF0aC5zdWJzdHJpbmcobGFzdEluZGV4LCBtYXRjaEluZGV4KTtcbiAgICBpZiAodW5tYXRjaGVkKSB7XG4gICAgICBpZiAobWF0Y2hlZENoYXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgc3Bhbi5jbGFzc0xpc3QuYWRkKCdjaGFyYWN0ZXItbWF0Y2gnKTtcbiAgICAgICAgc3Bhbi50ZXh0Q29udGVudCA9IG1hdGNoZWRDaGFycy5qb2luKCcnKTtcbiAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoc3Bhbik7XG4gICAgICAgIG1hdGNoZWRDaGFycyA9IFtdO1xuICAgICAgfVxuXG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh1bm1hdGNoZWQpKVxuICAgIH1cblxuICAgIG1hdGNoZWRDaGFycy5wdXNoKHBhdGhbbWF0Y2hJbmRleF0pO1xuICAgIGxhc3RJbmRleCA9IG1hdGNoSW5kZXggKyAxO1xuICB9XG5cbiAgaWYgKG1hdGNoZWRDaGFycy5sZW5ndGggPiAwKSB7XG4gICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICBzcGFuLmNsYXNzTGlzdC5hZGQoJ2NoYXJhY3Rlci1tYXRjaCcpO1xuICAgIHNwYW4udGV4dENvbnRlbnQgPSBtYXRjaGVkQ2hhcnMuam9pbignJyk7XG4gICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoc3Bhbik7XG4gIH1cblxuICAvLyBSZW1haW5pbmcgY2hhcmFjdGVycyBhcmUgcGxhaW4gdGV4dFxuICBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShwYXRoLnN1YnN0cmluZyhsYXN0SW5kZXgpKSk7XG4gIHJldHVybiBmcmFnbWVudDtcbn1cblxuZXhwb3J0IGNvbnN0IHJpZ2h0c1RvUGVybWlzc2lvbnMgPSAocmlnaHRzKSA9PiB7XG4gIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gIGlmICghcmlnaHRzKSByZXR1cm47XG5cbiAgbGV0IHVzZXIgPSByaWdodHMudXNlci5zcGxpdCgnJyk7XG4gIGxldCBncm91cCA9IHJpZ2h0cy5ncm91cC5zcGxpdCgnJyk7XG4gIGxldCBvdGhlciA9IHJpZ2h0cy5vdGhlci5zcGxpdCgnJyk7XG5cbiAgbGV0IHBlcm1pc3Npb25zdXNlciA9IDA7XG4gIGxldCBwZXJtaXNzaW9uc2dyb3VwID0gMDtcbiAgbGV0IHBlcm1pc3Npb25zb3RoZXIgPSAwO1xuXG4gIHVzZXIuZm9yRWFjaCgocmlnaHQpID0+IHtcbiAgICBpZiAocmlnaHQgPT0gJ3InKSBwZXJtaXNzaW9uc3VzZXIgKz0gNDtcbiAgICBpZiAocmlnaHQgPT0gJ3cnKSBwZXJtaXNzaW9uc3VzZXIgKz0gMjtcbiAgICBpZiAocmlnaHQgPT0gJ3gnKSBwZXJtaXNzaW9uc3VzZXIgKz0gMTtcbiAgfSk7XG5cbiAgZ3JvdXAuZm9yRWFjaCgocmlnaHQpID0+IHtcbiAgICBpZiAocmlnaHQgPT0gJ3InKSBwZXJtaXNzaW9uc2dyb3VwICs9IDQ7XG4gICAgaWYgKHJpZ2h0ID09ICd3JykgcGVybWlzc2lvbnNncm91cCArPSAyO1xuICAgIGlmIChyaWdodCA9PSAneCcpIHBlcm1pc3Npb25zZ3JvdXAgKz0gMTtcbiAgfSk7XG5cbiAgb3RoZXIuZm9yRWFjaCgocmlnaHQpID0+IHtcbiAgICBpZiAocmlnaHQgPT0gJ3InKSBwZXJtaXNzaW9uc290aGVyICs9IDQ7XG4gICAgaWYgKHJpZ2h0ID09ICd3JykgcGVybWlzc2lvbnNvdGhlciArPSAyO1xuICAgIGlmIChyaWdodCA9PSAneCcpIHBlcm1pc3Npb25zb3RoZXIgKz0gMTtcbiAgfSk7XG5cbiAgcmV0dXJuIHBlcm1pc3Npb25zdXNlci50b1N0cmluZygpICsgcGVybWlzc2lvbnNncm91cC50b1N0cmluZygpICsgcGVybWlzc2lvbnNvdGhlci50b1N0cmluZygpO1xufVxuXG5leHBvcnQgY29uc3QgcGVybWlzc2lvbnNUb1JpZ2h0cyA9IChwZXJtaXNzaW9ucykgPT4ge1xuICBjb25zdCBzZWxmID0gdGhpcztcblxuICBsZXQgZ3JvdXBzID0gcGVybWlzc2lvbnMuc3BsaXQoJycpO1xuXG4gIGxldCByaWdodHMgPSB7XG4gICAgdXNlcjogXCJcIixcbiAgICBncm91cDogXCJcIixcbiAgICBvdGhlcjogXCJcIixcbiAgfVxuXG4gIGlmIChncm91cHNbMF0gPT0gNykge1xuICAgIHJpZ2h0cy51c2VyICs9ICdyd3gnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1swXSA9PSA2KSB7XG4gICAgcmlnaHRzLnVzZXIgPSAncncnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1swXSA9PSA1KSB7XG4gICAgcmlnaHRzLnVzZXIgPSAncngnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1swXSA9PSA0KSB7XG4gICAgcmlnaHRzLnVzZXIgPSAncic7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzBdID09IDMpIHtcbiAgICByaWdodHMudXNlciA9ICd3eCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzBdID09IDIpIHtcbiAgICByaWdodHMudXNlciA9ICd3JztcbiAgfSBlbHNlIGlmIChncm91cHNbMF0gPT0gMSkge1xuICAgIHJpZ2h0cy51c2VyID0gJ3gnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1swXSA9PSAneCcpIHtcbiAgICByaWdodHMudXNlciA9IHNlbGYucmlnaHRzLnVzZXI7XG4gIH0gZWxzZSB7XG4gICAgcmlnaHRzLnVzZXIgPSAnJztcbiAgfVxuXG4gIGlmIChncm91cHNbMV0gPT0gNykge1xuICAgIHJpZ2h0cy5ncm91cCArPSAncnd4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMV0gPT0gNikge1xuICAgIHJpZ2h0cy5ncm91cCA9ICdydyc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzFdID09IDUpIHtcbiAgICByaWdodHMuZ3JvdXAgPSAncngnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1sxXSA9PSA0KSB7XG4gICAgcmlnaHRzLmdyb3VwID0gJ3InO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1sxXSA9PSAzKSB7XG4gICAgcmlnaHRzLmdyb3VwID0gJ3d4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMV0gPT0gMikge1xuICAgIHJpZ2h0cy5ncm91cCA9ICd3JztcbiAgfSBlbHNlIGlmIChncm91cHNbMV0gPT0gMSkge1xuICAgIHJpZ2h0cy5ncm91cCA9ICd4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMV0gPT0gJ3gnKSB7XG4gICAgcmlnaHRzLmdyb3VwID0gc2VsZi5yaWdodHMuZ3JvdXA7XG4gIH0gZWxzZSB7XG4gICAgcmlnaHRzLmdyb3VwID0gJyc7XG4gIH1cblxuICBpZiAoZ3JvdXBzWzJdID09IDcpIHtcbiAgICByaWdodHMub3RoZXIgKz0gJ3J3eCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzJdID09IDYpIHtcbiAgICByaWdodHMub3RoZXIgPSAncncnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1syXSA9PSA1KSB7XG4gICAgcmlnaHRzLm90aGVyID0gJ3J4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMl0gPT0gNCkge1xuICAgIHJpZ2h0cy5vdGhlciA9ICdyJztcbiAgfSBlbHNlIGlmIChncm91cHNbMl0gPT0gMykge1xuICAgIHJpZ2h0cy5vdGhlciA9ICd3eCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzJdID09IDIpIHtcbiAgICByaWdodHMub3RoZXIgPSAndyc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzJdID09IDEpIHtcbiAgICByaWdodHMub3RoZXIgPSAneCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzJdID09ICd4Jykge1xuICAgIHJpZ2h0cy5vdGhlciA9IHNlbGYucmlnaHRzLm90aGVyO1xuICB9IGVsc2Uge1xuICAgIHJpZ2h0cy5vdGhlciA9ICcnO1xuICB9XG5cbiAgcmV0dXJuIHJpZ2h0cztcbn1cblxuZXhwb3J0IGNvbnN0IGdldFRleHRFZGl0b3IgPSAocGF0aE9uRmlsZVN5c3RlbSwgYWN0aXZhdGUgPSBmYWxzZSkgPT4ge1xuICBsZXQgZm91bmRFZGl0b3IgPSBudWxsO1xuICBsZXQgdGV4dGVkaXRvcnMgPSBhdG9tLndvcmtzcGFjZS5nZXRUZXh0RWRpdG9ycygpO1xuICB0ZXh0ZWRpdG9ycy5mb3JFYWNoKCh0ZXh0ZWRpdG9yKSA9PiB7XG4gICAgaWYgKHRleHRlZGl0b3IuZ2V0UGF0aCgpID09IHBhdGhPbkZpbGVTeXN0ZW0pIHtcbiAgICAgIGZvdW5kRWRpdG9yID0gdGV4dGVkaXRvcjtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0pO1xuXG4gIGlmIChhY3RpdmF0ZSAmJiBmb3VuZEVkaXRvcikge1xuICAgIHBhbmUgPSBhdG9tLndvcmtzcGFjZS5wYW5lRm9ySXRlbShmb3VuZEVkaXRvcik7XG4gICAgaWYgKHBhbmUpIHBhbmUuYWN0aXZhdGVJdGVtKGZvdW5kRWRpdG9yKTtcbiAgfVxuXG4gIHJldHVybiBmb3VuZEVkaXRvcjtcbn1cblxuZXhwb3J0IGNvbnN0IGZvckVhY2hBc3luYyA9IChhcnJheSwgY2FsbGJhY2spID0+IHtcbiAgcmV0dXJuIGFycmF5LnJlZHVjZSgocHJvbWlzZSwgaXRlbSkgPT4ge1xuICAgIHJldHVybiBwcm9taXNlLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGl0ZW0pO1xuICAgIH0pO1xuICB9LCBQcm9taXNlLnJlc29sdmUoKSk7XG59XG5cbi8vIFJldHVybiAxICBpZiB2ZXJzaW9uQSA+IHZlcnNpb25CXG4vLyBSZXR1cm4gMCAgaWYgdmVyc2lvbkEgPT0gdmVyc2lvbkJcbi8vIFJldHVybiAtMSBpZiB2ZXJzaW9uQSA8IHZlcnNpb25CXG5leHBvcnQgY29uc3QgY29tcGFyZVZlcnNpb25zID0gKHZlcnNpb25BLCB2ZXJzaW9uQikgPT4ge1xuICBpZiAodmVyc2lvbkEgPT09IHZlcnNpb25CKSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICBsZXQgcGFydHNOdW1iZXJBID0gdmVyc2lvbkEuc3BsaXQoXCIuXCIpO1xuICBsZXQgcGFydHNOdW1iZXJCID0gdmVyc2lvbkIuc3BsaXQoXCIuXCIpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcGFydHNOdW1iZXJBLmxlbmd0aDsgaSsrKSB7XG4gICAgbGV0IHZhbHVlQSA9IHBhcnNlSW50KHBhcnRzTnVtYmVyQVtpXSk7XG4gICAgbGV0IHZhbHVlQiA9IHBhcnNlSW50KHBhcnRzTnVtYmVyQltpXSk7XG5cbiAgICBpZiAodmFsdWVBID4gdmFsdWVCIHx8IGlzTmFOKHZhbHVlQikpIHtcbiAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgICBpZiAodmFsdWVBIDwgdmFsdWVCKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfVxuICB9XG59XG4iXX0=