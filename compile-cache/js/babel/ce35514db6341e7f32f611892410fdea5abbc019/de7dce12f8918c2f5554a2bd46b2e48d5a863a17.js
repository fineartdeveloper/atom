Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.activate = activate;
exports.provideAutocomplete = provideAutocomplete;
exports.provideJsonSchemaProviders = provideJsonSchemaProviders;
exports.provideProposalProviders = provideProposalProviders;
exports.consumeJsonSchemaProviders = consumeJsonSchemaProviders;
exports.consumeJsonProposalProviders = consumeJsonProposalProviders;
exports.dispose = dispose;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _lodashIsArray = require('lodash/isArray');

var _lodashIsArray2 = _interopRequireDefault(_lodashIsArray);

var _lodashRemove = require('lodash/remove');

var _lodashRemove2 = _interopRequireDefault(_lodashRemove);

var _atom = require('atom');

var _rootProvider = require('./root-provider');

var _rootProvider2 = _interopRequireDefault(_rootProvider);

var _jsonSchemaProposalProvider = require('./json-schema-proposal-provider');

var _providers = require('./providers');

'use babel';

var PROVIDERS = null;

function activate() {
  PROVIDERS = [];
}

function provideAutocomplete() {
  return new _rootProvider2['default'](PROVIDERS);
}

function provideJsonSchemaProviders() {
  return _providers.defaultSchemaProviders;
}

function provideProposalProviders() {
  return _providers.defaultProviders;
}

function createPromiseDisposable(promise) {
  return new _atom.Disposable(function () {
    promise.then(function (provider) {
      return (0, _lodashRemove2['default'])(PROVIDERS, function (e) {
        return e === provider;
      });
    });
  });
}

function createSyncDisposable(provider) {
  return new _atom.Disposable(function () {
    (0, _lodashRemove2['default'])(PROVIDERS, function (e) {
      return e === provider;
    });
  });
}

function createCompositeDisposable(providers) {
  var composite = new _atom.CompositeDisposable();
  providers.forEach(function (disposable) {
    return composite.add(disposable);
  });
  return composite;
}

function consumeJsonSchemaProviders(provider) {
  var schemaProviders = (0, _lodashIsArray2['default'])(provider) ? provider : [provider];
  var providerPromises = schemaProviders.filter(function (s) {
    return Boolean(s);
  }).map(function (s) {
    return _jsonSchemaProposalProvider.JsonSchemaProposalProvider.createFromProvider(s);
  });
  providerPromises.forEach(function (promise) {
    return promise.then(function (p) {
      return PROVIDERS.push(p);
    });
  });
  var disposables = providerPromises.map(function (promise) {
    return createPromiseDisposable(promise);
  });
  return createCompositeDisposable(disposables);
}

function consumeJsonProposalProviders(provider) {
  var providers = ((0, _lodashIsArray2['default'])(provider) ? provider : [provider]).filter(function (p) {
    return Boolean(p);
  });
  providers.forEach(function (p) {
    return PROVIDERS.push(p);
  });
  return createCompositeDisposable(providers.map(function (p) {
    return createSyncDisposable(p);
  }));
}

function dispose() {
  PROVIDERS.length = 0;
  PROVIDERS = null;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdWRwcmF3YXQvLmF0b20vcGFja2FnZXMvYXV0b2NvbXBsZXRlLWpzb24vc3JjL21haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs2QkFFb0IsZ0JBQWdCOzs7OzRCQUNqQixlQUFlOzs7O29CQUNjLE1BQU07OzRCQUU3QixpQkFBaUI7Ozs7MENBQ0MsaUNBQWlDOzt5QkFDbkIsYUFBYTs7QUFSdEUsV0FBVyxDQUFBOztBQVVYLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQTs7QUFFYixTQUFTLFFBQVEsR0FBRztBQUN6QixXQUFTLEdBQUcsRUFBRSxDQUFBO0NBQ2Y7O0FBRU0sU0FBUyxtQkFBbUIsR0FBRztBQUNwQyxTQUFPLDhCQUFpQixTQUFTLENBQUMsQ0FBQTtDQUNuQzs7QUFFTSxTQUFTLDBCQUEwQixHQUFHO0FBQzNDLDJDQUE2QjtDQUM5Qjs7QUFFTSxTQUFTLHdCQUF3QixHQUFHO0FBQ3pDLHFDQUF1QjtDQUN4Qjs7QUFFRCxTQUFTLHVCQUF1QixDQUFDLE9BQU8sRUFBRTtBQUN4QyxTQUFPLHFCQUFlLFlBQU07QUFDMUIsV0FBTyxDQUFDLElBQUksQ0FBQyxVQUFBLFFBQVE7YUFBSSwrQkFBTyxTQUFTLEVBQUUsVUFBQSxDQUFDO2VBQUksQ0FBQyxLQUFLLFFBQVE7T0FBQSxDQUFDO0tBQUEsQ0FBQyxDQUFBO0dBQ2pFLENBQUMsQ0FBQTtDQUNIOztBQUVELFNBQVMsb0JBQW9CLENBQUMsUUFBUSxFQUFFO0FBQ3RDLFNBQU8scUJBQWUsWUFBTTtBQUMxQixtQ0FBTyxTQUFTLEVBQUUsVUFBQSxDQUFDO2FBQUksQ0FBQyxLQUFLLFFBQVE7S0FBQSxDQUFDLENBQUE7R0FDdkMsQ0FBQyxDQUFBO0NBQ0g7O0FBRUQsU0FBUyx5QkFBeUIsQ0FBQyxTQUFTLEVBQUU7QUFDNUMsTUFBTSxTQUFTLEdBQUcsK0JBQXlCLENBQUE7QUFDM0MsV0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFBLFVBQVU7V0FBSSxTQUFTLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQztHQUFBLENBQUMsQ0FBQTtBQUMxRCxTQUFPLFNBQVMsQ0FBQTtDQUNqQjs7QUFFTSxTQUFTLDBCQUEwQixDQUFDLFFBQVEsRUFBRTtBQUNuRCxNQUFNLGVBQWUsR0FBRyxnQ0FBUSxRQUFRLENBQUMsR0FBRyxRQUFRLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtBQUNqRSxNQUFNLGdCQUFnQixHQUFHLGVBQWUsQ0FBQyxNQUFNLENBQUMsVUFBQSxDQUFDO1dBQUksT0FBTyxDQUFDLENBQUMsQ0FBQztHQUFBLENBQUMsQ0FDN0QsR0FBRyxDQUFDLFVBQUEsQ0FBQztXQUFJLHVEQUEyQixrQkFBa0IsQ0FBQyxDQUFDLENBQUM7R0FBQSxDQUFDLENBQUE7QUFDN0Qsa0JBQWdCLENBQUMsT0FBTyxDQUFDLFVBQUEsT0FBTztXQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBQSxDQUFDO2FBQUksU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7S0FBQSxDQUFDO0dBQUEsQ0FBQyxDQUFBO0FBQ3pFLE1BQU0sV0FBVyxHQUFHLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxVQUFBLE9BQU87V0FBSSx1QkFBdUIsQ0FBQyxPQUFPLENBQUM7R0FBQSxDQUFDLENBQUE7QUFDckYsU0FBTyx5QkFBeUIsQ0FBQyxXQUFXLENBQUMsQ0FBQTtDQUM5Qzs7QUFFTSxTQUFTLDRCQUE0QixDQUFDLFFBQVEsRUFBRTtBQUNyRCxNQUFNLFNBQVMsR0FBRyxDQUFDLGdDQUFRLFFBQVEsQ0FBQyxHQUFHLFFBQVEsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFBLENBQUUsTUFBTSxDQUFDLFVBQUEsQ0FBQztXQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUM7R0FBQSxDQUFDLENBQUE7QUFDckYsV0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUM7V0FBSSxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztHQUFBLENBQUMsQ0FBQTtBQUN6QyxTQUFPLHlCQUF5QixDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsVUFBQSxDQUFDO1dBQUksb0JBQW9CLENBQUMsQ0FBQyxDQUFDO0dBQUEsQ0FBQyxDQUFDLENBQUE7Q0FDOUU7O0FBRU0sU0FBUyxPQUFPLEdBQUc7QUFDeEIsV0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUE7QUFDcEIsV0FBUyxHQUFHLElBQUksQ0FBQTtDQUNqQiIsImZpbGUiOiIvVXNlcnMvc3VkcHJhd2F0Ly5hdG9tL3BhY2thZ2VzL2F1dG9jb21wbGV0ZS1qc29uL3NyYy9tYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCdcblxuaW1wb3J0IGlzQXJyYXkgZnJvbSAnbG9kYXNoL2lzQXJyYXknXG5pbXBvcnQgcmVtb3ZlIGZyb20gJ2xvZGFzaC9yZW1vdmUnXG5pbXBvcnQgeyBDb21wb3NpdGVEaXNwb3NhYmxlLCBEaXNwb3NhYmxlIH0gZnJvbSAnYXRvbSdcblxuaW1wb3J0IFJvb3RQcm92aWRlciBmcm9tICcuL3Jvb3QtcHJvdmlkZXInXG5pbXBvcnQgeyBKc29uU2NoZW1hUHJvcG9zYWxQcm92aWRlciB9IGZyb20gJy4vanNvbi1zY2hlbWEtcHJvcG9zYWwtcHJvdmlkZXInXG5pbXBvcnQgeyBkZWZhdWx0UHJvdmlkZXJzLCBkZWZhdWx0U2NoZW1hUHJvdmlkZXJzIH0gZnJvbSAnLi9wcm92aWRlcnMnXG5cbmxldCBQUk9WSURFUlMgPSBudWxsXG5cbmV4cG9ydCBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgUFJPVklERVJTID0gW11cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb3ZpZGVBdXRvY29tcGxldGUoKSB7XG4gIHJldHVybiBuZXcgUm9vdFByb3ZpZGVyKFBST1ZJREVSUylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb3ZpZGVKc29uU2NoZW1hUHJvdmlkZXJzKCkge1xuICByZXR1cm4gZGVmYXVsdFNjaGVtYVByb3ZpZGVyc1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJvdmlkZVByb3Bvc2FsUHJvdmlkZXJzKCkge1xuICByZXR1cm4gZGVmYXVsdFByb3ZpZGVyc1xufVxuXG5mdW5jdGlvbiBjcmVhdGVQcm9taXNlRGlzcG9zYWJsZShwcm9taXNlKSB7XG4gIHJldHVybiBuZXcgRGlzcG9zYWJsZSgoKSA9PiB7XG4gICAgcHJvbWlzZS50aGVuKHByb3ZpZGVyID0+IHJlbW92ZShQUk9WSURFUlMsIGUgPT4gZSA9PT0gcHJvdmlkZXIpKVxuICB9KVxufVxuXG5mdW5jdGlvbiBjcmVhdGVTeW5jRGlzcG9zYWJsZShwcm92aWRlcikge1xuICByZXR1cm4gbmV3IERpc3Bvc2FibGUoKCkgPT4ge1xuICAgIHJlbW92ZShQUk9WSURFUlMsIGUgPT4gZSA9PT0gcHJvdmlkZXIpXG4gIH0pXG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNvbXBvc2l0ZURpc3Bvc2FibGUocHJvdmlkZXJzKSB7XG4gIGNvbnN0IGNvbXBvc2l0ZSA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcbiAgcHJvdmlkZXJzLmZvckVhY2goZGlzcG9zYWJsZSA9PiBjb21wb3NpdGUuYWRkKGRpc3Bvc2FibGUpKVxuICByZXR1cm4gY29tcG9zaXRlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb25zdW1lSnNvblNjaGVtYVByb3ZpZGVycyhwcm92aWRlcikge1xuICBjb25zdCBzY2hlbWFQcm92aWRlcnMgPSBpc0FycmF5KHByb3ZpZGVyKSA/IHByb3ZpZGVyIDogW3Byb3ZpZGVyXVxuICBjb25zdCBwcm92aWRlclByb21pc2VzID0gc2NoZW1hUHJvdmlkZXJzLmZpbHRlcihzID0+IEJvb2xlYW4ocykpXG4gICAgLm1hcChzID0+IEpzb25TY2hlbWFQcm9wb3NhbFByb3ZpZGVyLmNyZWF0ZUZyb21Qcm92aWRlcihzKSlcbiAgcHJvdmlkZXJQcm9taXNlcy5mb3JFYWNoKHByb21pc2UgPT4gcHJvbWlzZS50aGVuKHAgPT4gUFJPVklERVJTLnB1c2gocCkpKVxuICBjb25zdCBkaXNwb3NhYmxlcyA9IHByb3ZpZGVyUHJvbWlzZXMubWFwKHByb21pc2UgPT4gY3JlYXRlUHJvbWlzZURpc3Bvc2FibGUocHJvbWlzZSkpXG4gIHJldHVybiBjcmVhdGVDb21wb3NpdGVEaXNwb3NhYmxlKGRpc3Bvc2FibGVzKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY29uc3VtZUpzb25Qcm9wb3NhbFByb3ZpZGVycyhwcm92aWRlcikge1xuICBjb25zdCBwcm92aWRlcnMgPSAoaXNBcnJheShwcm92aWRlcikgPyBwcm92aWRlciA6IFtwcm92aWRlcl0pLmZpbHRlcihwID0+IEJvb2xlYW4ocCkpXG4gIHByb3ZpZGVycy5mb3JFYWNoKHAgPT4gUFJPVklERVJTLnB1c2gocCkpXG4gIHJldHVybiBjcmVhdGVDb21wb3NpdGVEaXNwb3NhYmxlKHByb3ZpZGVycy5tYXAocCA9PiBjcmVhdGVTeW5jRGlzcG9zYWJsZShwKSkpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkaXNwb3NlKCkge1xuICBQUk9WSURFUlMubGVuZ3RoID0gMFxuICBQUk9WSURFUlMgPSBudWxsXG59XG4iXX0=