var e=require("child_process"),t=(require("util"),require("events")),r=require("assert"),i=require("os"),n=require("constants"),o=require("fs"),s=require("atom-haskell-utils"),a=require("path"),l=require("crypto"),c=require("atom");var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};Object.defineProperty(exports,"__esModule",{value:!0});var p=function(e){atom.views.getView(atom.workspace).classList.add("ide-haskell"),bs().setScheduler(atom.views),Jp=!1,atom.config.get("ide-haskell.startupMessageIdeBackend")&&setTimeout(()=>{Jp||atom.notifications.addWarning("Ide-Haskell needs backends that provide most of functionality.\n            Please refer to README for details",{dismissable:!0})},5e3);Kp=new Gp,Yp=new y.PluginManager(e,eh()),Kp.add(atom.commands.add("atom-workspace",{"ide-haskell:toggle-output":()=>{Yp&&Yp.togglePanel()},"ide-haskell:next-error":()=>{Yp&&Yp.nextError()},"ide-haskell:prev-error":()=>{Yp&&Yp.prevError()}}),atom.commands.add("atom-text-editor.ide-haskell",{"ide-haskell:prettify-file":({currentTarget:e})=>{(0,E.handlePromise)((0,_a.prettifyFile)(e.getModel()))}}),atom.commands.add("atom-text-editor.ide-haskell--has-tooltips",{"ide-haskell:close-tooltip":({currentTarget:e,abortKeyBinding:t})=>{const r=Yp&&Yp.controller(e.getModel());r&&r.tooltips.has()?r.tooltips.hide():t()}})),Zp=new Gp,Zp.add(atom.menu.add([{label:E.MAIN_MENU_LABEL,submenu:[{label:"Prettify",command:"ide-haskell:prettify-file"},{label:"Toggle Panel",command:"ide-haskell:toggle-output"}]}]))};exports.activate=p;var h=function(){Yp&&Yp.deactivate();Kp&&Kp.dispose();Zp&&Zp.dispose();atom.menu.update(),Kp=void 0,Yp=void 0,Zp=void 0,Xp=void 0};exports.deactivate=h;var d=function(){if(Yp)return Yp.serialize();return};exports.serialize=d;var f=eh;exports.deserializeOutputPanel=f;var v=function(e){if(!Kp||!Yp)return;const t=e({name:"IDE-Haskell"});return Kp.add(t),Yp.setLinter(t),t};exports.consumeLinter=v;var m=function(e){if(!Yp)return;return Yp.setStatusBar(e),new Qp(()=>{Yp&&Yp.removeStatusBar()})};exports.consumeStatusBar=m;var g=(rh=void 0,ih=exports.provideUpi3_0=rh,nh=exports.provideUpi3_1=ih,oh=exports.provideUpi3_2=nh,ah=exports.provideUpi3_3=oh,lh=exports.consumeUpi3_0=ah,exports.consumeUpi3_1=lh);exports.consumeUpi3_2=g;var y={};Object.defineProperty(y,"__esModule",{value:!0});var b=void 0;y.PluginManager=b;var w=c,_={};Object.defineProperty(_,"__esModule",{value:!0}),Object.defineProperty(_,"ResultItem",{enumerable:!0,get:function(){return k.ResultItem}});var O=void 0;_.ResultsDB=O;var k={};Object.defineProperty(k,"__esModule",{value:!0});var P=void 0;k.ResultItem=P;var M=l,j=c,E={};Object.defineProperty(E,"__esModule",{value:!0});var S={MAIN_MENU_LABEL:!0,getEventType:!0,bufferPositionFromMouseEvent:!0,handlePromise:!0,MessageObject:!0},x=function(e){return e&&(e.contextCommand||e[0]&&e[0].contextCommand)?"context":"keyboard"};E.getEventType=x;var C=function(e,t){const r=atom.views.getView(e).component.screenPositionForMouseEvent(t);if(isNaN(r.row)||isNaN(r.column))return;return e.bufferPositionForScreenPosition(r)};E.bufferPositionFromMouseEvent=C;var T=function(e){if("function"!=typeof e.catch)return void atom.notifications.addFatalError("IDE-Haskell: non-promise passed to handlePromise. Please report this.",{stack:(new Error).stack,dismissable:!0});e.catch(e=>{atom.notifications.addFatalError("IDE-Haskell error: "+e.message,{detail:e.toString(),stack:e.stack,dismissable:!0})})};E.handlePromise=T,Object.defineProperty(E,"MessageObject",{enumerable:!0,get:function(){return A.MessageObject}});var D=void 0;E.MAIN_MENU_LABEL=D;var A={};Object.defineProperty(A,"__esModule",{value:!0});var I=void 0;A.MessageObject=I;function R(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}function N(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}Object.create;Object.create;var L={};Object.defineProperty(L,"__esModule",{value:!0});var B=(U=void 0,L.isEqualArray=U);function F(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}L.hightlightLines=B;var U=F;function V(e){switch(e){case"&":return"&amp;";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";case" ":return"&nbsp;";default:return e}}function z(e){return e.replace(/[&"'<>]/g,V)}function W(e){return e.replace(/[&"'<> ]/g,V)}function $(e,t,r){e.push(t),r.push(`<span class="${t.replace(/\.+/g," ")}">`)}function q(e,t){e.pop(),t.push("</span>")}function H(e,t,r){let i=e.length-t.length;if(i>0)for(;i--;)q(e,r);let n=0;for(let i=e.length;i>=0;--i){if(F(e.slice(0,i),t.slice(0,i))){n=i;break}q(e,r)}for(let i=n;i<t.length;++i)$(e,t[i],r)}L.isEqualArray=U,B=function*(e,t,r,i){const n=atom.grammars.textmateRegistry||atom.grammars;if(!n)throw new Error("No Atom grammar registry found");const o=n.grammarForScopeName(t)||(r?n.grammarForScopeName(r):void 0);if(!o)throw new Error(`Grammar ${t} not found, and no ${r} grammar`);const s=i?W:z,a=e[Symbol.iterator]();let l=a.next(),c=null;const u=[];for(;!l.done;){const e=o.tokenizeLine(l.value,c);c=e.ruleStack;const t=[];for(const{value:r,scopes:i}of e.tokens){H(u,i.map(e=>"syntax--"+e.replace(/\./g,".syntax--")),t),t.push(s(r))}for(;u.length>0;)q(u,t);yield t.join(""),l=a.next()}},L.hightlightLines=B;var G={};Object.defineProperty(G,"__esModule",{value:!0});var Q=function(e){return"Dock"===e.constructor.name};G.isDock=Q;var K=function(e){return"string"==typeof e.element};G.isSimpleControlDef=K;var Y=function(e){return void 0!==e};G.notUndefined=Y;var X=function(e){return"string"==typeof e&&te.includes(e)};G.isTEventRangeType=X;var Z=function(e){return!(!e||!e.text)};G.isTextMessage=Z;var J=function(e){return!(!e||!e.html)};G.isHTMLMessage=J;var ee=void 0;G.eventRangeTypeVals=ee;const te=["context","keyboard","mouse","selection"];ee=te,G.eventRangeTypeVals=ee;var re=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=vo();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(G),ie={};Object.defineProperty(ie,"__esModule",{value:!0});var ne,oe,se,ae,le,ce,ue={},pe={},he={},de={},fe={},ve={},me={},ge="object"==typeof u&&u&&u.Object===Object&&u;ce=ge;var ye="object"==typeof self&&self&&self.Object===Object&&self,be=ce||ye||Function("return this")();ae=(le=be).Symbol;var we={},_e=Object.prototype,Oe=_e.hasOwnProperty,ke=_e.toString,Pe=ae?ae.toStringTag:void 0;we=function(e){var t=Oe.call(e,Pe),r=e[Pe];try{e[Pe]=void 0;var i=!0}catch(e){}var n=ke.call(e);return i&&(t?e[Pe]=r:delete e[Pe]),n};var Me={},je=Object.prototype.toString;Me=function(e){return je.call(e)};var Ee=ae?ae.toStringTag:void 0;me=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Ee&&Ee in Object(e)?we(e):Me(e)};var Se={};Se=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};ve=function(e){if(!Se(e))return!1;var t=me(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};var xe,Ce,Te={},De=le["__core-js_shared__"],Ae=(Ce=/[^.]+$/.exec((xe=De)&&xe.keys&&xe.keys.IE_PROTO||""))?"Symbol(src)_1."+Ce:"";Te=function(e){return!!Ae&&Ae in e};var Ie={},Re=Function.prototype.toString;Ie=function(e){if(null!=e){try{return Re.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Ne=/^\[object .+?Constructor\]$/,Le=Function.prototype,Be=Object.prototype,Fe=Le.toString,Ue=Be.hasOwnProperty,Ve=RegExp("^"+Fe.call(Ue).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");fe=function(e){return!(!Se(e)||Te(e))&&(ve(e)?Ve:Ne).test(Ie(e))};var ze={};ze=function(e,t){return null==e?void 0:e[t]};var We=(de=function(e,t){var r=ze(e,t);return fe(r)?r:void 0})(Object,"create");he=We,se=function(){this.__data__=he?he(null):{},this.size=0};var $e;$e=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var qe,He=Object.prototype.hasOwnProperty;qe=function(e){var t=this.__data__;if(he){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return He.call(t,e)?t[e]:void 0};var Ge,Qe=Object.prototype.hasOwnProperty;Ge=function(e){var t=this.__data__;return he?void 0!==t[e]:Qe.call(t,e)};var Ke;function Ye(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}Ke=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=he&&void 0===t?"__lodash_hash_undefined__":t,this},Ye.prototype.clear=se,Ye.prototype.delete=$e,Ye.prototype.get=qe,Ye.prototype.has=Ge,Ye.prototype.set=Ke,pe=Ye;var Xe,Ze;Ze=function(){this.__data__=[],this.size=0};var Je,et={},tt={};tt=function(e,t){return e===t||e!=e&&t!=t},et=function(e,t){for(var r=e.length;r--;)if(tt(e[r][0],t))return r;return-1};var rt=Array.prototype.splice;Je=function(e){var t=this.__data__,r=et(t,e);return!(r<0)&&(r==t.length-1?t.pop():rt.call(t,r,1),--this.size,!0)};var it;it=function(e){var t=this.__data__,r=et(t,e);return r<0?void 0:t[r][1]};var nt;nt=function(e){return et(this.__data__,e)>-1};var ot;function st(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}ot=function(e,t){var r=this.__data__,i=et(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this},st.prototype.clear=Ze,st.prototype.delete=Je,st.prototype.get=it,st.prototype.has=nt,st.prototype.set=ot,Xe=st;var at,lt=de(le,"Map");at=lt,oe=function(){this.size=0,this.__data__={hash:new pe,map:new(at||Xe),string:new pe}};var ct,ut={},pt={};pt=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e},ut=function(e,t){var r=e.__data__;return pt(t)?r["string"==typeof t?"string":"hash"]:r.map},ct=function(e){var t=ut(this,e).delete(e);return this.size-=t?1:0,t};var ht;ht=function(e){return ut(this,e).get(e)};var dt;dt=function(e){return ut(this,e).has(e)};var ft;function vt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}ft=function(e,t){var r=ut(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this},vt.prototype.clear=oe,vt.prototype.delete=ct,vt.prototype.get=ht,vt.prototype.has=dt,vt.prototype.set=ft,ue=vt;function mt(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var i=arguments,n=t?t.apply(this,i):i[0],o=r.cache;if(o.has(n))return o.get(n);var s=e.apply(this,i);return r.cache=o.set(n,s)||o,s};return r.cache=new(mt.Cache||ue),r}mt.Cache=ue,ne=mt;var gt={};function yt(e){for(var t in e)gt.hasOwnProperty(t)||(gt[t]=e[t])}Object.defineProperty(gt,"__esModule",{value:!0});var bt={};Object.defineProperty(bt,"__esModule",{value:!0});var wt=function(){function e(e,t,r){void 0===r&&(r={}),this.execute=e,this.applicator=t,this.options=r}return Object.defineProperty(e.prototype,"bound",{get:function(){return null!=this.options.bound&&this.options.bound},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"setter",{get:function(){return null!=this.options.setter&&this.options.setter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getter",{get:function(){return null!=this.options.getter&&this.options.getter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"property",{get:function(){return null!=this.options.property&&this.options.property},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"method",{get:function(){return null==this.options.method||this.options.method},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optionalParams",{get:function(){return null!=this.options.optionalParams&&this.options.optionalParams},enumerable:!0,configurable:!0}),e}();bt.DecoratorConfig=wt,yt(bt);var _t={};Object.defineProperty(_t,"__esModule",{value:!0});var Ot={};Object.defineProperty(Ot,"__esModule",{value:!0});var kt={};function Pt(e){for(var t in e)kt.hasOwnProperty(t)||(kt[t]=e[t])}Object.defineProperty(kt,"__esModule",{value:!0});var Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});var jt=function(e){return void 0===e&&(e=""),"lodash-decorators -> "+e};Mt.log=jt,Pt(Mt);var Et={};Object.defineProperty(Et,"__esModule",{value:!0});var St={},xt={},Ct=Array.isArray;xt=Ct;var Tt={};Tt=function(e){return null!=e&&"object"==typeof e};St=function(e){return"string"==typeof e||!xt(e)&&Tt(e)&&"[object String]"==me(e)};var Dt=function(e,t,r,i){if(void 0===i&&(i=!0),ve(e))return e;if(St(e)){if(t&&ve(t[e]))return t[e];if(r&&ve(r[e]))return r[e]}if(i)throw new ReferenceError(Mt.log("Can not resolve method "+e+" on any target Objects"))};Et.resolveFunction=Dt,Pt(Et);var At={};Object.defineProperty(At,"__esModule",{value:!0});var It={};It=function(e){return void 0===e};var Rt=function(){function e(){this._weakMap=new WeakMap}return e.prototype.set=function(e,t){for(var r=this._weakMap,i=0,n=e.length-1;i<n;i++){var o=e[i],s=r.get(o);s||(s=new Map,r.set(o,s)),r=s}r.set(e[e.length-1],t)},e.prototype.get=function(e){for(var t=this._weakMap,r=0,i=e.length;r<i&&(t=t.get(e[r]),!It(t));r++);return t},e.prototype.has=function(e){return!It(this.get(e))},e}();At.CompositeKeyWeakMap=Rt,Pt(At);var Nt={};Object.defineProperty(Nt,"__esModule",{value:!0});var Lt=function(e,t){return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return e.call.apply(e,[this].concat(r)),r[t]}};Nt.returnAtIndex=Lt,Pt(Nt);var Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});var Ft={},Ut={},Vt={};var zt=function(e){return function(t,r,i){for(var n=-1,o=Object(t),s=i(t),a=s.length;a--;){var l=s[e?a:++n];if(!1===r(o[l],l,o))break}return t}}();Vt=zt;var Wt,$t={},qt={};qt=function(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i};var Ht={},Gt={};Gt=function(e){return Tt(e)&&"[object Arguments]"==me(e)};var Qt=Object.prototype,Kt=Qt.hasOwnProperty,Yt=Qt.propertyIsEnumerable,Xt=Gt(function(){return arguments}())?Gt:function(e){return Tt(e)&&Kt.call(e,"callee")&&!Yt.call(e,"callee")};Ht=Xt;var Zt;Zt=function(){return!1};var Jt=function(){var e={exports:this},t="object"==typeof this&&this&&!this.nodeType&&this,r=t&&"object"==typeof e&&e&&!e.nodeType&&e,i=r&&r.exports===t?le.Buffer:void 0,n=(i?i.isBuffer:void 0)||Zt;return e.exports=n,e.exports}.call({}),er={},tr=/^(?:0|[1-9]\d*)$/;er=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&tr.test(e))&&e>-1&&e%1==0&&e<t};var rr,ir={},nr={};nr=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var or={};or["[object Float32Array]"]=or["[object Float64Array]"]=or["[object Int8Array]"]=or["[object Int16Array]"]=or["[object Int32Array]"]=or["[object Uint8Array]"]=or["[object Uint8ClampedArray]"]=or["[object Uint16Array]"]=or["[object Uint32Array]"]=!0,or["[object Arguments]"]=or["[object Array]"]=or["[object ArrayBuffer]"]=or["[object Boolean]"]=or["[object DataView]"]=or["[object Date]"]=or["[object Error]"]=or["[object Function]"]=or["[object Map]"]=or["[object Number]"]=or["[object Object]"]=or["[object RegExp]"]=or["[object Set]"]=or["[object String]"]=or["[object WeakMap]"]=!1,rr=function(e){return Tt(e)&&nr(e.length)&&!!or[me(e)]};var sr={};sr=function(e){return function(t){return e(t)}};var ar=function(){var e={exports:this},t="object"==typeof this&&this&&!this.nodeType&&this,r=t&&"object"==typeof e&&e&&!e.nodeType&&e,i=r&&r.exports===t&&ce.process,n=function(){try{var e=r&&r.require&&r.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();return e.exports=n,e.exports}.call({}),lr=ar&&ar.isTypedArray,cr=lr?sr(lr):rr;ir=cr;var ur=Object.prototype.hasOwnProperty;$t=function(e,t){var r=xt(e),i=!r&&Ht(e),n=!r&&!i&&Jt(e),o=!r&&!i&&!n&&ir(e),s=r||i||n||o,a=s?qt(e.length,String):[],l=a.length;for(var c in e)!t&&!ur.call(e,c)||s&&("length"==c||n&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||er(c,l))||a.push(c);return a};var pr={},hr={},dr=Object.prototype;hr=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||dr)};var fr={},vr={};var mr=(vr=function(e,t){return function(r){return e(t(r))}})(Object.keys,Object);fr=mr;var gr=Object.prototype.hasOwnProperty;pr=function(e){if(!hr(e))return fr(e);var t=[];for(var r in Object(e))gr.call(e,r)&&"constructor"!=r&&t.push(r);return t};var yr={};yr=function(e){return null!=e&&nr(e.length)&&!ve(e)},Wt=function(e){return yr(e)?$t(e):pr(e)},Ut=function(e,t){return e&&Vt(e,t,Wt)};var br,wr={};br=function(e){return e},wr=function(e){return"function"==typeof e?e:br},Ft=function(e,t){return e&&Ut(e,wr(t))};var _r=function(e,t){return Ft(t,(function(t,r){return e[r]=t})),e};Bt.copyMetadata=_r,Pt(Bt);var Or={};Object.defineProperty(Or,"__esModule",{value:!0});var kr=function(e,t){return Bt.copyMetadata(e.bind(t),e)};Or.bind=kr,Pt(Or);var Pr={};Object.defineProperty(Pr,"__esModule",{value:!0});var Mr={};Object.defineProperty(Mr,"__esModule",{value:!0});var jr,Er={},Sr={},xr={};jr=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Cr;function Tr(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ue;++t<r;)this.add(e[t])}Cr=function(e){return this.__data__.has(e)},Tr.prototype.add=Tr.prototype.push=jr,Tr.prototype.has=Cr,xr=Tr;var Dr={},Ar={},Ir={};Ir=function(e,t,r,i){for(var n=e.length,o=r+(i?1:-1);i?o--:++o<n;)if(t(e[o],o,e))return o;return-1};var Rr;Rr=function(e){return e!=e};var Nr={};Nr=function(e,t,r){for(var i=r-1,n=e.length;++i<n;)if(e[i]===t)return i;return-1},Ar=function(e,t,r){return t==t?Nr(e,t,r):Ir(e,Rr,r)},Dr=function(e,t){return!!(null==e?0:e.length)&&Ar(e,t,0)>-1};var Lr;Lr=function(e,t,r){for(var i=-1,n=null==e?0:e.length;++i<n;)if(r(t,e[i]))return!0;return!1};var Br={};Br=function(e,t){for(var r=-1,i=null==e?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n};var Fr;Fr=function(e,t){return e.has(t)};Sr=function(e,t,r,i){var n=-1,o=Dr,s=!0,a=e.length,l=[],c=t.length;if(!a)return l;r&&(t=Br(t,sr(r))),i?(o=Lr,s=!1):t.length>=200&&(o=Fr,s=!1,t=new xr(t));e:for(;++n<a;){var u=e[n],p=null==r?u:r(u);if(u=i||0!==u?u:0,s&&p==p){for(var h=c;h--;)if(t[h]===p)continue e;l.push(u)}else o(t,p,i)||l.push(u)}return l};var Ur={},Vr={},zr={};zr=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)};var Wr=Math.max;Vr=function(e,t,r){return t=Wr(void 0===t?e.length-1:t,0),function(){for(var i=arguments,n=-1,o=Wr(i.length-t,0),s=Array(o);++n<o;)s[n]=i[t+n];n=-1;for(var a=Array(t+1);++n<t;)a[n]=i[n];return a[t]=r(s),zr(e,this,a)}};var $r,qr={},Hr={};Hr=function(e){return function(){return e}};var Gr={},Qr=function(){try{var e=de(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();$r=(Gr=Qr)?function(e,t){return Gr(e,"toString",{configurable:!0,enumerable:!1,value:Hr(t),writable:!0})}:br;var Kr={},Yr=Date.now;var Xr=(Kr=function(e){var t=0,r=0;return function(){var i=Yr(),n=16-(i-r);if(r=i,n>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}})($r);qr=Xr;var Zr={};Zr=function(e){return Tt(e)&&yr(e)};var Jr=(Ur=function(e,t){return qr(Vr(e,t,br),e+"")})((function(e,t){return Zr(e)?Sr(e,t):[]}));Er=Jr;var ei={},ti={},ri={},ii={},ni=vr(Object.getPrototypeOf,Object);ii=ni;var oi=Function.prototype,si=Object.prototype,ai=oi.toString,li=si.hasOwnProperty,ci=ai.call(Object);ri=function(e){if(!Tt(e)||"[object Object]"!=me(e))return!1;var t=ii(e);if(null===t)return!0;var r=li.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&ai.call(r)==ci};ti=function(e){if(!Tt(e))return!1;var t=me(e);return"[object Error]"==t||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!ri(e)};var ui=Ur((function(e,t){try{return zr(e,void 0,t)}catch(e){return ti(e)?e:new Error(e)}}));ei=ui;var pi=function(e,t,r){void 0===r&&(r=[]);for(var i=0,n=Er.apply(void 0,[Object.getOwnPropertyNames(t)].concat(r));i<n.length;i++){var o=n[i];ei(hi,e,t,o)}return e};function hi(e,t,r){var i=Object.getOwnPropertyDescriptor(e,r);if(!i||i.configurable){var n=Object.getOwnPropertyDescriptor(t,r);Se(n)?Object.defineProperty(e,r,n):e[r]=t[r]}}Mr.assignAll=pi;var di=hi;Mr.assignProperty=di;var fi=["length","name","arguments","called","prototype"];var vi=function(e,t){function r(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return t.call.apply(t,[this,e].concat(r))}return r.prototype=e.prototype,Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:e.name,writable:!1}),Mr.assignAll(r,e,fi)};Pr.wrapConstructor=vi,Pt(Pr),Pt(Mr);var mi={};Object.defineProperty(mi,"__esModule",{value:!0});var gi=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length>=2&&Se(e[0])&&St(e[1])&&ve(e[0].constructor)&&e[0].constructor.prototype===e[0]};mi.isMethodOrPropertyDecoratorArgs=gi,Pt(mi);var yi={};Object.defineProperty(yi,"__esModule",{value:!0});var bi=function(e,t){return e===t||e.constructor!==t.constructor&&Object.getPrototypeOf(this).constructor===t.constructor};yi.isPrototypeAccess=bi,Pt(yi);var wi=new kt.CompositeKeyWeakMap;Ot.InstanceChainMap=wi;var _i=function(){function e(){}return e.prototype.createDecorator=function(e){var t=this,r=e.applicator,i=e.optionalParams;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var s=n,a=function(i,n,o){var a=t._resolveDescriptor(i,n,o),l=a.value,c=a.get,u=a.set;return Ot.InstanceChainMap.has([i,n])||(ve(l)?a.value=kt.copyMetadata(r.apply({config:e,target:i,value:l,args:s}),l):ve(c)&&e.getter?a.get=kt.copyMetadata(r.apply({config:e,target:i,value:c,args:s}),c):ve(u)&&e.setter&&(a.set=kt.copyMetadata(r.apply({config:e,target:i,value:u,args:s}),u))),a};return i&&kt.isMethodOrPropertyDecoratorArgs.apply(void 0,n)?(s=[],a(n[0],n[1],n[2])):a}},e.prototype.createInstanceDecorator=function(e){var t=this,r=e.applicator,i=e.bound,n=e.optionalParams;return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var a=o,l=function(n,o,s){var l=t._resolveDescriptor(n,o,s),c=l.value,u=l.writable,p=l.enumerable,h=l.configurable,d=l.get,f=l.set,v=!Ot.InstanceChainMap.has([n,o]),m=Ot.InstanceChainMap.get([n,o])||{fns:[],properties:[]},g=v&&ve(d),y=v&&ve(f),b=v&&ve(c),w=v&&!g&&!y&&!b,_=g?d:b?c:void 0;if(m.properties.push(o),m.fns.push((function(o,s,l){return t._isApplicable(l,e)?(i&&(o=kt.bind(o,s)),kt.copyMetadata(r.apply({args:a,target:n,instance:s,value:o,config:e}),o)):o})),Ot.InstanceChainMap.set([n,o],m),!v)return l;m.isSetter=y,m.isGetter=g,m.isMethod=b,m.isProperty=w;var O=function(e,t,r){return m.fns.reduce((function(e,i){return i(e,r,t)}),e)},k=function(e){var t=d||void 0,r=f||void 0;if(g||y)g&&(t=O(d,{value:d,getter:!0},e)),y&&(r=O(f,{value:f,setter:!0},e)),Object.defineProperty(e,o,{enumerable:p,configurable:h,get:t,set:r});else if(b||w){var i=O(c,b?{value:c,method:!0}:{value:c,property:!0},e);Object.defineProperty(e,o,{writable:u,enumerable:p,configurable:h,value:i})}};return(b||w)&&(delete l.value,delete l.writable),l.get=function(){if(kt.isPrototypeAccess(this,n))return _;k(this);var e=Object.getOwnPropertyDescriptor(this,o);return e.get?e.get.call(this):e.value},l.set=function(e){k(this);var t=Object.getOwnPropertyDescriptor(this,o);t.set?t.set.call(this,e):(w||b)&&(this[o]=e)},l};return n&&kt.isMethodOrPropertyDecoratorArgs.apply(void 0,o)?(a=[],l(o[0],o[1],o[2])):l}},e.prototype._isApplicable=function(e,t){return!Boolean(e.getter&&!t.getter||e.setter&&!t.setter||e.method&&!t.method||e.property&&!t.property)},e.prototype._resolveDescriptor=function(e,t,r){return r||(Object.getOwnPropertyDescriptor(e,t)||{})},e}(),Oi=_i;_t.InternalDecoratorFactory=Oi;var ki=new _i;_t.DecoratorFactory=ki,yt(_t),yt(Ot);var Pi={};function Mi(e){for(var t in e)Pi.hasOwnProperty(t)||(Pi[t]=e[t])}Object.defineProperty(Pi,"__esModule",{value:!0});var ji={};Object.defineProperty(ji,"__esModule",{value:!0});var Ei=function(){};ji.Applicator=Ei,Mi(ji);var Si={};Object.defineProperty(Si,"__esModule",{value:!0});var xi=function(e,t){return(xi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function Ci(e,t){function r(){this.constructor=e}xi(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var Ti=function(e){function t(t){void 0===t&&(t={});var r=e.call(this)||this;return r._config=t,r}return Ci(t,e),Object.defineProperty(t.prototype,"post",{get:function(){return!0===this._config.post},enumerable:!0,configurable:!0}),t.prototype.apply=function(e){var t=e.config.execute,r=e.value,i=void 0===r?br:r,n=e.args,o=e.target,s=this;return function(){for(var e=this,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var l=n.map((function(t){return kt.resolveFunction(t,e,o)})).slice();return s.post?l.push(i):l.unshift(i),t.apply(void 0,l).apply(this,r)}},t}(ji.Applicator);Si.ComposeApplicator=Ti,Mi(Si);var Di={};Object.defineProperty(Di,"__esModule",{value:!0});var Ai=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ci(t,e),t.prototype.apply=function(e){var t=e.args,r=e.target,i=e.config.execute;return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return i.apply(void 0,[kt.resolveFunction(t[0],this,r)].concat(t.slice(1))).apply(this,e)}},t}(ji.Applicator);Di.PartialApplicator=Ai,Mi(Di);var Ii={};Object.defineProperty(Ii,"__esModule",{value:!0});var Ri,Ni={},Li={},Bi={},Fi={},Ui=(Fi=de(le,"WeakMap"))&&new Fi;Ri=(Bi=Ui)?function(e,t){return Bi.set(e,t),e}:br;var Vi={},zi={},Wi={},$i=Object.create,qi=function(){function e(){}return function(t){if(!Se(t))return{};if($i)return $i(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();Wi=qi,zi=function(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=Wi(e.prototype),i=e.apply(r,t);return Se(i)?i:r}};Vi=function(e,t,r){var i=1&t,n=zi(e);return function t(){var o=this&&this!==le&&this instanceof t?n:e;return o.apply(i?r:this,arguments)}};var Hi={},Gi={},Qi={},Ki=Math.max;Qi=function(e,t,r,i){for(var n=-1,o=e.length,s=r.length,a=-1,l=t.length,c=Ki(o-s,0),u=Array(l+c),p=!i;++a<l;)u[a]=t[a];for(;++n<s;)(p||n<o)&&(u[r[n]]=e[n]);for(;c--;)u[a++]=e[n++];return u};var Yi={},Xi=Math.max;Yi=function(e,t,r,i){for(var n=-1,o=e.length,s=-1,a=r.length,l=-1,c=t.length,u=Xi(o-a,0),p=Array(u+c),h=!i;++n<u;)p[n]=e[n];for(var d=n;++l<c;)p[d+l]=t[l];for(;++s<a;)(h||n<o)&&(p[d+r[s]]=e[n++]);return p};var Zi={};Zi=function(e,t){for(var r=e.length,i=0;r--;)e[r]===t&&++i;return i};var Ji,en,tn={},rn={};en=function(){};function nn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}nn.prototype=Wi(en.prototype),nn.prototype.constructor=nn,Ji=nn;var on={};on=Bi?function(e){return Bi.get(e)}:function(){};var sn,an={};sn={};var ln=Object.prototype.hasOwnProperty;an=function(e){for(var t=e.name+"",r=sn[t],i=ln.call(sn,t)?r.length:0;i--;){var n=r[i],o=n.func;if(null==o||o==e)return n.name}return t};var cn,un={};function pn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}pn.prototype=Wi(en.prototype),pn.prototype.constructor=pn,un=pn;var hn={},dn={};dn=function(e,t){var r=-1,i=e.length;for(t||(t=Array(i));++r<i;)t[r]=e[r];return t},hn=function(e){if(e instanceof Ji)return e.clone();var t=new un(e.__wrapped__,e.__chain__);return t.__actions__=dn(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t};var fn=Object.prototype.hasOwnProperty;function vn(e){if(Tt(e)&&!xt(e)&&!(e instanceof Ji)){if(e instanceof un)return e;if(fn.call(e,"__wrapped__"))return hn(e)}return new un(e)}vn.prototype=en.prototype,vn.prototype.constructor=vn,cn=vn,rn=function(e){var t=an(e),r=cn[t];if("function"!=typeof r||!(t in Ji.prototype))return!1;if(e===r)return!0;var i=on(r);return!!i&&e===i[0]};var mn={},gn=Kr(Ri);mn=gn;var yn={},bn={},wn=/\{\n\/\* \[wrapped with (.+)\] \*/,_n=/,? & /;bn=function(e){var t=e.match(wn);return t?t[1].split(_n):[]};var On={},kn=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;On=function(e,t){var r=t.length;if(!r)return e;var i=r-1;return t[i]=(r>1?"& ":"")+t[i],t=t.join(r>2?", ":" "),e.replace(kn,"{\n/* [wrapped with "+t+"] */\n")};var Pn={},Mn={};Mn=function(e,t){for(var r=-1,i=null==e?0:e.length;++r<i&&!1!==t(e[r],r,e););return e};var jn=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];Pn=function(e,t){return Mn(jn,(function(r){var i="_."+r[0];t&r[1]&&!Dr(e,i)&&e.push(i)})),e.sort()},yn=function(e,t,r){var i=t+"";return qr(e,On(i,Pn(bn(i),r)))};tn=function(e,t,r,i,n,o,s,a,l,c){var u=8&t;t|=u?32:64,4&(t&=~(u?64:32))||(t&=-4);var p=[e,t,n,u?o:void 0,u?s:void 0,u?void 0:o,u?void 0:s,a,l,c],h=r.apply(void 0,p);return rn(e)&&mn(h,p),h.placeholder=i,yn(h,e,t)};var En={};En=function(e){return e.placeholder};var Sn={},xn=Math.min;Sn=function(e,t){for(var r=e.length,i=xn(t.length,r),n=dn(e);i--;){var o=t[i];e[i]=er(o,r)?n[o]:void 0}return e};var Cn={};Cn=function(e,t){for(var r=-1,i=e.length,n=0,o=[];++r<i;){var s=e[r];s!==t&&"__lodash_placeholder__"!==s||(e[r]="__lodash_placeholder__",o[n++]=r)}return o};Gi=function e(t,r,i,n,o,s,a,l,c,u){var p=128&r,h=1&r,d=2&r,f=24&r,v=512&r,m=d?void 0:zi(t);return function g(){for(var y=arguments.length,b=Array(y),w=y;w--;)b[w]=arguments[w];if(f)var _=En(g),O=Zi(b,_);if(n&&(b=Qi(b,n,o,f)),s&&(b=Yi(b,s,a,f)),y-=O,f&&y<u){var k=Cn(b,_);return tn(t,r,e,g.placeholder,i,b,k,l,c,u-y)}var P=h?i:this,M=d?P[t]:t;return y=b.length,l?b=Sn(b,l):v&&y>1&&b.reverse(),p&&c<y&&(b.length=c),this&&this!==le&&this instanceof g&&(M=m||zi(M)),M.apply(P,b)}},Hi=function(e,t,r){var i=zi(e);return function n(){for(var o=arguments.length,s=Array(o),a=o,l=En(n);a--;)s[a]=arguments[a];var c=o<3&&s[0]!==l&&s[o-1]!==l?[]:Cn(s,l);if((o-=c.length)<r)return tn(e,t,Gi,n.placeholder,void 0,s,c,void 0,void 0,r-o);var u=this&&this!==le&&this instanceof n?i:e;return zr(u,this,s)}};var Tn={};Tn=function(e,t,r,i){var n=1&t,o=zi(e);return function t(){for(var s=-1,a=arguments.length,l=-1,c=i.length,u=Array(c+a),p=this&&this!==le&&this instanceof t?o:e;++l<c;)u[l]=i[l];for(;a--;)u[l++]=arguments[++s];return zr(p,n?r:this,u)}};var Dn={},An=Math.min;Dn=function(e,t){var r=e[1],i=t[1],n=r|i,o=n<131,s=128==i&&8==r||128==i&&256==r&&e[7].length<=t[8]||384==i&&t[7].length<=t[8]&&8==r;if(!o&&!s)return e;1&i&&(e[2]=t[2],n|=1&r?0:4);var a=t[3];if(a){var l=e[3];e[3]=l?Qi(l,a,t[4]):a,e[4]=l?Cn(e[3],"__lodash_placeholder__"):t[4]}return(a=t[5])&&(l=e[5],e[5]=l?Yi(l,a,t[6]):a,e[6]=l?Cn(e[5],"__lodash_placeholder__"):t[6]),(a=t[7])&&(e[7]=a),128&i&&(e[8]=null==e[8]?t[8]:An(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=n,e};var In={},Rn={},Nn={},Ln={};Ln=function(e){return"symbol"==typeof e||Tt(e)&&"[object Symbol]"==me(e)};var Bn={},Fn={},Un=/\s/;Fn=function(e){for(var t=e.length;t--&&Un.test(e.charAt(t)););return t};var Vn=/^\s+/;Bn=function(e){return e?e.slice(0,Fn(e)+1).replace(Vn,""):e};var zn=/^[-+]0x[0-9a-f]+$/i,Wn=/^0b[01]+$/i,$n=/^0o[0-7]+$/i,qn=parseInt;Nn=function(e){if("number"==typeof e)return e;if(Ln(e))return NaN;if(Se(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Se(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Bn(e);var r=Wn.test(e);return r||$n.test(e)?qn(e.slice(2),r?2:8):zn.test(e)?NaN:+e};Rn=function(e){return e?(e=Nn(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0},In=function(e){var t=Rn(e),r=t%1;return t==t?r?t-r:t:0};var Hn=Math.max;Li=function(e,t,r,i,n,o,s,a){var l=2&t;if(!l&&"function"!=typeof e)throw new TypeError("Expected a function");var c=i?i.length:0;if(c||(t&=-97,i=n=void 0),s=void 0===s?s:Hn(In(s),0),a=void 0===a?a:In(a),c-=n?n.length:0,64&t){var u=i,p=n;i=n=void 0}var h=l?void 0:on(e),d=[e,t,r,i,n,u,p,o,s,a];if(h&&Dn(d,h),e=d[0],t=d[1],r=d[2],i=d[3],n=d[4],!(a=d[9]=void 0===d[9]?l?0:e.length:Hn(d[9]-c,0))&&24&t&&(t&=-25),t&&1!=t)f=8==t||16==t?Hi(e,t,a):32!=t&&33!=t||n.length?Gi.apply(void 0,d):Tn(e,t,r,i);else var f=Vi(e,t,r);return yn((h?Ri:mn)(f,d),e,t)};var Gn=Ur((function(e,t){var r=Cn(t,En(Gn));return Li(e,32,void 0,t,r)}));Gn.placeholder={},Ni=Gn;var Qn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ci(t,e),t.prototype.apply=function(e){var t=e.config.execute,r=e.value,i=e.args;return Ni.apply(void 0,[t,r].concat(i))},t}(ji.Applicator);Ii.PartialedApplicator=Qn,Mi(Ii);var Kn={};Object.defineProperty(Kn,"__esModule",{value:!0});var Yn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ci(t,e),t.prototype.apply=function(e){var t=e.args,r=e.target,i=e.value,n=e.config.execute;return function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var s=i,a=0;return ve(s)||(s=kt.resolveFunction(t[0],this,r),a=1),n.apply(void 0,[s].concat(t.slice(a))).apply(this,e)}},t}(ji.Applicator);Kn.PartialValueApplicator=Yn,Mi(Kn);var Xn={};Object.defineProperty(Xn,"__esModule",{value:!0});var Zn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ci(t,e),t.prototype.apply=function(e){var t=e.config,r=t.execute,i=(t.bound,e.args),n=e.value;return r.apply(void 0,i.concat([n]))},t}(ji.Applicator);Xn.PostValueApplicator=Zn,Mi(Xn);var Jn={};Object.defineProperty(Jn,"__esModule",{value:!0});var eo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ci(t,e),t.prototype.apply=function(e){var t=e.value,r=e.config.execute,i=e.args;return r.apply(void 0,[t].concat(i))},t}(ji.Applicator);Jn.PreValueApplicator=eo,Mi(Jn);var to={};Object.defineProperty(to,"__esModule",{value:!0});var ro=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ci(t,e),t.prototype.apply=function(e){var t=e.args,r=e.config.execute,i=e.target,n=e.value;return function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return r(kt.resolveFunction(t[0],this,i),n).apply(this,e)}},t}(ji.Applicator);to.WrapApplicator=ro,Mi(to);var io={};Object.defineProperty(io,"__esModule",{value:!0});var no=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ci(t,e),t.prototype.apply=function(e){var t=e.value,r=e.config.execute,i=e.args,n=e.instance;e.target;return n?r.apply(void 0,[t,n].concat(i)):t},t}(ji.Applicator);io.BindApplicator=no,Mi(io);var oo={};Object.defineProperty(oo,"__esModule",{value:!0});var so=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ci(t,e),t.prototype.apply=function(e){var t=e.args,r=(e.target,e.config.execute),i=e.value;return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return r.apply(void 0,[i.bind(this)].concat(e,t))}},t}(ji.Applicator);oo.InvokeApplicator=so,Mi(oo);var ao={};Object.defineProperty(ao,"__esModule",{value:!0});var lo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ci(t,e),t.prototype.apply=function(e){var t=e.value,r=e.instance,i=e.config.execute,n=e.args,o=e.target,s=kt.resolveFunction(ve(n[0])?n[0]:Se(n[0])?n[0].resolver:n[0],r,o,!1);s&&r&&(s=s.bind(r));var a=s?i(t,s):i(t);if(Se(n[0])){var l=n[0],c=l.cache,u=l.type;c?a.cache=c:ve(u)&&(a.cache=new u)}return a},t}(ji.Applicator);ao.MemoizeApplicator=lo,Mi(ao);var co=gt.DecoratorFactory.createInstanceDecorator(new gt.DecoratorConfig(ne,new Pi.MemoizeApplicator,{optionalParams:!0}));ie.Memoize=co;var uo=ie.Memoize;ie.memoize=uo;var po=ie.Memoize;ie.default=po;var ho,fo=(ho=ie)&&ho.__esModule?ho:{default:ho};function vo(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return vo=function(){return e},e}class mo{constructor(e){this.msg=e}toHtml(){if(re.isTextMessage(this.msg)&&void 0!==this.msg.highlighter){const e=Array.from((0,L.hightlightLines)(this.msg.text.split("\n"),this.msg.highlighter));return e.length>0?e.join("\n"):(this.msg.highlighter=void 0,this.toHtml())}if(re.isHTMLMessage(this.msg))return this.msg.html;{let e;e=re.isTextMessage(this.msg)?this.msg.text:this.msg;const t=document.createElement("div");return t.innerText=e,t.innerHTML}}toPlain(){if(re.isHTMLMessage(this.msg)){const e=document.createElement("div");return e.innerHTML=this.msg.html,e.innerText}{let e;return e=re.isTextMessage(this.msg)?this.msg.text:this.msg,e}}raw(){return re.isTextMessage(this.msg)?this.msg.text:re.isHTMLMessage(this.msg)?this.msg.html:this.msg}}I=mo,A.MessageObject=I,mo.fromObject=e=>e instanceof mo?e:new mo(e),R([(0,fo.default)(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",String)],mo.prototype,"toHtml",null),R([(0,fo.default)(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",String)],mo.prototype,"toPlain",null),Object.keys(G).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(S,e)||e in E&&E[e]===G[e]||Object.defineProperty(E,e,{enumerable:!0,get:function(){return G[e]}}))}));var go={};Object.defineProperty(go,"__esModule",{value:!0});var yo=function(e,t,r,i){const n=t=>{const n=t.target.closest(r);n&&e.contains(n)&&i(t)};return e.addEventListener(t,n),new bo.Disposable(()=>{e.removeEventListener(t,n)})};go.listen=yo;var bo=c;Object.keys(go).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(S,e)||e in E&&E[e]===go[e]||Object.defineProperty(E,e,{enumerable:!0,get:function(){return go[e]}}))}));D="Haskell IDE",E.MAIN_MENU_LABEL=D;P=class{constructor(e,{uri:t,message:r,severity:i,position:n,context:o}){this.providerId=e,this.uri=t,this.message=E.MessageObject.fromObject(r),this.severity=i,this.position=n?j.Point.fromObject(n):void 0,this.context=o,this._isValid=!0}isValid(){return this._isValid}setValid(e){this._isValid=e}hash(){if(void 0!==this._hash)return this._hash;const e=(0,M.createHash)("sha1");return e.update(JSON.stringify({uri:this.uri,position:this.position?this.position.serialize():void 0,message:this.message.raw(),severity:this.severity,context:this.context})),this._hash=e.digest("base64"),this._hash}},k.ResultItem=P;var wo=c,_o={};Object.defineProperty(_o,"__esModule",{value:!0});var Oo=void 0;_o.Provider=Oo;Oo=class{constructor(e,t,r){this.parent=e,this.providerSeverities=t,this.id=r,this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.parent.didUpdate(this.id,Array.from(this.providerSeverities),[]))}addSeverity(e){this.providerSeverities.add(e)}removeSeverity(e){this.providerSeverities.delete(e)}setMessages(e){if(this.disposed)return;const t=e.map(e=>new k.ResultItem(this.id,e));this.parent.didUpdate(this.id,Array.from(this.providerSeverities),t)}},_o.Provider=Oo;O=class{constructor(){this.currentId=0,this.disposables=new wo.CompositeDisposable,this.emitter=new wo.Emitter,this.disposables.add(this.emitter),this.messages=new Map}destroy(){this.disposables.dispose()}onDidUpdate(e){return this.emitter.on("did-update",e)}didUpdate(e,t,r){const i=r.map(e=>e.uri).filter(E.notUndefined);for(const[r,n]of this.messages.entries())(n.providerId===e||void 0!==n.uri&&i.includes(n.uri)&&t.includes(n.severity))&&this.messages.delete(r);for(const e of r)this.messages.set(e.hash(),e);const n=new Set(r.map(e=>e.severity));this.emitter.emit("did-update",Array.from(n))}registerProvider(e){const t=new _o.Provider(this,new Set(e),++this.currentId);return this.disposables.add(t),t}results(){return Array.from(this.messages.values())}filter(e){return this.results().filter(e)}isEmpty(e){return!Array.from(this.messages.values()).some(({severity:t})=>e.includes(t))}},_.ResultsDB=O;var ko={};Object.defineProperty(ko,"__esModule",{value:!0});var Po=void 0;ko.ConfigParamManager=Po;var Mo=c,jo={};Object.defineProperty(jo,"__esModule",{value:!0});var Eo=void 0;jo.ParamControl=Eo;var So,xo,Co=c;xo={onCopy:"copy",onCut:"cut",onPaste:"paste",onCompositionEnd:"compositionend",onCompositionStart:"compositionstart",onCompositionUpdate:"compositionupdate",onKeyDown:"keydown",onKeyPress:"keypress",onKeyUp:"keyup",onFocus:"focus",onBlur:"blur",onChange:"change",onInput:"input",onSubmit:"submit",onClick:"click",onContextMenu:"contextmenu",onDoubleClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragEnter:"dragenter",onDragExit:"dragexit",onDragLeave:"dragleave",onDragOver:"dragover",onDragStart:"dragstart",onDrop:"drop",onMouseDown:"mousedown",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onSelect:"select",onTouchCancel:"touchcancel",onTouchEnd:"touchend",onTouchMove:"touchmove",onTouchStart:"touchstart",onScroll:"scroll",onWheel:"wheel",onAbort:"abort",onCanPlay:"canplay",onCanPlayThrough:"canplaythrough",onDurationChange:"durationchange",onEmptied:"emptied",onEncrypted:"encrypted",onEnded:"ended",onError:"error",onLoadedData:"loadeddata",onLoadedMetadata:"loadedmetadata",onLoadStart:"loadstart",onPause:"pause",onPlay:"play",onPlaying:"playing",onProgress:"progress",onRateChange:"ratechange",onSeeked:"seeked",onSeeking:"seeking",onStalled:"stalled",onSuspend:"suspend",onTimeUpdate:"timeupdate",onVolumeChange:"volumechange",onWaiting:"waiting",onLoad:"load",onAnimationStart:"animationstart",onAnimationEnd:"animationend",onAnimationIteration:"animationiteration",onTransitionEnd:"transitionend"};var To={};function Do(e,t,...r){let i=[];for(let e=0;e<r.length;){const t=r[e];switch(typeof t){case"string":case"number":r[e]={text:t},e++;break;case"object":Array.isArray(t)?r.splice(e,1,...t):t?(t.context||(i.push(t),t.ambiguous&&t.ambiguous.length&&(i=i.concat(t.ambiguous))),e++):r.splice(e,1);break;default:throw new Error("Invalid child node: "+t)}}if(t){for(const e in t){const r=xo[e];r&&(t.on||(t.on={}),t.on[r]=t[e])}t.class&&(t.className=t.class)}return{tag:e,props:t,children:r,ambiguous:i}}To=new Set(["circle","clipPath","defs","ellipse","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]);const Ao=["a","abbr","address","article","aside","audio","b","bdi","bdo","blockquote","body","button","canvas","caption","cite","code","colgroup","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","html","i","iframe","ins","kbd","label","legend","li","main","map","mark","menu","meter","nav","noscript","object","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","u","ul","var","video","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];for(const e of Ao)Do[e]=(t,...r)=>Do(e,t,...r);for(const e of To)Do[e]=(t,...r)=>Do(e,t,...r);So=Do;var Io,Ro={},No={};No=new Map([["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["className","class"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["panose1","panose-1"],["paintOrder","paint-order"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xHeight","x-height"]]);var Lo;function Bo(e,t,r,i){if(t)for(var n in t)r&&n in r||(i?e[n]="":delete e[n]);if(r)for(var n in r){const i=t&&t[n],o=r[n];o!==i&&(e[n]=o)}}function Fo(e,t,r){if(t)for(var i in t)r&&i in r||e.removeAttribute(i);if(r)for(var i in r){const n=t&&t[i],o=r[i];o!==n&&e.setAttribute(i,o)}}function Uo(e,t){let r;if(null!=e.text)r=document.createTextNode(e.text);else{const{tag:i,children:n}=e;let{props:o,context:s}=e;if(s&&(t={refs:s.refs,listenerContext:s}),"function"==typeof i){let s;o&&o.ref&&(s=o.ref);const a=new i(o||{},n);e.component=a,r=a.element,"function"==typeof s?s(a):t&&t.refs&&s&&(t.refs[s]=a)}else To.has(i)?(r=document.createElementNS("http://www.w3.org/2000/svg",i),n&&Vo(r,n,t),o&&Io(r,null,e,t)):(r=document.createElement(i),n&&Vo(r,n,t),o&&Io(r,null,e,t))}return e.domNode=r,r}function Vo(e,t,r){for(let i=0;i<t.length;i++)e.appendChild(Uo(t[i],r))}Lo=function(e,t,r,i){r!==t&&("function"==typeof t?t(null):t&&i[t]===e&&delete i[t],"function"==typeof r?r(e):r&&(i[r]=e))},Io=function(e,t,r,i){const n=t&&t.props,o=r.props;let s,a;i&&(s=i.refs,a=i.listenerContext),function e(t,r,i,n,o){if(i)for(var s in i)"ref"!==s&&"on"!==s&&(s in xo||o&&s in o||("dataset"===s?e(t.dataset,null,i&&i.dataset,null,null):"innerHTML"!==s&&r&&To.has(r.tag)?t.removeAttribute(No.get(s)||s):(t[s]="",delete t[s])));if(o)for(var s in o)if("ref"!==s&&"on"!==s&&!(s in xo)){var a=i&&i[s],l=o[s];"dataset"===s?Bo(t.dataset,a,l,!1):"style"===s&&"string"!=typeof l?("string"==typeof a&&(t.style="",a=null),Bo(t.style,a,l,!0)):"attributes"===s?Fo(t,a,l):l!==a&&("innerHTML"!==s&&n&&To.has(n.tag)?t.setAttribute(No.get(s)||s,l):n&&"input"===n.tag&&"value"===s&&t[s]===l||(t[s]=l))}}(e,t,n,r,o),s&&Lo(e,n&&n.ref,o&&o.ref,s),function(e,t,r,i){const n=t&&t.props&&t.props.on,o=r.props&&r.props.on;for(const r in n)if(!o||!(r in o)){let i;i=t&&t.boundListeners&&t.boundListeners[r]?t.boundListeners[r]:n[r],e.removeEventListener(r,i)}for(const s in o){const a=n&&n[s],l=o[s];if(l!==a){if(a){let r;r=t&&t.boundListeners&&t.boundListeners[s]?t.boundListeners[s]:a,e.removeEventListener(s,r)}if(l){let t;i?(t=l.bind(i),r.boundListeners||(r.boundListeners={}),r.boundListeners[s]=t):t=l,e.addEventListener(s,t)}}}}(e,t,r,a)},Ro=Uo;var zo,Wo={};function $o(e,t,r){const i=e.domNode;if(t===e)return i;if(Go(e,t)){let n;return null!=t.text?(i.nodeValue=t.text,n=i):"function"==typeof t.tag?n=function(e,t,r){const{component:i,props:n}=e;let{props:o,children:s}=t;t.component=i;const a=r&&r.refs;a&&Lo(i,n&&n.ref,o&&o.ref,a);return i.update(o||{},s),i.element}(e,t,r):(!function(e,t,r,i){var n,o=0,s=t.length-1,a=t[0],l=t[s],c=0,u=r.length-1,p=r[0],h=r[u];for(;o<=s&&c<=u;)if(a)if(l)if(Go(a,p))$o(a,p,i),a=t[++o],p=r[++c];else if(Go(l,h))$o(l,h,i),l=t[--s],h=r[--u];else if(Go(a,h))$o(a,h,i),e.insertBefore(a.domNode,l.domNode.nextSibling),a=t[++o],h=r[--u];else if(Go(l,p))$o(l,p,i),e.insertBefore(l.domNode,a.domNode),l=t[--s],p=r[++c];else{n||(qo.length>0?(n=qo.pop()).clear():n=new Map,Ko(n,t,o,s));var d=Qo(p),f=d?n.get(d):null;if(null==f)e.insertBefore(Ro(p,i),a.domNode),p=r[++c];else{var v=t[f];$o(v,p,i),t[f]=void 0,e.insertBefore(v.domNode,a.domNode),p=r[++c]}}else l=t[--s];else a=t[++o];if(o>s){var m=r[u+1]?r[u+1].domNode:null;for(let t=c;t<=u;t++)e.insertBefore(Ro(r[t],i),m)}else if(c>u)for(let e=o;e<=s;e++){var g=t[e];g&&Ho(g,i&&i.refs)}n&&qo.push(n)}(i,e.children,t.children,r),Io(i,e,t,r),n=i),t.domNode=n,n!==i&&i.parentNode&&i.parentNode.replaceChild(n,i),n}{const n=i.parentNode,o=i.nextSibling;Ho(e,r&&r.refs);const s=Ro(t,r);return n&&n.insertBefore(s,o),t.domNode=s,s}}let qo=[new Map,new Map,new Map,new Map];function Ho(e,t,r=!0){const{domNode:i,props:n,children:o,component:s}=e,a=n&&n.ref;if(s)"function"==typeof a?a(null):t&&a&&t[a]===s&&delete t[a],s.destroy&&s.destroy();else if("function"==typeof a?a(null):t&&a&&t[a]===i&&delete t[a],o)for(let e=0;e<o.length;e++)Ho(o[e],t,!1);r&&i.remove()}function Go(e,t){return Qo(e)===Qo(t)&&e.tag===t.tag}function Qo(e){return e.props?e.props.key:void 0}function Ko(e,t,r,i){for(let n=r;n<=i;n++){const r=Qo(t[n]);r&&e.set(r,n)}return e}Wo=$o;var Yo,Xo={};Yo=class{constructor(){this.updateRequests=[],this.readRequests=[],this.pendingAnimationFrame=null,this.performUpdates=this.performUpdates.bind(this),this.performingUpdates=!1}updateDocument(e){this.updateRequests.push(e),this.pendingAnimationFrame||(this.pendingAnimationFrame=window.requestAnimationFrame(this.performUpdates))}readDocument(e){this.readRequests.push(e),this.pendingAnimationFrame||(this.pendingAnimationFrame=window.requestAnimationFrame(this.performUpdates))}getNextUpdatePromise(){return this.nextUpdatePromise||(this.nextUpdatePromise=new Promise(e=>{this.resolveNextUpdatePromise=e})),this.nextUpdatePromise}performUpdates(){for(;this.updateRequests.length>0;)this.updateRequests.shift()();for(this.pendingAnimationFrame=null;this.readRequests.length>0;)this.readRequests.shift()();if(this.nextUpdatePromise){let e=this.resolveNextUpdatePromise;this.nextUpdatePromise=null,this.resolveNextUpdatePromise=null,e()}}};let Zo=null;Xo.setScheduler=function(e){Zo=e};var Jo=function(){return Zo||(Zo=new Yo),Zo};Xo.getScheduler=Jo;const es=new WeakSet;let ts=0,rs=0;function is(e){return null!=e&&!1!==e}function ns(e,t){t.context=e,t.ambiguous&&(t.ambiguous.forEach(t=>{t.context=e}),delete t.ambiguous)}function os(e,t=!0){if(!is(e.virtualNode))throw new Error((e.constructor?e.constructor.name+" instance":e)+" is not associated with a valid virtualNode. Perhaps this component was never initialized?");if(null==e.element)throw new Error((e.constructor?e.constructor.name+" instance":e)+" is not associated with a DOM element. Perhaps this component was never initialized?");let r=e.render();if(!is(r)){const t=e.constructor&&e.constructor.name?" in "+e.constructor.name:"";throw new Error("invalid falsy value "+r+" returned from render()"+t)}ns(e,r),ts++;let i=e.virtualNode,n=e.element,o=Wo(i,r,{refs:e.refs,listenerContext:e});if(e.virtualNode=r,o!==n&&!t)throw new Error("The root node type changed on update, but the update was performed with the replaceNode option set to false");e.element=o,"function"==typeof e.writeAfterUpdate&&e.writeAfterUpdate(),"function"==typeof e.readAfterUpdate&&Jo().readDocument((function(){e.readAfterUpdate()})),ts--}function ss(e,t=!0){rs++,as(e.virtualNode),1===rs&&t&&e.element.remove(),rs--}function as(e){e.component&&"function"==typeof e.component.destroy?e.component.destroy():e.children&&e.children.forEach(as)}zo={initialize:function(e){if("function"!=typeof e.update)throw new Error("Etch components must implement `update(props, children)`.");let t=e.render();if(!is(t)){let r=e.constructor&&e.constructor.name?" in "+e.constructor.name:"";throw new Error("invalid falsy value "+t+" returned from render()"+r)}ns(e,t),e.refs={},e.virtualNode=t,e.element=Ro(e.virtualNode,{refs:e.refs,listenerContext:e})},update:function(e,t=!0){if(ts>0)return os(e,t),Promise.resolve();let r=Jo();return es.has(e)||(es.add(e),r.updateDocument((function(){es.delete(e),os(e,t)}))),r.getNextUpdatePromise()},updateSync:os,destroy:function(e,t=!0){if(ts>0||rs>0)return ss(e,t),Promise.resolve();let r=Jo();return r.updateDocument((function(){ss(e,t)})),r.getNextUpdatePromise()},destroySync:ss};var ls,cs,us,ps,hs,ds,fs,vs,ms,gs,ys=!1;function bs(){return ys||(ys=!0,ls={},cs=So,us=Ro,({initialize:ps,update:hs,updateSync:ds,destroy:fs,destroySync:vs}=zo),({setScheduler:ms,getScheduler:gs}=Xo),ls={dom:cs,render:us,initialize:ps,update:hs,updateSync:ds,destroy:fs,destroySync:vs,setScheduler:ms,getScheduler:gs}),ls}var ws=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_s();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs());function _s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _s=function(){return e},e}Eo=class{constructor(e){this.props=e,this.tooltipTitle=()=>{const e=void 0!==this.props.spec.displayName?this.props.spec.displayName:"Undefined name";return this.hiddenValue?`${e}: ${this.props.spec.displayTemplate(this.value)}`:e},this.disposables=new Co.CompositeDisposable,this.hiddenValue=atom.config.get("ide-haskell.hideParameterValues"),this.initStore(),this.initSpec(),ws.initialize(this),this.disposables.add(atom.config.onDidChange("ide-haskell.hideParameterValues",({newValue:e})=>{this.hiddenValue=e,(0,E.handlePromise)(this.update())})),this.disposables.add(atom.tooltips.add(this.element,{title:this.tooltipTitle}))}render(){const e=["ide-haskell--"+this.props.pluginName,"ide-haskell-param--"+this.props.name];return this.hiddenValue&&e.push("hidden-value"),ws.dom("ide-haskell-param",{class:e.join(" "),on:{click:async()=>this.setValue()}},ws.dom("ide-haskell-param-value",null,this.props.spec.displayTemplate(this.value)))}async update(e){if(e){const{pluginName:t,name:r,spec:i,store:n}=e;void 0!==t&&(this.props.pluginName=t),void 0!==r&&(this.props.name=r),i&&this.props.spec!==i&&(this.props.spec=i,this.initSpec()),n&&this.props.store!==n&&(this.props.store=n,this.initStore())}return ws.update(this)}async setValue(e){await this.props.store.setValue(this.props.pluginName,this.props.name,e),(0,E.handlePromise)(this.update())}async destroy(){await ws.destroy(this),this.disposables.dispose()}initStore(){this.storeDisposable&&this.disposables.remove(this.storeDisposable),this.storeDisposable=this.props.store.onDidUpdate(this.props.pluginName,this.props.name,({value:e})=>{this.value=e,(0,E.handlePromise)(this.update())}),this.disposables.add(this.storeDisposable),(0,E.handlePromise)(this.setValueInitial())}async setValueInitial(){return this.value=await this.props.store.getValueRaw(this.props.pluginName,this.props.name),this.update()}initSpec(){void 0===this.props.spec.displayName&&(this.props.spec.displayName=this.props.name.charAt(0).toUpperCase()+this.props.name.slice(1))}},jo.ParamControl=Eo;var Os={};Object.defineProperty(Os,"__esModule",{value:!0});var ks=void 0;Os.ConfigParamStore=ks;var Ps={};Object.defineProperty(Ps,"__esModule",{value:!0});var Ms=async function({items:e,heading:t,itemTemplate:r,itemFilterKey:i,activeItem:n}){const o=e=>{const t=document.createElement("li"),i=document.createElement("div");let o;return i.style.display="inline-block",r?(i.innerHTML=r(e),o=n&&r(e)===r(n)):(i.innerText=""+e,o=n&&e===n),o&&t.classList.add("active"),i.firstElementChild&&"LI"===i.firstElementChild.tagName&&(i.innerHTML=i.firstElementChild.innerHTML),t.appendChild(i),t},s=e=>"string"==typeof i?""+e[i]:i?i(e):""+e,a=await Promise.resolve(e);let l;const c=document.activeElement;try{return await new Promise(e=>{const r=new Gs.default({items:a,infoMessage:t,itemsClassList:["ide-haskell","mark-active"],elementForItem:o,filterKeyForItem:s,didCancelSelection:()=>{e(void 0)},didConfirmSelection:t=>{e(t)}});r.element.classList.add("ide-haskell"),l=atom.workspace.addModalPanel({item:r,visible:!0}),r.focus()})}finally{var u;null===(u=l)||void 0===u||u.destroy(),null==c||c.focus()}};Ps.selectListView=Ms;var js={},Es=js&&js.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(js,"__esModule",{value:!0});const Ss=c,xs=Es(bs()),Cs=xs.default.dom;var Ts,Ds,As,Is={},Rs=!1;function Ns(){return Rs||(Rs=!0,function(){var e,t;e=a.sep,Ts=function(t,r,i){var n,o,s,a,l;for(o=t.length-1;t[o]===e;)o--;for(l=0,s=o,n=null;o>=0;)t[o]===e?(l++,null==n&&(n=t.substring(o+1,s+1))):0===o&&(s<t.length-1?null==n&&(n=t.substring(0,s+1)):null==n&&(n=t)),o--;return n===t?i*=2:n&&(i+=Ds(n,r)),a=l+1,i*=.01*Math.max(1,10-a)},As.basenameScore=Ts,Ds=function(r,i){var n,o,s,a,l,c,u,p,h,d,f,v;if(r===i)return 1;if(t(r,i))return 1;for(d=0,u=i.length,h=r.length,s=0,a=0;s<u;){if(n=i[s++],l=r.indexOf(n.toLowerCase()),f=r.indexOf(n.toUpperCase()),-1===(c=Math.min(l,f))&&(c=Math.max(l,f)),-1===(a=c))return 0;o=.1,r[a]===n&&(o+=.1),0===a||r[a-1]===e?o+=.8:"-"!==(v=r[a-1])&&"_"!==v&&" "!==v||(o+=.7),r=r.substring(a+1,h),d+=o}return((p=d/u)*(u/h)+p)/2},As.score=Ds,t=function(t,r){if(t[t.length-r.length-1]===e)return t.lastIndexOf(r)===t.length-r.length}}.call(As={})),As}var Ls,Bs=!1;function Fs(){return Bs||(Bs=!0,function(){var e,t,r;t=Ns(),e=function(e){return e.candidate},r=function(e,t){return t.score-e.score},Ls=function(i,n,o,s){var a,l,c,u,p,h,d,f,v;if(l=(v=null!=s?s:{}).key,c=v.maxResults,n){for(p=[],d=0,f=i.length;d<f;d++)a=i[d],(h=null!=l?a[l]:a)&&(u=t.score(h,n,o),o||(u=t.basenameScore(h,n,u)),u>0&&p.push({candidate:a,score:u}));p.sort(r),i=p.map(e)}return null!=c&&(i=i.slice(0,c)),i}}.call(Ls={})),Ls}var Us,Vs,zs,Ws=!1;function $s(){return Ws||(Ws=!0,function(){var e;e=a.sep,Us=function(t,r){var i,n,o;for(n=t.length-1;t[n]===e;)n--;for(o=n,i=null;n>=0;)t[n]===e?null==i&&(i=t.substring(n+1,o+1)):0===n&&(o<t.length-1?null==i&&(i=t.substring(0,o+1)):null==i&&(i=t)),n--;return Vs(i,r,t.length-i.length)},zs.basenameMatch=Us,Vs=function(e,t,r){var i,n,o,s,a,l,c,u,p,h;if(null==r&&(r=0),e===t)return function(){h=[];for(var t=r,i=r+e.length;r<=i?t<i:t>i;r<=i?t++:t--)h.push(t);return h}.apply(this);for(c=t.length,u=e.length,n=0,o=0,a=[];n<c;){if(i=t[n++],s=e.indexOf(i.toLowerCase()),p=e.indexOf(i.toUpperCase()),-1===(l=Math.min(s,p))&&(l=Math.max(s,p)),-1===(o=l))return[];a.push(r+o),r+=o+1,e=e.substring(o+1,u)}return a},zs.match=Vs}.call(zs={})),zs}(function(){var e,t,r,i,n;n=Ns(),r=Fs(),i=$s(),e=a.sep,t=/\ /g,Is={filter:function(i,n,o){var s;return n&&(s=-1!==n.indexOf(e),n=n.replace(t,"")),r(i,n,s,o)},score:function(r,i){var o,s;return r&&i?r===i?2:(o=-1!==i.indexOf(e),i=i.replace(t,""),s=n.score(r,i),o||(s=n.basenameScore(r,i,s)),s):0},match:function(r,n){var o,s,a,l,c,u;if(!r)return[];if(!n)return[];if(r===n)return function(){u=[];for(var e=0,t=r.length;0<=t?e<t:e>t;0<=t?e++:e--)u.push(e);return u}.apply(this);if(l=-1!==n.indexOf(e),n=n.replace(t,""),a=i.match(r,n),!l)for(o=i.basenameMatch(r,n),a=a.concat(o).sort((function(e,t){return e-t})),c=null,s=0;s<a.length;)s&&c===a[s]?a.splice(s,1):(c=a[s],s++);return a}}}).call(Is);const qs=Es(Is);js=class{constructor(e){this.props=e,this.props.hasOwnProperty("initialSelectionIndex")||(this.props.initialSelectionIndex=0),e.initiallyVisibleItemCount&&this.initializeVisibilityObserver(),this.computeItems(!1),this.disposables=new Ss.CompositeDisposable,xs.default.initialize(this),this.element.classList.add("select-list"),this.disposables.add(this.refs.queryEditor.onDidChange(this.didChangeQuery.bind(this))),e.skipCommandsRegistration||this.disposables.add(this.registerAtomCommands());const t=this.refs.queryEditor.element,r=this.didLoseFocus.bind(this);t.addEventListener("blur",r),this.didClickItemsList=!1,this.element.addEventListener("mousedown",e=>{e.target===this.refs.items&&(this.didClickItemsList=!0)}),this.disposables.add(new Ss.Disposable(()=>{t.removeEventListener("blur",r)}))}static setScheduler(e){xs.default.setScheduler(e)}static getScheduler(){return xs.default.getScheduler()}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{for(const t of e)if(t.intersectionRatio>0){const e=t.target;this.visibilityObserver.unobserve(e);const r=Array.from(this.refs.items.children).indexOf(e);r>=0&&this.renderItemAtIndex(r)}})}focus(){this.refs.queryEditor.element.focus()}didLoseFocus(e){this.didClickItemsList||this.element.contains(e.relatedTarget)?(this.didClickItemsList=!1,this.refs.queryEditor.element.focus()):document.hasFocus()&&this.cancelSelection()}reset(){this.refs.queryEditor.setText("")}destroy(){return this.disposables.dispose(),this.visibilityObserver&&this.visibilityObserver.disconnect(),xs.default.destroy(this)}registerAtomCommands(){return atom.commands.add(this.element,{"core:move-up":e=>{this.selectPrevious(),e.stopPropagation()},"core:move-down":e=>{this.selectNext(),e.stopPropagation()},"core:move-to-top":e=>{this.selectFirst(),e.stopPropagation()},"core:move-to-bottom":e=>{this.selectLast(),e.stopPropagation()},"core:confirm":e=>{this.confirmSelection(),e.stopPropagation()},"core:cancel":e=>{this.cancelSelection(),e.stopPropagation()}})}update(e){let t=!1;return"items"in e&&(this.props.items=e.items,t=!0),"maxResults"in e&&(this.props.maxResults=e.maxResults,t=!0),"filter"in e&&(this.props.filter=e.filter,t=!0),"filterQuery"in e&&(this.props.filterQuery=e.filterQuery,t=!0),"query"in e&&(this.refs.queryEditor.setText(e.query),t=!1),"selectQuery"in e&&(e.selectQuery?this.refs.queryEditor.selectAll():this.refs.queryEditor.clearSelections()),"order"in e&&(this.props.order=e.order),"emptyMessage"in e&&(this.props.emptyMessage=e.emptyMessage),"errorMessage"in e&&(this.props.errorMessage=e.errorMessage),"infoMessage"in e&&(this.props.infoMessage=e.infoMessage),"loadingMessage"in e&&(this.props.loadingMessage=e.loadingMessage),"loadingBadge"in e&&(this.props.loadingBadge=e.loadingBadge),"itemsClassList"in e&&(this.props.itemsClassList=e.itemsClassList),"initialSelectionIndex"in e&&(this.props.initialSelectionIndex=e.initialSelectionIndex),t&&this.computeItems(),xs.default.update(this)}render(){return Cs.div({},Cs(Ss.TextEditor,{ref:"queryEditor",mini:!0}),this.renderLoadingMessage(),this.renderInfoMessage(),this.renderErrorMessage(),this.renderItems())}renderItems(){if(this.items.length>0){const e=["list-group"].concat(this.props.itemsClassList||[]).join(" ");return this.visibilityObserver&&xs.default.getScheduler().updateDocument(()=>{Array.from(this.refs.items.children).slice(this.props.initiallyVisibleItemCount).forEach(e=>{this.visibilityObserver.observe(e)})}),this.listItems=this.items.map((e,t)=>{const r=this.getSelectedItem()===e,i=!this.props.initiallyVisibleItemCount||t<this.props.initiallyVisibleItemCount;return Cs(Hs,{element:this.props.elementForItem(e,{selected:r,index:t,visible:i}),selected:r,onclick:()=>this.didClickItem(t)})}),Cs.ol({className:e,ref:"items"},...this.listItems)}return!this.props.loadingMessage&&this.props.emptyMessage?Cs.span({ref:"emptyMessage"},this.props.emptyMessage):""}renderErrorMessage(){return this.props.errorMessage?Cs.span({ref:"errorMessage"},this.props.errorMessage):""}renderInfoMessage(){return this.props.infoMessage?Cs.span({ref:"infoMessage"},this.props.infoMessage):""}renderLoadingMessage(){return this.props.loadingMessage?Cs.div({className:"loading"},Cs.span({ref:"loadingMessage",className:"loading-message"},this.props.loadingMessage),this.props.loadingBadge?Cs.span({ref:"loadingBadge",className:"badge"},this.props.loadingBadge):""):""}getQuery(){return this.refs&&this.refs.queryEditor?this.refs.queryEditor.getText():""}getFilterQuery(){return this.props.filterQuery?this.props.filterQuery(this.getQuery()):this.getQuery()}didChangeQuery(){this.props.didChangeQuery&&this.props.didChangeQuery(this.getFilterQuery()),this.computeItems()}didClickItem(e){this.selectIndex(e),this.confirmSelection()}computeItems(e){this.listItems=null,this.visibilityObserver&&this.visibilityObserver.disconnect();const t=this.props.filter||this.fuzzyFilter.bind(this);this.items=t(this.props.items.slice(),this.getFilterQuery()),this.props.order&&this.items.sort(this.props.order),this.props.maxResults&&(this.items=this.items.slice(0,this.props.maxResults)),this.selectIndex(this.props.initialSelectionIndex,e)}fuzzyFilter(e,t){if(0===t.length)return e;{const r=[];for(const i of e){const e=this.props.filterKeyForItem?this.props.filterKeyForItem(i):i,n=qs.default.score(e,t);n>0&&r.push({item:i,score:n})}return r.sort((e,t)=>t.score-e.score),r.map(e=>e.item)}}getSelectedItem(){return void 0===this.selectionIndex?null:this.items[this.selectionIndex]}renderItemAtIndex(e){const t=this.items[e],r=this.getSelectedItem()===t,i=this.listItems[e].component;this.visibilityObserver&&this.visibilityObserver.unobserve(i.element),i.update({element:this.props.elementForItem(t,{selected:r,index:e,visible:!0}),selected:r,onclick:()=>this.didClickItem(e)})}selectPrevious(){return void 0===this.selectionIndex?this.selectLast():this.selectIndex(this.selectionIndex-1)}selectNext(){return void 0===this.selectionIndex?this.selectFirst():this.selectIndex(this.selectionIndex+1)}selectFirst(){return this.selectIndex(0)}selectLast(){return this.selectIndex(this.items.length-1)}selectNone(){return this.selectIndex(void 0)}selectIndex(e,t=!0){e>=this.items.length?e=0:e<0&&(e=this.items.length-1);const r=this.selectionIndex;return this.selectionIndex=e,void 0!==e&&this.props.didChangeSelection&&this.props.didChangeSelection(this.getSelectedItem()),t?this.listItems?(r>=0&&this.renderItemAtIndex(r),e>=0&&this.renderItemAtIndex(e),xs.default.getScheduler().getNextUpdatePromise()):xs.default.update(this):Promise.resolve()}selectItem(e){const t=this.items.indexOf(e);if(-1===t)throw new Error("Cannot select the specified item because it does not exist.");return this.selectIndex(t)}confirmSelection(){const e=this.getSelectedItem();null!=e?this.props.didConfirmSelection&&this.props.didConfirmSelection(e):this.props.didConfirmEmptySelection&&this.props.didConfirmEmptySelection()}cancelSelection(){this.props.didCancelSelection&&this.props.didCancelSelection()}};class Hs{constructor(e){this.mouseDown=this.mouseDown.bind(this),this.mouseUp=this.mouseUp.bind(this),this.didClick=this.didClick.bind(this),this.selected=e.selected,this.onclick=e.onclick,this.element=e.element,this.element.addEventListener("mousedown",this.mouseDown),this.element.addEventListener("mouseup",this.mouseUp),this.element.addEventListener("click",this.didClick),this.selected&&this.element.classList.add("selected"),this.domEventsDisposable=new Ss.Disposable(()=>{this.element.removeEventListener("mousedown",this.mouseDown),this.element.removeEventListener("mouseup",this.mouseUp),this.element.removeEventListener("click",this.didClick)}),xs.default.getScheduler().updateDocument(this.scrollIntoViewIfNeeded.bind(this))}mouseDown(e){e.preventDefault()}mouseUp(e){e.preventDefault()}didClick(e){e.preventDefault(),this.onclick()}destroy(){this.element.remove(),this.domEventsDisposable.dispose()}update(e){this.element.removeEventListener("mousedown",this.mouseDown),this.element.removeEventListener("mouseup",this.mouseUp),this.element.removeEventListener("click",this.didClick),this.element.parentNode.replaceChild(e.element,this.element),this.element=e.element,this.element.addEventListener("mousedown",this.mouseDown),this.element.addEventListener("mouseup",this.mouseUp),this.element.addEventListener("click",this.didClick),e.selected&&this.element.classList.add("selected"),this.selected=e.selected,this.onclick=e.onclick,xs.default.getScheduler().updateDocument(this.scrollIntoViewIfNeeded.bind(this))}scrollIntoViewIfNeeded(){this.selected&&this.element.scrollIntoViewIfNeeded(!1)}}var Gs=function(e){return e&&e.__esModule?e:{default:e}}(js);var Qs=c;ks=class{constructor(e={}){this.disposables=new Qs.CompositeDisposable,this.emitter=new Qs.Emitter,this.disposables.add(this.emitter),this.saved=e,this.plugins=new Map}serialize(){return this.saved}destroy(){this.disposables.dispose()}onDidUpdate(e,t,r){return this.emitter.on("did-update",i=>{i.pluginName===e&&i.paramName===t&&r(i)})}addParamSpec(e,t,r){let i=this.plugins.get(e);if(i||(i=new Map,this.plugins.set(e,i)),i.has(t))throw new Error(`Parameter ${e}.${t} already defined!`);let n=this.saved[`${e}.${t}`];return void 0===n&&(n=r.default),i.set(t,{spec:r,value:n}),this.emitter.emit("did-update",{pluginName:e,paramName:t,value:n}),new Qs.Disposable(()=>{i&&(i.delete(t),0===i.size&&this.plugins.delete(e))})}async setValue(e,t,r){const i=await this.getParamConfig(e,t,"set");if(void 0!==i)return void 0===r&&(r=await this.showSelect(i)),void 0!==r&&(i.value=r,this.saved[`${e}.${t}`]=r,this.emitter.emit("did-update",{pluginName:e,paramName:t,value:r})),r}async getValue(e,t){const r=await this.getParamConfig(e,t,"get");if(void 0!==r)return void 0===r.value&&await this.setValue(e,t),r.value}async getValueRaw(e,t){const r=await this.getParamConfig(e,t,"get raw");if(void 0!==r)return r.value}async getParamConfig(e,t,r){if(!atom.packages.isPackageLoaded(e))return void console.error(new Error(`No ${e} package while trying to ${r} ${e}.${t}`));atom.packages.isPackageActive(e)||await atom.packages.activatePackage(e);const i=this.plugins.get(e);if(!i)throw new Error(`${e} is not defined while trying to ${r} ${e}.${t}`);const n=i.get(t);if(!n)throw new Error(`${t} is not defined while trying to ${r} ${e}.${t}`);return n}async showSelect(e){const t=e.spec;return(0,Ps.selectListView)({items:"function"==typeof t.items?t.items():t.items,heading:t.description,itemTemplate:t.itemTemplate.bind(t),itemFilterKey:t.itemFilterKey,activeItem:e.value})}},Os.ConfigParamStore=ks;Po=class{constructor(e,t){this.outputPanel=e,this.store=new Os.ConfigParamStore(t)}destroy(){this.store.destroy()}serialize(){return this.store.serialize()}add(e,t,r){const i=new Mo.CompositeDisposable;return i.add(this.store.addParamSpec(e,t,r),this.outputPanel.addPanelControl({element:jo.ParamControl,opts:{pluginName:e,name:t,spec:r,store:this.store}})),i}async get(e,t){return this.store.getValue(e,t)}async set(e,t,r){return this.store.setValue(e,t,r)}},ko.ConfigParamManager=Po;var Ks={};Object.defineProperty(Ks,"__esModule",{value:!0});var Ys=void 0;Ks.EditorControl=Ys;var Xs=c,Zs={};Object.defineProperty(Zs,"__esModule",{value:!0});var Js=void 0;Zs.EditorOverlayManager=Js;var ea={};Object.defineProperty(ea,"__esModule",{value:!0});var ta=void 0;ea.EventTable=ta;ta=class{constructor(e,t){this.editor=e,this.table=Object.create(null);for(const e of E.eventRangeTypeVals)this.table[e]=new Map;this.layers=new Set;for(const e of t){const t=this.editor.addMarkerLayer();this.layers.add(t);for(const{type:r,source:i}of e)this.table[r].set(i,t)}}destroy(){for(const e of this.layers.values())e.destroy();for(const e of E.eventRangeTypeVals)this.table[e].clear()}get(e,t){const r=this.table[e];let i=r.get(t);if(i||(i=r.get(void 0)),!i)throw new Error(`Failed to classify ${e}:${t}`);return i}clear(){for(const e of this.layers.values())e.clear()}getMarkerCount(){let e=0;for(const t of this.layers.values())e+=t.getMarkerCount();return e}},ea.EventTable=ta;Js=class{constructor(e){this.editor=e,this.markers=new ea.EventTable(e,[[{type:"keyboard"},{type:"context"}],[{type:"mouse"},{type:"selection"}]]),this.editorElement=atom.views.getView(this.editor)}dispose(){this.markers.destroy(),this.editorElement.classList.remove("ide-haskell--has-tooltips")}show(e,t,r,i,n){this.hide(t,r);const o=this.markers.get(t,r).markBufferRange(e);o.setProperties(i),this.decorate(o,n),this.editorElement.classList.add("ide-haskell--has-tooltips")}hide(e,t,r){void 0!==e?(r?this.markers.get(e,t).findMarkers(r).forEach(e=>e.destroy()):this.markers.get(e,t).clear(),this.has()||this.editorElement.classList.remove("ide-haskell--has-tooltips")):this.markers.clear()}has(e,t,r){return void 0===e?this.markers.getMarkerCount()>0:r?this.markers.get(e,t).findMarkers(r).length>0:this.markers.get(e,t).getMarkerCount()>0}decorate(e,t){this.editor.decorateMarker(e,{type:"overlay",position:"tail",item:t}),this.editor.decorateMarker(e,{type:"highlight",class:"ide-haskell-type"})}},Zs.EditorOverlayManager=Js;Ys=class{constructor(e,t){this.editor=e,this.trackMouseBufferPosition=e=>{const t=(0,E.bufferPositionFromMouseEvent)(this.editor,e);t&&(this.lastMouseBufferPt&&this.lastMouseBufferPt.isEqual(t)||(this.lastMouseBufferPt=t,void 0!==this.exprTypeTimeout&&clearTimeout(this.exprTypeTimeout),this.exprTypeTimeout=window.setTimeout(()=>{this.shouldShowTooltip(t,"mouse")},atom.config.get("ide-haskell.expressionTypeInterval",{scope:this.editor.getRootScopeDescriptor()}))))},this.stopTrackingMouseBufferPosition=()=>{if(void 0!==this.exprTypeTimeout)return clearTimeout(this.exprTypeTimeout)},this.trackSelection=({newBufferRange:e})=>{this.handleCursorUnderTooltip(e),void 0!==this.selTimeout&&clearTimeout(this.selTimeout),e.isEmpty()?(this.tooltips.hide("selection"),void 0!==this.exprTypeTimeout&&clearTimeout(this.exprTypeTimeout),(0,E.handlePromise)(this.tooltipManager.showTooltip(this.editor,"keyboard")),"Hide Tooltip"===atom.config.get("ide-haskell.onCursorMove",{scope:this.editor.getRootScopeDescriptor()})&&(this.tooltips.hide("mouse",void 0,{persistent:!1}),this.tooltips.hide("context",void 0,{persistent:!1}))):this.selTimeout=window.setTimeout(()=>this.shouldShowTooltip(e.start,"selection"),atom.config.get("ide-haskell.expressionTypeInterval",{scope:this.editor.getRootScopeDescriptor()}))},this.disposables=new Xs.CompositeDisposable,this.tooltips=new Zs.EditorOverlayManager(this.editor),this.disposables.add(this.tooltips),this.tooltipManager=t.tooltipManager,this.editorElement=atom.views.getView(this.editor);const r=this.editor.getBuffer();this.disposables.add(r.onWillSave(async()=>{await t.willSaveBuffer(r)}),r.onDidSave(()=>t.didSaveBuffer(r)),this.editor.onDidStopChanging(()=>t.didStopChanging(r)),this.editorElement.onDidChangeScrollLeft(()=>this.tooltips.hide("mouse")),this.editorElement.onDidChangeScrollTop(()=>this.tooltips.hide("mouse")),(0,E.listen)(this.editorElement,"mousemove",".scroll-view",this.trackMouseBufferPosition),(0,E.listen)(this.editorElement,"mouseout",".scroll-view",this.stopTrackingMouseBufferPosition),this.editor.onDidChangeSelectionRange(this.trackSelection))}static supportsGrammar(e){return["source.haskell","text.tex.latex.haskell"].includes(e)}destroy(){void 0!==this.exprTypeTimeout&&clearTimeout(this.exprTypeTimeout),void 0!==this.selTimeout&&clearTimeout(this.selTimeout),this.disposables.dispose(),this.lastMouseBufferPt=void 0}getEventRange(e){let t,r;switch(e){case"mouse":case"context":if(!this.lastMouseBufferPt)return;r=this.lastMouseBufferPt;const e=this.editor.getSelections().map(e=>e.getBufferRange()).filter(e=>e.containsPoint(r));t=e.length>0?e[0]:new Xs.Range(r,r);break;case"keyboard":case"selection":t=this.editor.getLastSelection().getBufferRange(),r=t.start;break;default:throw new TypeError("Switch assertion failed")}return{crange:t,pos:r,eventType:e}}shouldShowTooltip(e,t){e.row<0||e.row>=this.editor.getLineCount()||e.isEqual(this.editor.getBuffer().rangeForRow(e.row,!1).end)?this.tooltips.hide(t):(0,E.handlePromise)(this.tooltipManager.showTooltip(this.editor,t))}handleCursorUnderTooltip(e){const t=document.querySelector("ide-haskell-tooltip");if(!t)return;const r=this.editorElement.pixelRectForScreenRange(this.editor.screenRangeForBufferRange(e)),i=this.editorElement.querySelector(".scroll-view");if(!i)return;const n=i.getBoundingClientRect(),o=t.getBoundingClientRect(),s=t.querySelector("div");if(!s)return;const a=s.getBoundingClientRect(),l={left:o.left-n.left,top:a.top-n.top,width:o.width,height:a.height},c=Math.round(Math.max(l.left,r.left)),u=Math.round(Math.min(l.left+l.width,r.left+r.width)),p=Math.round(Math.max(l.top,r.top)),h=Math.round(Math.min(l.top+l.height,r.top+r.height)),d=document.querySelector("ide-haskell-tooltip");d&&(p<=h&&c<=u?d.classList.add("ide-haskell-tooltip-subdued"):d.classList.remove("ide-haskell-tooltip-subdued"))}},Ks.EditorControl=Ys;var ra={};Object.defineProperty(ra,"__esModule",{value:!0});var ia=void 0;ra.LinterSupport=ia;var na=c;ia=class{constructor(e,t){this.linter=e,this.resultDb=t,this.update=()=>{this.linter.clearMessages(),this.linter.setAllMessages(Array.from(this.messages()))},this.disposables=new na.CompositeDisposable,this.disposables.add(t.onDidUpdate(this.update))}destroy(){this.disposables.dispose(),this.linter.dispose()}*messages(){for(const e of this.resultDb.results())if(void 0!==e.uri&&e.position){let t;switch(e.severity){case"error":case"warning":t=e.severity;break;default:t="info"}yield{severity:t,excerpt:e.message.toPlain(),location:{file:e.uri,position:new na.Range(e.position,e.position.translate([0,1]))}}}}},ra.LinterSupport=ia;var oa={};Object.defineProperty(oa,"__esModule",{value:!0});var sa=void 0;oa.TooltipRegistry=sa;var aa={};Object.defineProperty(aa,"__esModule",{value:!0});var la=void 0;aa.PriorityRegistry=la;var ca=c;la=class{constructor(){this.providers=[]}dispose(){this.providers=[]}register(e,t){const r=this.providers.findIndex(({priority:e})=>e<t.priority),i={pluginName:e,eventTypes:t.eventTypes?t.eventTypes:["selection","mouse","context"],priority:t.priority,handler:t.handler};return-1===r?this.providers.push(i):this.providers.splice(r,0,i),new ca.Disposable(()=>{const e=this.providers.indexOf(i);this.providers.splice(e,1)})}},aa.PriorityRegistry=la;class ua extends aa.PriorityRegistry{constructor(e){super(),this.pluginManager=e}async defaultTooltipFunction(e,t,r){for(const{pluginName:i,handler:n,eventTypes:o}of this.providers){if(!o.includes(t))continue;const s=this.pluginManager.getAwaiter(i),a=await s(()=>n(e,r,t));if(void 0!==a)return{pluginName:i,tooltipData:a}}}}sa=ua,oa.TooltipRegistry=sa;var pa={};Object.defineProperty(pa,"__esModule",{value:!0});var ha=void 0;pa.CheckResultsProvider=ha;var da=c,fa={};Object.defineProperty(fa,"__esModule",{value:!0});var va=void 0;fa.CREditorControl=va;var ma=c;va=class{constructor(e,t){this.editor=e,this.updateResults=()=>{const e=this.editor.getPath(),t=this.resultsDB.filter(t=>t.uri===e&&t.isValid()),r=this.markers.getMarkers(),i=t.filter(e=>r.every(t=>this.markerProps.get(t)!==e));r.filter(e=>{const r=this.markerProps.get(e);return!r||!t.includes(r)}).forEach(e=>e.destroy());for(const e of i)this.markerFromCheckResult(e)};const r=this.editor.gutterWithName("ide-haskell-check-results");this.gutter=r||this.editor.addGutter({name:"ide-haskell-check-results",priority:10}),this.gutterElement=atom.views.getView(this.gutter),this.resultsDB=t.resultsDB,this.tooltipManager=t.tooltipManager,this.disposables=new ma.CompositeDisposable,this.markers=e.addMarkerLayer({maintainHistory:!0,persistent:!1}),this.markerProps=new WeakMap,this.disposables.add(this.resultsDB.onDidUpdate(this.updateResults)),this.updateResults(),this.registerGutterEvents()}static supportsGrammar(e){return["source.c2hs","source.hsc2hs","source.haskell","text.tex.latex.haskell","source.hsig"].includes(e)}destroy(){this.markers.destroy(),this.disposables.dispose();try{this.gutter.destroy()}catch(e){console.warn(e)}}getMessageAt(e,t){return Array.from(this.getResultAt(e,t)).map(e=>e.message)}*getResultAt(e,t){const r=this.find(e,t);for(const e of r){if(!e.isValid())continue;const t=this.markerProps.get(e);t&&(yield t)}}registerGutterEvents(){this.disposables.add((0,E.listen)(this.gutterElement,"mouseover",".decoration",e=>{const t=(0,E.bufferPositionFromMouseEvent)(this.editor,e);if(t){const e=this.getMessageAt(t,"gutter");e.length>0&&(0,E.handlePromise)(this.tooltipManager.showTooltip(this.editor,"mouse",{pluginName:"builtin:check-results",tooltip:{text:e,range:new ma.Range(t,t)}}))}})),this.disposables.add((0,E.listen)(this.gutterElement,"mouseout",".decoration",()=>this.tooltipManager.hideTooltip(this.editor,"mouse","builtin:check-results")))}markerFromCheckResult(e){const{position:t}=e;if(!t)return;const r=new ma.Range(t,ma.Point.fromObject([t.row,t.column+1])),i=this.markers.markBufferRange(r,{invalidate:"inside"});this.markerProps.set(i,e);const n=new ma.CompositeDisposable;n.add(i.onDidDestroy(()=>{this.markerProps.delete(i),n.dispose()}),i.onDidChange(({isValid:t})=>{e.setValid(t)})),this.decorateMarker(i,e)}decorateMarker(e,t){const r={class:"ide-haskell-"+t.severity};this.gutter.decorateMarker(e,{type:"line-number",...r}),this.editor.decorateMarker(e,{type:"highlight",...r})}find(e,t){switch(t){case"gutter":return this.markers.findMarkers({startBufferRow:e.row});case"keyboard":return this.markers.findMarkers({startBufferPosition:e});case"mouse":return this.markers.findMarkers({containsBufferPosition:e});default:throw new TypeError("Switch assertion failed")}}},fa.CREditorControl=va;ha=class{constructor(e){this.pluginManager=e,this.tooltipProvider=(e,t,r)=>{const i=this.pluginManager.controllerType(fa.CREditorControl,e);if(!i)return;if("keyboard"===r&&"Show Tooltip"!==atom.config.get("ide-haskell.onCursorMove",{scope:e.getRootScopeDescriptor()}))return;const n=i.getMessageAt(t.start,r);return n.length>0?{range:t,text:n}:void 0};const t=e.tooltipRegistry;this.disposables=new da.CompositeDisposable,this.disposables.add(t.register("builtin:check-results",{priority:1e3,handler:this.tooltipProvider,eventTypes:["mouse","keyboard"]}),e.addEditorController(fa.CREditorControl))}destroy(){this.disposables.dispose()}},pa.CheckResultsProvider=ha;var ga={};Object.defineProperty(ga,"__esModule",{value:!0});var ya=void 0;ga.StatusBarView=ya;var ba=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=wa();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs());function wa(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return wa=function(){return e},e}ya=class{constructor(e,t){this.panel=e,this.bsc=t,this.didClick=()=>{(0,E.handlePromise)(this.panel.toggle())},ba.initialize(this),this.disp=t.onDidUpdate(()=>{(0,E.handlePromise)(this.update())})}render(){return ba.dom("div",{class:"ide-haskell inline-block",on:{click:this.didClick}},ba.dom("span",null,ba.dom("ide-haskell-lambda",null),this.bsc.renderStatusIcon()))}async update(){return ba.update(this)}destroy(){this.disp.dispose(),(0,E.handlePromise)(ba.destroy(this))}},ga.StatusBarView=ya;var _a={};Object.defineProperty(_a,"__esModule",{value:!0}),Object.defineProperty(_a,"prettifyFile",{enumerable:!0,get:function(){return Oa.prettifyFile}}),Object.defineProperty(_a,"PrettifyEditorController",{enumerable:!0,get:function(){return ku.PrettifyEditorController}});var Oa={};Object.defineProperty(Oa,"__esModule",{value:!0});var ka=async function(e){const[t,...r]=e.getCursors().map(e=>e.getBufferPosition()),i="source.cabal"===e.getGrammar().scopeName?Ma.format:_u.format,n=(await(0,Pa.getRootDir)(e.getBuffer())).getPath();try{const{stdout:o,stderr:s}=await i(e.getText(),n,e.getRootScopeDescriptor());e.setText(o);const a=e.getLastCursor();a&&a.setBufferPosition(t,{autoscroll:!1}),r.forEach(t=>{e.addCursorAtBufferPosition(t,{autoscroll:!1})}),s.length>0&&atom.notifications.addWarning("Prettifier reported the following problems:",{detail:s,dismissable:!0})}catch(e){const t=e.error||e;let r=e.stderr?e.stderr.trim():"";t.message.includes(r)&&(r=""),atom.notifications.addError("Failed to prettify",{detail:`${r?r+"\n\n":""}${t.message}`,stack:t.stack,dismissable:!0})}};Oa.prettifyFile=ka;var Pa=s,Ma={};Object.defineProperty(Ma,"__esModule",{value:!0});var ja=async function(e,t,r){const{path:i,fd:n}=await async function(e){return new Promise((t,r)=>{hu.open({prefix:"ide-haskell",suffix:".cabal"},(i,n)=>{if(i)return console.error(i),r(i);Ea.writeSync(n.fd,e),t(n)})})}(e);try{const e=atom.config.get("ide-haskell.cabalPath",{scope:r}),{stderr:o}=await(0,du.runFilter)({command:e,args:["format",i],cwd:t});return{stdout:await bu(i),stderr:o}}finally{Ea.close(n,wu),Ea.unlink(i,wu)}};Ma.format=ja;var Ea=yu(o),Sa={};let xa=o,Ca=a,Ta=n,Da=i;var Aa={};Aa=Cc,Cc.sync=Rc;var Ia=r,Ra=a,Na=o,La={};La=Oc;var Ba=o,Fa={};Fa=Ja,Ja.realpath=Ja,Ja.sync=el,Ja.realpathSync=el,Ja.monkeypatch=function(){Ua.realpath=Ja,Ua.realpathSync=el},Ja.unmonkeypatch=function(){Ua.realpath=Va,Ua.realpathSync=za};var Ua=o,Va=Ua.realpath,za=Ua.realpathSync,Wa=process.version,$a=/^v[0-5]\./.test(Wa),qa=a,Ha="win32"===process.platform,Ga=o,Qa=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function Ka(e){return"function"==typeof e?e:function(){var e;if(Qa){var t=new Error;e=function(e){e&&(t.message=e.message,r(e=t))}}else e=r;return e;function r(e){if(e){if(process.throwDeprecation)throw e;if(!process.noDeprecation){var t="fs: missing callback "+(e.stack||e.message);process.traceDeprecation?console.trace(t):console.error(t)}}}}()}qa.normalize;if(Ha)var Ya=/(.*?)(?:[\/\\]+|$)/g;else Ya=/(.*?)(?:[\/]+|$)/g;if(Ha)var Xa=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/;else Xa=/^[\/]*/;function Za(e){return e&&"realpath"===e.syscall&&("ELOOP"===e.code||"ENOMEM"===e.code||"ENAMETOOLONG"===e.code)}function Ja(e,t,r){if($a)return Va(e,t,r);"function"==typeof t&&(r=t,t=null),Va(e,t,(function(i,n){Za(i)?function(e,t,r){if("function"!=typeof r&&(r=Ka(t),t=null),e=qa.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(r.bind(null,null,t[e]));var i,n,o,s,a=e,l={},c={};function u(){var t=Xa.exec(e);i=t[0].length,n=t[0],o=t[0],s="",Ha&&!c[o]?Ga.lstat(o,(function(e){if(e)return r(e);c[o]=!0,p()})):process.nextTick(p)}function p(){if(i>=e.length)return t&&(t[a]=e),r(null,e);Ya.lastIndex=i;var l=Ya.exec(e);return s=n,n+=l[0],o=s+l[1],i=Ya.lastIndex,c[o]||t&&t[o]===o?process.nextTick(p):t&&Object.prototype.hasOwnProperty.call(t,o)?f(t[o]):Ga.lstat(o,h)}function h(e,i){if(e)return r(e);if(!i.isSymbolicLink())return c[o]=!0,t&&(t[o]=o),process.nextTick(p);if(!Ha){var n=i.dev.toString(32)+":"+i.ino.toString(32);if(l.hasOwnProperty(n))return d(null,l[n],o)}Ga.stat(o,(function(e){if(e)return r(e);Ga.readlink(o,(function(e,t){Ha||(l[n]=t),d(e,t)}))}))}function d(e,i,n){if(e)return r(e);var o=qa.resolve(s,i);t&&(t[n]=o),f(o)}function f(t){e=qa.resolve(t,e.slice(i)),u()}u()}(e,t,r):r(i,n)}))}function el(e,t){if($a)return za(e,t);try{return za(e,t)}catch(r){if(Za(r))return function(e,t){if(e=qa.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var r,i,n,o,s=e,a={},l={};function c(){var t=Xa.exec(e);r=t[0].length,i=t[0],n=t[0],o="",Ha&&!l[n]&&(Ga.lstatSync(n),l[n]=!0)}for(c();r<e.length;){Ya.lastIndex=r;var u=Ya.exec(e);if(o=i,i+=u[0],n=o+u[1],r=Ya.lastIndex,!(l[n]||t&&t[n]===n)){var p;if(t&&Object.prototype.hasOwnProperty.call(t,n))p=t[n];else{var h=Ga.lstatSync(n);if(!h.isSymbolicLink()){l[n]=!0,t&&(t[n]=n);continue}var d=null;if(!Ha){var f=h.dev.toString(32)+":"+h.ino.toString(32);a.hasOwnProperty(f)&&(d=a[f])}null===d&&(Ga.statSync(n),d=Ga.readlinkSync(n)),p=qa.resolve(o,d),t&&(t[n]=p),Ha||(a[f]=d)}e=qa.resolve(p,e.slice(r)),c()}}return t&&(t[s]=e),e}(e,t);throw r}}var tl;tl=jl,jl.Minimatch=El;var rl={sep:"/"};try{rl=function(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}("path")}catch(e){}var il,nl=jl.GLOBSTAR=El.GLOBSTAR={},ol={};il=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=t(e[i],i);sl(n)?r.push.apply(r,n):r.push(n)}return r};var sl=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},al={};function ll(e,t,r){e instanceof RegExp&&(e=cl(e,r)),t instanceof RegExp&&(t=cl(t,r));var i=ul(e,t,r);return i&&{start:i[0],end:i[1],pre:r.slice(0,i[0]),body:r.slice(i[0]+e.length,i[1]),post:r.slice(i[1]+t.length)}}function cl(e,t){var r=t.match(e);return r?r[0]:null}function ul(e,t,r){var i,n,o,s,a,l=r.indexOf(e),c=r.indexOf(t,l+1),u=l;if(l>=0&&c>0){for(i=[],o=r.length;u>=0&&!a;)u==l?(i.push(u),l=r.indexOf(e,u+1)):1==i.length?a=[i.pop(),c]:((n=i.pop())<o&&(o=n,s=c),c=r.indexOf(t,u+1)),u=l<c&&l>=0?l:c;i.length&&(a=[o,s])}return a}al=ll,ll.range=ul,ol=function(e){if(!e)return[];"{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2));return function e(t,r){var i=[],n=al("{","}",t);if(!n||/\$$/.test(n.pre))return[t];var o,s=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),a=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),l=s||a,c=n.body.indexOf(",")>=0;if(!l&&!c)return n.post.match(/,.*\}/)?(t=n.pre+"{"+n.body+dl+n.post,e(t)):[t];if(l)o=n.body.split(/\.\./);else{if(1===(o=function e(t){if(!t)return[""];var r=[],i=al("{","}",t);if(!i)return t.split(",");var n=i.pre,o=i.body,s=i.post,a=n.split(",");a[a.length-1]+="{"+o+"}";var l=e(s);s.length&&(a[a.length-1]+=l.shift(),a.push.apply(a,l));return r.push.apply(r,a),r}(n.body)).length)if(1===(o=e(o[0],!1).map(yl)).length)return(h=n.post.length?e(n.post,!1):[""]).map((function(e){return n.pre+o[0]+e}))}var u,p=n.pre,h=n.post.length?e(n.post,!1):[""];if(l){var d=ml(o[0]),f=ml(o[1]),v=Math.max(o[0].length,o[1].length),m=3==o.length?Math.abs(ml(o[2])):1,g=wl;f<d&&(m*=-1,g=_l);var y=o.some(bl);u=[];for(var b=d;g(b,f);b+=m){var w;if(a)"\\"===(w=String.fromCharCode(b))&&(w="");else if(w=String(b),y){var _=v-w.length;if(_>0){var O=new Array(_+1).join("0");w=b<0?"-"+O+w.slice(1):O+w}}u.push(w)}}else u=il(o,(function(t){return e(t,!1)}));for(var k=0;k<u.length;k++)for(var P=0;P<h.length;P++){var M=p+u[k]+h[P];(!r||l||M)&&i.push(M)}return i}(function(e){return e.split("\\\\").join(pl).split("\\{").join(hl).split("\\}").join(dl).split("\\,").join(fl).split("\\.").join(vl)}(e),!0).map(gl)};var pl="\0SLASH"+Math.random()+"\0",hl="\0OPEN"+Math.random()+"\0",dl="\0CLOSE"+Math.random()+"\0",fl="\0COMMA"+Math.random()+"\0",vl="\0PERIOD"+Math.random()+"\0";function ml(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function gl(e){return e.split(pl).join("\\").split(hl).join("{").split(dl).join("}").split(fl).join(",").split(vl).join(".")}function yl(e){return"{"+e+"}"}function bl(e){return/^-?0\d/.test(e)}function wl(e,t){return e<=t}function _l(e,t){return e>=t}var Ol={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},kl="().*{}+?[]^$\\!".split("").reduce((function(e,t){return e[t]=!0,e}),{});var Pl=/\/+/;function Ml(e,t){e=e||{},t=t||{};var r={};return Object.keys(t).forEach((function(e){r[e]=t[e]})),Object.keys(e).forEach((function(t){r[t]=e[t]})),r}function jl(e,t,r){if("string"!=typeof t)throw new TypeError("glob pattern string required");return r||(r={}),!(!r.nocomment&&"#"===t.charAt(0))&&(""===t.trim()?""===e:new El(t,r).match(e))}function El(e,t){if(!(this instanceof El))return new El(e,t);if("string"!=typeof e)throw new TypeError("glob pattern string required");t||(t={}),e=e.trim(),"/"!==rl.sep&&(e=e.split(rl.sep).join("/")),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}function Sl(e,t){if(t||(t=this instanceof El?this.options:{}),void 0===(e=void 0===e?this.pattern:e))throw new TypeError("undefined pattern");return t.nobrace||!e.match(/\{.*\}/)?[e]:ol(e)}jl.filter=function(e,t){return t=t||{},function(r,i,n){return jl(r,e,t)}},jl.defaults=function(e){if(!e||!Object.keys(e).length)return jl;var t=jl,r=function(r,i,n){return t.minimatch(r,i,Ml(e,n))};return r.Minimatch=function(r,i){return new t.Minimatch(r,Ml(e,i))},r},El.defaults=function(e){return e&&Object.keys(e).length?jl.defaults(e).Minimatch:El},El.prototype.debug=function(){},El.prototype.make=function(){if(this._made)return;var e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate();var r=this.globSet=this.braceExpand();t.debug&&(this.debug=console.error);this.debug(this.pattern,r),r=this.globParts=r.map((function(e){return e.split(Pl)})),this.debug(this.pattern,r),r=r.map((function(e,t,r){return e.map(this.parse,this)}),this),this.debug(this.pattern,r),r=r.filter((function(e){return-1===e.indexOf(!1)})),this.debug(this.pattern,r),this.set=r},El.prototype.parseNegate=function(){var e=this.pattern,t=!1,r=this.options,i=0;if(r.nonegate)return;for(var n=0,o=e.length;n<o&&"!"===e.charAt(n);n++)t=!t,i++;i&&(this.pattern=e.substr(i));this.negate=t},jl.braceExpand=function(e,t){return Sl(e,t)},El.prototype.braceExpand=Sl,El.prototype.parse=function(e,t){if(e.length>65536)throw new TypeError("pattern is too long");var r=this.options;if(!r.noglobstar&&"**"===e)return nl;if(""===e)return"";var i,n="",o=!!r.nocase,s=!1,a=[],l=[],c=!1,u=-1,p=-1,h="."===e.charAt(0)?"":r.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",d=this;function f(){if(i){switch(i){case"*":n+="[^/]*?",o=!0;break;case"?":n+="[^/]",o=!0;break;default:n+="\\"+i}d.debug("clearStateChar %j %j",i,n),i=!1}}for(var v,m=0,g=e.length;m<g&&(v=e.charAt(m));m++)if(this.debug("%s\t%s %s %j",e,m,n,v),s&&kl[v])n+="\\"+v,s=!1;else switch(v){case"/":return!1;case"\\":f(),s=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",e,m,n,v),c){this.debug("  in class"),"!"===v&&m===p+1&&(v="^"),n+=v;continue}d.debug("call clearStateChar %j",i),f(),i=v,r.noext&&f();continue;case"(":if(c){n+="(";continue}if(!i){n+="\\(";continue}a.push({type:i,start:m-1,reStart:n.length,open:Ol[i].open,close:Ol[i].close}),n+="!"===i?"(?:(?!(?:":"(?:",this.debug("plType %j %j",i,n),i=!1;continue;case")":if(c||!a.length){n+="\\)";continue}f(),o=!0;var y=a.pop();n+=y.close,"!"===y.type&&l.push(y),y.reEnd=n.length;continue;case"|":if(c||!a.length||s){n+="\\|",s=!1;continue}f(),n+="|";continue;case"[":if(f(),c){n+="\\"+v;continue}c=!0,p=m,u=n.length,n+=v;continue;case"]":if(m===p+1||!c){n+="\\"+v,s=!1;continue}if(c){var b=e.substring(p+1,m);try{RegExp("["+b+"]")}catch(e){var w=this.parse(b,xl);n=n.substr(0,u)+"\\["+w[0]+"\\]",o=o||w[1],c=!1;continue}}o=!0,c=!1,n+=v;continue;default:f(),s?s=!1:!kl[v]||"^"===v&&c||(n+="\\"),n+=v}c&&(b=e.substr(p+1),w=this.parse(b,xl),n=n.substr(0,u)+"\\["+w[0],o=o||w[1]);for(y=a.pop();y;y=a.pop()){var _=n.slice(y.reStart+y.open.length);this.debug("setting tail",n,y),_=_.replace(/((?:\\{2}){0,64})(\\?)\|/g,(function(e,t,r){return r||(r="\\"),t+t+r+"|"})),this.debug("tail=%j\n   %s",_,_,y,n);var O="*"===y.type?"[^/]*?":"?"===y.type?"[^/]":"\\"+y.type;o=!0,n=n.slice(0,y.reStart)+O+"\\("+_}f(),s&&(n+="\\\\");var k=!1;switch(n.charAt(0)){case".":case"[":case"(":k=!0}for(var P=l.length-1;P>-1;P--){var M=l[P],j=n.slice(0,M.reStart),E=n.slice(M.reStart,M.reEnd-8),S=n.slice(M.reEnd-8,M.reEnd),x=n.slice(M.reEnd);S+=x;var C=j.split("(").length-1,T=x;for(m=0;m<C;m++)T=T.replace(/\)[+*?]?/,"");var D="";""===(x=T)&&t!==xl&&(D="$"),n=j+E+x+D+S}""!==n&&o&&(n="(?=.)"+n);k&&(n=h+n);if(t===xl)return[n,o];if(!o)return function(e){return e.replace(/\\(.)/g,"$1")}(e);var A=r.nocase?"i":"";try{var I=new RegExp("^"+n+"$",A)}catch(e){return new RegExp("$.")}return I._glob=e,I._src=n,I};var xl={};jl.makeRe=function(e,t){return new El(e,t||{}).makeRe()},El.prototype.makeRe=function(){if(this.regexp||!1===this.regexp)return this.regexp;var e=this.set;if(!e.length)return this.regexp=!1,this.regexp;var t=this.options,r=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",i=t.nocase?"i":"",n=e.map((function(e){return e.map((function(e){return e===nl?r:"string"==typeof e?function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}(e):e._src})).join("\\/")})).join("|");n="^(?:"+n+")$",this.negate&&(n="^(?!"+n+").*$");try{this.regexp=new RegExp(n,i)}catch(e){this.regexp=!1}return this.regexp},jl.match=function(e,t,r){var i=new El(t,r=r||{});return e=e.filter((function(e){return i.match(e)})),i.options.nonull&&!e.length&&e.push(t),e},El.prototype.match=function(e,t){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;var r=this.options;"/"!==rl.sep&&(e=e.split(rl.sep).join("/"));e=e.split(Pl),this.debug(this.pattern,"split",e);var i,n,o=this.set;for(this.debug(this.pattern,"set",o),n=e.length-1;n>=0&&!(i=e[n]);n--);for(n=0;n<o.length;n++){var s=o[n],a=e;if(r.matchBase&&1===s.length&&(a=[i]),this.matchOne(a,s,t))return!!r.flipNegate||!this.negate}return!r.flipNegate&&this.negate},El.prototype.matchOne=function(e,t,r){var i=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var n=0,o=0,s=e.length,a=t.length;n<s&&o<a;n++,o++){this.debug("matchOne loop");var l,c=t[o],u=e[n];if(this.debug(t,c,u),!1===c)return!1;if(c===nl){this.debug("GLOBSTAR",[t,c,u]);var p=n,h=o+1;if(h===a){for(this.debug("** at the end");n<s;n++)if("."===e[n]||".."===e[n]||!i.dot&&"."===e[n].charAt(0))return!1;return!0}for(;p<s;){var d=e[p];if(this.debug("\nglobstar while",e,p,t,h,d),this.matchOne(e.slice(p),t.slice(h),r))return this.debug("globstar found match!",p,s,d),!0;if("."===d||".."===d||!i.dot&&"."===d.charAt(0)){this.debug("dot detected!",e,p,t,h);break}this.debug("globstar swallow a segment, and continue"),p++}return!(!r||(this.debug("\n>>> no match, partial?",e,p,t,h),p!==s))}if("string"==typeof c?(l=i.nocase?u.toLowerCase()===c.toLowerCase():u===c,this.debug("string match",c,u,l)):(l=u.match(c),this.debug("pattern match",c,u,l)),!l)return!1}if(n===s&&o===a)return!0;if(n===s)return r;if(o===a)return n===s-1&&""===e[n];throw new Error("wtf?")};tl.Minimatch;var Cl={};Cl="function"==typeof Object.create?function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}};var Tl=t.EventEmitter,Dl=a,Al=r,Il={};function Rl(e){return"/"===e.charAt(0)}function Nl(e){var t=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/.exec(e),r=t[1]||"",i=Boolean(r&&":"!==r.charAt(1));return Boolean(t[2]||i)}var Ll=Rl;(Il="win32"===process.platform?Nl:Rl).posix=Ll;var Bl=Nl;Il.win32=Bl;var Fl={};Fl=lc,lc.GlobSync=cc;var Ul=o,Vl=(tl.Minimatch,La.Glob,a),zl=r,Wl=function(e,t,r){r||(r={});if(r.matchBase&&-1===t.indexOf("/")){if(r.noglobstar)throw new Error("base matching requires globstar");t="**/"+t}e.silent=!!r.silent,e.pattern=t,e.strict=!1!==r.strict,e.realpath=!!r.realpath,e.realpathCache=r.realpathCache||Object.create(null),e.follow=!!r.follow,e.dot=!!r.dot,e.mark=!!r.mark,e.nodir=!!r.nodir,e.nodir&&(e.mark=!0);e.sync=!!r.sync,e.nounique=!!r.nounique,e.nonull=!!r.nonull,e.nosort=!!r.nosort,e.nocase=!!r.nocase,e.stat=!!r.stat,e.noprocess=!!r.noprocess,e.absolute=!!r.absolute,e.maxLength=r.maxLength||1/0,e.cache=r.cache||Object.create(null),e.statCache=r.statCache||Object.create(null),e.symlinks=r.symlinks||Object.create(null),function(e,t){e.ignore=t.ignore||[],Array.isArray(e.ignore)||(e.ignore=[e.ignore]);e.ignore.length&&(e.ignore=e.ignore.map(tc))}(e,r),e.changedCwd=!1;var i=process.cwd();Yl(r,"cwd")?(e.cwd=Xl.resolve(r.cwd),e.changedCwd=e.cwd!==i):e.cwd=i;e.root=r.root||Xl.resolve(e.cwd,"/"),e.root=Xl.resolve(e.root),"win32"===process.platform&&(e.root=e.root.replace(/\\/g,"/"));e.cwdAbs=Il(e.cwd)?e.cwd:rc(e,e.cwd),"win32"===process.platform&&(e.cwdAbs=e.cwdAbs.replace(/\\/g,"/"));e.nomount=!!r.nomount,r.nonegate=!0,r.nocomment=!0,e.minimatch=new Zl(t,r),e.options=e.minimatch.options},$l=Yl,ql=rc,Hl=function(e){for(var t=e.nounique,r=t?[]:Object.create(null),i=0,n=e.matches.length;i<n;i++){var o=e.matches[i];if(o&&0!==Object.keys(o).length){var s=Object.keys(o);t?r.push.apply(r,s):s.forEach((function(e){r[e]=!0}))}else if(e.nonull){var a=e.minimatch.globSet[i];t?r.push(a):r[a]=!0}}t||(r=Object.keys(r));e.nosort||(r=r.sort(e.nocase?Jl:ec));if(e.mark){for(i=0;i<r.length;i++)r[i]=e._mark(r[i]);e.nodir&&(r=r.filter((function(t){var r=!/\/$/.test(t),i=e.cache[t]||e.cache[rc(e,t)];return r&&i&&(r="DIR"!==i&&!Array.isArray(i)),r})))}e.ignore.length&&(r=r.filter((function(t){return!ic(e,t)})));e.found=r},Gl=function(e,t){var r=rc(e,t),i=e.cache[r],n=t;if(i){var o="DIR"===i||Array.isArray(i),s="/"===t.slice(-1);if(o&&!s?n+="/":!o&&s&&(n=n.slice(0,-1)),n!==t){var a=rc(e,n);e.statCache[a]=e.statCache[r],e.cache[a]=e.cache[r]}}return n},Ql=ic,Kl=function(e,t){return!!e.ignore.length&&e.ignore.some((function(e){return!(!e.gmatcher||!e.gmatcher.match(t))}))};function Yl(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Xl=a,Zl=tl.Minimatch;function Jl(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}function ec(e,t){return e.localeCompare(t)}function tc(e){var t=null;if("/**"===e.slice(-3)){var r=e.replace(/(\/\*\*)+$/,"");t=new Zl(r,{dot:!0})}return{matcher:new Zl(e,{dot:!0}),gmatcher:t}}function rc(e,t){var r=t;return r="/"===t.charAt(0)?Xl.join(e.root,t):Il(t)||""===t?t:e.changedCwd?Xl.resolve(e.cwd,t):Xl.resolve(t),"win32"===process.platform&&(r=r.replace(/\\/g,"/")),r}function ic(e,t){return!!e.ignore.length&&e.ignore.some((function(e){return e.matcher.match(t)||!(!e.gmatcher||!e.gmatcher.match(t))}))}var nc=Wl,oc=$l,sc=Kl,ac=Ql;function lc(e,t){if("function"==typeof t||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");return new cc(e,t).found}function cc(e,t){if(!e)throw new Error("must provide pattern");if("function"==typeof t||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");if(!(this instanceof cc))return new cc(e,t);if(nc(this,e,t),this.noprocess)return this;var r=this.minimatch.set.length;this.matches=new Array(r);for(var i=0;i<r;i++)this._process(this.minimatch.set[i],i,!1);this._finish()}cc.prototype._finish=function(){if(zl(this instanceof cc),this.realpath){var e=this;this.matches.forEach((function(t,r){var i=e.matches[r]=Object.create(null);for(var n in t)try{n=e._makeAbs(n),i[Fa.realpathSync(n,e.realpathCache)]=!0}catch(t){if("stat"!==t.syscall)throw t;i[e._makeAbs(n)]=!0}}))}Hl(this)},cc.prototype._process=function(e,t,r){zl(this instanceof cc);for(var i,n=0;"string"==typeof e[n];)n++;switch(n){case e.length:return void this._processSimple(e.join("/"),t);case 0:i=null;break;default:i=e.slice(0,n).join("/")}var o,s=e.slice(n);null===i?o=".":Il(i)||Il(e.join("/"))?(i&&Il(i)||(i="/"+i),o=i):o=i;var a=this._makeAbs(o);sc(this,o)||(s[0]===tl.GLOBSTAR?this._processGlobStar(i,o,a,s,t,r):this._processReaddir(i,o,a,s,t,r))},cc.prototype._processReaddir=function(e,t,r,i,n,o){var s=this._readdir(r,o);if(s){for(var a=i[0],l=!!this.minimatch.negate,c=a._glob,u=this.dot||"."===c.charAt(0),p=[],h=0;h<s.length;h++){if("."!==(v=s[h]).charAt(0)||u)(l&&!e?!v.match(a):v.match(a))&&p.push(v)}var d=p.length;if(0!==d)if(1!==i.length||this.mark||this.stat){i.shift();for(h=0;h<d;h++){var f;v=p[h];f=e?[e,v]:[v],this._process(f.concat(i),n,o)}}else{this.matches[n]||(this.matches[n]=Object.create(null));for(var h=0;h<d;h++){var v=p[h];e&&(v="/"!==e.slice(-1)?e+"/"+v:e+v),"/"!==v.charAt(0)||this.nomount||(v=Vl.join(this.root,v)),this._emitMatch(n,v)}}}},cc.prototype._emitMatch=function(e,t){if(!ac(this,t)){var r=this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var i=this.cache[r];if("DIR"===i||Array.isArray(i))return}this.matches[e][t]=!0,this.stat&&this._stat(t)}}},cc.prototype._readdirInGlobStar=function(e){if(this.follow)return this._readdir(e,!1);var t,r;try{r=Ul.lstatSync(e)}catch(e){if("ENOENT"===e.code)return null}var i=r&&r.isSymbolicLink();return this.symlinks[e]=i,i||!r||r.isDirectory()?t=this._readdir(e,!1):this.cache[e]="FILE",t},cc.prototype._readdir=function(e,t){if(t&&!oc(this.symlinks,e))return this._readdirInGlobStar(e);if(oc(this.cache,e)){var r=this.cache[e];if(!r||"FILE"===r)return null;if(Array.isArray(r))return r}try{return this._readdirEntries(e,Ul.readdirSync(e))}catch(t){return this._readdirError(e,t),null}},cc.prototype._readdirEntries=function(e,t){if(!this.mark&&!this.stat)for(var r=0;r<t.length;r++){var i=t[r];i="/"===e?e+i:e+"/"+i,this.cache[i]=!0}return this.cache[e]=t,t},cc.prototype._readdirError=function(e,t){switch(t.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(e);if(this.cache[r]="FILE",r===this.cwdAbs){var i=new Error(t.code+" invalid cwd "+this.cwd);throw i.path=this.cwd,i.code=t.code,i}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:if(this.cache[this._makeAbs(e)]=!1,this.strict)throw t;this.silent||console.error("glob error",t)}},cc.prototype._processGlobStar=function(e,t,r,i,n,o){var s=this._readdir(r,o);if(s){var a=i.slice(1),l=e?[e]:[],c=l.concat(a);this._process(c,n,!1);var u=s.length;if(!this.symlinks[r]||!o)for(var p=0;p<u;p++){if("."!==s[p].charAt(0)||this.dot){var h=l.concat(s[p],a);this._process(h,n,!0);var d=l.concat(s[p],i);this._process(d,n,!0)}}}},cc.prototype._processSimple=function(e,t){var r=this._stat(e);if(this.matches[t]||(this.matches[t]=Object.create(null)),r){if(e&&Il(e)&&!this.nomount){var i=/[\/\\]$/.test(e);"/"===e.charAt(0)?e=Vl.join(this.root,e):(e=Vl.resolve(this.root,e),i&&(e+="/"))}"win32"===process.platform&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e)}},cc.prototype._stat=function(e){var t=this._makeAbs(e),r="/"===e.slice(-1);if(e.length>this.maxLength)return!1;if(!this.stat&&oc(this.cache,t)){var i=this.cache[t];if(Array.isArray(i)&&(i="DIR"),!r||"DIR"===i)return i;if(r&&"FILE"===i)return!1}var n=this.statCache[t];if(!n){var o;try{o=Ul.lstatSync(t)}catch(e){if(e&&("ENOENT"===e.code||"ENOTDIR"===e.code))return this.statCache[t]=!1,!1}if(o&&o.isSymbolicLink())try{n=Ul.statSync(t)}catch(e){n=o}else n=o}this.statCache[t]=n;i=!0;return n&&(i=n.isDirectory()?"DIR":"FILE"),this.cache[t]=this.cache[t]||i,(!r||"FILE"!==i)&&i},cc.prototype._mark=function(e){return Gl(this,e)},cc.prototype._makeAbs=function(e){return ql(this,e)};var uc=Wl,pc=$l,hc={},dc={};dc=function e(t,r){if(t&&r)return e(t)(r);if("function"!=typeof t)throw new TypeError("need wrapper function");return Object.keys(t).forEach((function(e){i[e]=t[e]})),i;function i(){for(var e=new Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var i=t.apply(this,e),n=e[e.length-1];return"function"==typeof i&&i!==n&&Object.keys(n).forEach((function(e){i[e]=n[e]})),i}};var fc=Object.create(null),vc={};vc=dc(gc);var mc=dc(yc);function gc(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function yc(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}function bc(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i]=e[i];return r}vc.strict=mc,gc.proto=gc((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return gc(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return yc(this)},configurable:!0})})),hc=dc((function(e,t){return fc[e]?(fc[e].push(t),null):(fc[e]=[t],function(e){return vc((function t(){var r=fc[e],i=r.length,n=bc(arguments);try{for(var o=0;o<i;o++)r[o].apply(null,n)}finally{r.length>i?(r.splice(0,i),process.nextTick((function(){t.apply(null,n)}))):delete fc[e]}}))}(e))}));var wc=Kl,_c=Ql;function Oc(e,t,r){if("function"==typeof t&&(r=t,t={}),t||(t={}),t.sync){if(r)throw new TypeError("callback provided to sync glob");return Fl(e,t)}return new Pc(e,t,r)}Oc.sync=Fl;var kc=Oc.GlobSync=Fl.GlobSync;function Pc(e,t,r){if("function"==typeof t&&(r=t,t=null),t&&t.sync){if(r)throw new TypeError("callback provided to sync glob");return new kc(e,t)}if(!(this instanceof Pc))return new Pc(e,t,r);uc(this,e,t),this._didRealPath=!1;var i=this.minimatch.set.length;this.matches=new Array(i),"function"==typeof r&&(r=vc(r),this.on("error",r),this.on("end",(function(e){r(null,e)})));var n=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(0===i)return s();for(var o=0;o<i;o++)this._process(this.minimatch.set[o],o,!1,s);function s(){--n._processing,n._processing<=0&&n._finish()}}Oc.glob=Oc,Oc.hasMagic=function(e,t){var r=function(e,t){if(null===t||"object"!=typeof t)return e;for(var r=Object.keys(t),i=r.length;i--;)e[r[i]]=t[r[i]];return e}({},t);r.noprocess=!0;var i=new Pc(e,r).minimatch.set;if(!e)return!1;if(i.length>1)return!0;for(var n=0;n<i[0].length;n++)if("string"!=typeof i[0][n])return!0;return!1},Oc.Glob=Pc,Cl(Pc,Tl),Pc.prototype._finish=function(){if(Al(this instanceof Pc),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();Hl(this),this.emit("end",this.found)}},Pc.prototype._realpath=function(){if(!this._didRealpath){this._didRealpath=!0;var e=this.matches.length;if(0===e)return this._finish();for(var t=this,r=0;r<this.matches.length;r++)this._realpathSet(r,i)}function i(){0==--e&&t._finish()}},Pc.prototype._realpathSet=function(e,t){var r=this.matches[e];if(!r)return t();var i=Object.keys(r),n=this,o=i.length;if(0===o)return t();var s=this.matches[e]=Object.create(null);i.forEach((function(r,i){r=n._makeAbs(r),Fa.realpath(r,n.realpathCache,(function(i,a){i?"stat"===i.syscall?s[r]=!0:n.emit("error",i):s[a]=!0,0==--o&&(n.matches[e]=s,t())}))}))},Pc.prototype._mark=function(e){return Gl(this,e)},Pc.prototype._makeAbs=function(e){return ql(this,e)},Pc.prototype.abort=function(){this.aborted=!0,this.emit("abort")},Pc.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))},Pc.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var e=this._emitQueue.slice(0);this._emitQueue.length=0;for(var t=0;t<e.length;t++){var r=e[t];this._emitMatch(r[0],r[1])}}if(this._processQueue.length){var i=this._processQueue.slice(0);this._processQueue.length=0;for(t=0;t<i.length;t++){var n=i[t];this._processing--,this._process(n[0],n[1],n[2],n[3])}}}},Pc.prototype._process=function(e,t,r,i){if(Al(this instanceof Pc),Al("function"==typeof i),!this.aborted)if(this._processing++,this.paused)this._processQueue.push([e,t,r,i]);else{for(var n,o=0;"string"==typeof e[o];)o++;switch(o){case e.length:return void this._processSimple(e.join("/"),t,i);case 0:n=null;break;default:n=e.slice(0,o).join("/")}var s,a=e.slice(o);null===n?s=".":Il(n)||Il(e.join("/"))?(n&&Il(n)||(n="/"+n),s=n):s=n;var l=this._makeAbs(s);if(wc(this,s))return i();a[0]===tl.GLOBSTAR?this._processGlobStar(n,s,l,a,t,r,i):this._processReaddir(n,s,l,a,t,r,i)}},Pc.prototype._processReaddir=function(e,t,r,i,n,o,s){var a=this;this._readdir(r,o,(function(l,c){return a._processReaddir2(e,t,r,i,n,o,c,s)}))},Pc.prototype._processReaddir2=function(e,t,r,i,n,o,s,a){if(!s)return a();for(var l=i[0],c=!!this.minimatch.negate,u=l._glob,p=this.dot||"."===u.charAt(0),h=[],d=0;d<s.length;d++){if("."!==(v=s[d]).charAt(0)||p)(c&&!e?!v.match(l):v.match(l))&&h.push(v)}var f=h.length;if(0===f)return a();if(1===i.length&&!this.mark&&!this.stat){this.matches[n]||(this.matches[n]=Object.create(null));for(d=0;d<f;d++){var v=h[d];e&&(v="/"!==e?e+"/"+v:e+v),"/"!==v.charAt(0)||this.nomount||(v=Dl.join(this.root,v)),this._emitMatch(n,v)}return a()}i.shift();for(d=0;d<f;d++){v=h[d];e&&(v="/"!==e?e+"/"+v:e+v),this._process([v].concat(i),n,o,a)}a()},Pc.prototype._emitMatch=function(e,t){if(!this.aborted&&!_c(this,t))if(this.paused)this._emitQueue.push([e,t]);else{var r=Il(t)?t:this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var i=this.cache[r];if("DIR"===i||Array.isArray(i))return}this.matches[e][t]=!0;var n=this.statCache[r];n&&this.emit("stat",t,n),this.emit("match",t)}}},Pc.prototype._readdirInGlobStar=function(e,t){if(!this.aborted){if(this.follow)return this._readdir(e,!1,t);var r=this,i=hc("lstat\0"+e,(function(i,n){if(i&&"ENOENT"===i.code)return t();var o=n&&n.isSymbolicLink();r.symlinks[e]=o,o||!n||n.isDirectory()?r._readdir(e,!1,t):(r.cache[e]="FILE",t())}));i&&Ba.lstat(e,i)}},Pc.prototype._readdir=function(e,t,r){if(!this.aborted&&(r=hc("readdir\0"+e+"\0"+t,r))){if(t&&!pc(this.symlinks,e))return this._readdirInGlobStar(e,r);if(pc(this.cache,e)){var i=this.cache[e];if(!i||"FILE"===i)return r();if(Array.isArray(i))return r(null,i)}Ba.readdir(e,function(e,t,r){return function(i,n){i?e._readdirError(t,i,r):e._readdirEntries(t,n,r)}}(this,e,r))}},Pc.prototype._readdirEntries=function(e,t,r){if(!this.aborted){if(!this.mark&&!this.stat)for(var i=0;i<t.length;i++){var n=t[i];n="/"===e?e+n:e+"/"+n,this.cache[n]=!0}return this.cache[e]=t,r(null,t)}},Pc.prototype._readdirError=function(e,t,r){if(!this.aborted){switch(t.code){case"ENOTSUP":case"ENOTDIR":var i=this._makeAbs(e);if(this.cache[i]="FILE",i===this.cwdAbs){var n=new Error(t.code+" invalid cwd "+this.cwd);n.path=this.cwd,n.code=t.code,this.emit("error",n),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:this.cache[this._makeAbs(e)]=!1,this.strict&&(this.emit("error",t),this.abort()),this.silent||console.error("glob error",t)}return r()}},Pc.prototype._processGlobStar=function(e,t,r,i,n,o,s){var a=this;this._readdir(r,o,(function(l,c){a._processGlobStar2(e,t,r,i,n,o,c,s)}))},Pc.prototype._processGlobStar2=function(e,t,r,i,n,o,s,a){if(!s)return a();var l=i.slice(1),c=e?[e]:[],u=c.concat(l);this._process(u,n,!1,a);var p=this.symlinks[r],h=s.length;if(p&&o)return a();for(var d=0;d<h;d++){if("."!==s[d].charAt(0)||this.dot){var f=c.concat(s[d],l);this._process(f,n,!0,a);var v=c.concat(s[d],i);this._process(v,n,!0,a)}}a()},Pc.prototype._processSimple=function(e,t,r){var i=this;this._stat(e,(function(n,o){i._processSimple2(e,t,n,o,r)}))},Pc.prototype._processSimple2=function(e,t,r,i,n){if(this.matches[t]||(this.matches[t]=Object.create(null)),!i)return n();if(e&&Il(e)&&!this.nomount){var o=/[\/\\]$/.test(e);"/"===e.charAt(0)?e=Dl.join(this.root,e):(e=Dl.resolve(this.root,e),o&&(e+="/"))}"win32"===process.platform&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e),n()},Pc.prototype._stat=function(e,t){var r=this._makeAbs(e),i="/"===e.slice(-1);if(e.length>this.maxLength)return t();if(!this.stat&&pc(this.cache,r)){var n=this.cache[r];if(Array.isArray(n)&&(n="DIR"),!i||"DIR"===n)return t(null,n);if(i&&"FILE"===n)return t()}var o=this.statCache[r];if(void 0!==o){if(!1===o)return t(null,o);var s=o.isDirectory()?"DIR":"FILE";return i&&"FILE"===s?t():t(null,s,o)}var a=this,l=hc("stat\0"+r,(function(i,n){if(n&&n.isSymbolicLink())return Ba.stat(r,(function(i,o){i?a._stat2(e,r,null,n,t):a._stat2(e,r,i,o,t)}));a._stat2(e,r,i,n,t)}));l&&Ba.lstat(r,l)},Pc.prototype._stat2=function(e,t,r,i,n){if(r&&("ENOENT"===r.code||"ENOTDIR"===r.code))return this.statCache[t]=!1,n();var o="/"===e.slice(-1);if(this.statCache[t]=i,"/"===t.slice(-1)&&i&&!i.isDirectory())return n(null,!1,i);var s=!0;return i&&(s=i.isDirectory()?"DIR":"FILE"),this.cache[t]=this.cache[t]||s,o&&"FILE"===s?n():n(null,s,i)};var Mc=parseInt("666",8),jc={nosort:!0,silent:!0},Ec=0,Sc="win32"===process.platform;function xc(e){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach((function(t){e[t]=e[t]||Na[t],e[t+="Sync"]=e[t]||Na[t]})),e.maxBusyTries=e.maxBusyTries||3,e.emfileWait=e.emfileWait||1e3,!1===e.glob&&(e.disableGlob=!0),e.disableGlob=e.disableGlob||!1,e.glob=e.glob||jc}function Cc(e,t,r){"function"==typeof t&&(r=t,t={}),Ia(e,"rimraf: missing path"),Ia.equal(typeof e,"string","rimraf: path should be a string"),Ia.equal(typeof r,"function","rimraf: callback function required"),Ia(t,"rimraf: invalid options argument provided"),Ia.equal(typeof t,"object","rimraf: options should be object"),xc(t);var i=0,n=null,o=0;if(t.disableGlob||!La.hasMagic(e))return s(null,[e]);function s(e,s){return e?r(e):0===(o=s.length)?r():void s.forEach((function(e){Tc(e,t,(function s(a){if(a){if(("EBUSY"===a.code||"ENOTEMPTY"===a.code||"EPERM"===a.code)&&i<t.maxBusyTries)return i++,setTimeout((function(){Tc(e,t,s)}),100*i);if("EMFILE"===a.code&&Ec<t.emfileWait)return setTimeout((function(){Tc(e,t,s)}),Ec++);"ENOENT"===a.code&&(a=null)}Ec=0,function(e){n=n||e,0==--o&&r(n)}(a)}))}))}t.lstat(e,(function(r,i){if(!r)return s(null,[e]);La(e,t.glob,s)}))}function Tc(e,t,r){Ia(e),Ia(t),Ia("function"==typeof r),t.lstat(e,(function(i,n){return i&&"ENOENT"===i.code?r(null):(i&&"EPERM"===i.code&&Sc&&Dc(e,t,i,r),n&&n.isDirectory()?Ic(e,t,i,r):void t.unlink(e,(function(i){if(i){if("ENOENT"===i.code)return r(null);if("EPERM"===i.code)return Sc?Dc(e,t,i,r):Ic(e,t,i,r);if("EISDIR"===i.code)return Ic(e,t,i,r)}return r(i)})))}))}function Dc(e,t,r,i){Ia(e),Ia(t),Ia("function"==typeof i),r&&Ia(r instanceof Error),t.chmod(e,Mc,(function(n){n?i("ENOENT"===n.code?null:r):t.stat(e,(function(n,o){n?i("ENOENT"===n.code?null:r):o.isDirectory()?Ic(e,t,r,i):t.unlink(e,i)}))}))}function Ac(e,t,r){Ia(e),Ia(t),r&&Ia(r instanceof Error);try{t.chmodSync(e,Mc)}catch(e){if("ENOENT"===e.code)return;throw r}try{var i=t.statSync(e)}catch(e){if("ENOENT"===e.code)return;throw r}i.isDirectory()?Nc(e,t,r):t.unlinkSync(e)}function Ic(e,t,r,i){Ia(e),Ia(t),r&&Ia(r instanceof Error),Ia("function"==typeof i),t.rmdir(e,(function(n){!n||"ENOTEMPTY"!==n.code&&"EEXIST"!==n.code&&"EPERM"!==n.code?n&&"ENOTDIR"===n.code?i(r):i(n):function(e,t,r){Ia(e),Ia(t),Ia("function"==typeof r),t.readdir(e,(function(i,n){if(i)return r(i);var o,s=n.length;if(0===s)return t.rmdir(e,r);n.forEach((function(i){Cc(Ra.join(e,i),t,(function(i){if(!o)return i?r(o=i):void(0==--s&&t.rmdir(e,r))}))}))}))}(e,t,i)}))}function Rc(e,t){var r;if(xc(t=t||{}),Ia(e,"rimraf: missing path"),Ia.equal(typeof e,"string","rimraf: path should be a string"),Ia(t,"rimraf: missing options"),Ia.equal(typeof t,"object","rimraf: options should be object"),t.disableGlob||!La.hasMagic(e))r=[e];else try{t.lstatSync(e),r=[e]}catch(i){r=La.sync(e,t.glob)}if(r.length)for(var i=0;i<r.length;i++){e=r[i];try{var n=t.lstatSync(e)}catch(r){if("ENOENT"===r.code)return;"EPERM"===r.code&&Sc&&Ac(e,t,r)}try{n&&n.isDirectory()?Nc(e,t,null):t.unlinkSync(e)}catch(r){if("ENOENT"===r.code)return;if("EPERM"===r.code)return Sc?Ac(e,t,r):Nc(e,t,r);if("EISDIR"!==r.code)throw r;Nc(e,t,r)}}}function Nc(e,t,r){Ia(e),Ia(t),r&&Ia(r instanceof Error);try{t.rmdirSync(e)}catch(i){if("ENOENT"===i.code)return;if("ENOTDIR"===i.code)throw r;"ENOTEMPTY"!==i.code&&"EEXIST"!==i.code&&"EPERM"!==i.code||function(e,t){Ia(e),Ia(t),t.readdirSync(e).forEach((function(r){Rc(Ra.join(e,r),t)}));var r=Sc?100:1,i=0;for(;;){var n=!0;try{var o=t.rmdirSync(e,t);return n=!1,o}finally{if(++i<r&&n)continue}}}(e,t)}}var Lc={},Bc=a,Fc=o,Uc=parseInt("0777",8);function Vc(e,t,r,i){"function"==typeof t?(r=t,t={}):t&&"object"==typeof t||(t={mode:t});var n=t.mode,o=t.fs||Fc;void 0===n&&(n=Uc&~process.umask()),i||(i=null);var s=r||function(){};e=Bc.resolve(e),o.mkdir(e,n,(function(r){if(!r)return s(null,i=i||e);switch(r.code){case"ENOENT":Vc(Bc.dirname(e),t,(function(r,i){r?s(r,i):Vc(e,t,s,i)}));break;default:o.stat(e,(function(e,t){e||!t.isDirectory()?s(r,i):s(null,i)}))}}))}Lc=Vc.mkdirp=Vc.mkdirP=Vc,Vc.sync=function e(t,r,i){r&&"object"==typeof r||(r={mode:r});var n=r.mode,o=r.fs||Fc;void 0===n&&(n=Uc&~process.umask()),i||(i=null),t=Bc.resolve(t);try{o.mkdirSync(t,n),i=i||t}catch(n){switch(n.code){case"ENOENT":i=e(Bc.dirname(t),r,i),e(t,r,i);break;default:var s;try{s=o.statSync(t)}catch(e){throw n}if(!s.isDirectory())throw n}}return i};i.tmpdir();const zc=Aa.sync;let Wc=Ca.resolve(Da.tmpdir()),$c=Ta.O_CREAT|Ta.O_TRUNC|Ta.O_RDWR|Ta.O_EXCL,qc=function(e){return"function"==typeof e?[void 0,e]:[new Promise((function(e,r){t=function(){var t=Array.from(arguments),i=t.shift();process.nextTick((function(){i?r(i):1===t.length?e(t[0]):e(t)}))}})),t];var t};var Hc=function(e,t){var r=Gc(e,t),i=new Date,n=[r.prefix,i.getFullYear(),i.getMonth(),i.getDate(),"-",process.pid,"-",(4294967296*Math.random()+1).toString(36),r.suffix].join("");return Ca.join(r.dir||Wc,n)},Gc=function(e,t){var r={prefix:null,suffix:null};if(e)switch(typeof e){case"string":r.prefix=e;break;case"object":r=e;break;default:throw new Error("Unknown affix declaration: "+r)}else r.prefix=t;return r},Qc=!1,Kc=!1,Yc=[],Xc=[];function Zc(e){if(!Qc)return!1;eu(),Yc.push(e)}function Jc(e){if(!Qc)return!1;eu(),Xc.push(e)}function eu(){if(!Qc)return!1;Kc||(process.addListener("exit",(function(){try{tu()}catch(e){throw console.warn("Fail to clean temporary files on exit : ",e),e}})),Kc=!0)}function tu(){return!!Qc&&{files:function(){if(!Qc)return!1;for(var e,t=0;void 0!==(e=Yc.shift());)zc(e,{maxBusyTries:6}),t++;return t}(),dirs:function(){if(!Qc)return!1;for(var e,t=0;void 0!==(e=Xc.shift());)zc(e,{maxBusyTries:6}),t++;return t}()}}var ru=Wc;Sa.dir=ru;var iu=function(e){return Qc=!1!==e,Sa};Sa.track=iu;var nu=(e,t)=>{const r=qc(t),i=r[0];t=r[1];let n=Hc(e,"d-");return Lc(n,448,e=>{e||Jc(n),t(e,n)}),i};Sa.mkdir=nu;var ou=e=>{let t=Hc(e,"d-");return Lc.sync(t,448),Jc(t),t};Sa.mkdirSync=ou;var su=(e,t)=>{const r=qc(t),i=r[0];t=r[1];const n=Hc(e,"f-");return xa.open(n,$c,384,(e,r)=>{e||Zc(n),t(e,{path:n,fd:r})}),i};Sa.open=su;var au=e=>{const t=Hc(e,"f-");let r=xa.openSync(t,$c,384);return Zc(t),{path:t,fd:r}};Sa.openSync=au;var lu=Hc;Sa.path=lu;var cu=function(e){var t=qc(e),r=t[0];return e=t[1],Qc?(function(e){var t=qc(e),r=t[0];if(e=t[1],!Qc)return e(new Error("not tracking")),r;var i,n=0,o=Yc.length;if(!o)return e(null,n),r;for(var s=function(t){if(o){if(t)return e(t),void(o=0);n++,--o||e(null,n)}};void 0!==(i=Yc.shift());)Aa(i,{maxBusyTries:6},s)}((function(t,r){t?e(t,{files:r}):function(e){var t=qc(e),r=t[0];if(e=t[1],!Qc)return e(new Error("not tracking")),r;var i,n=0,o=Xc.length;if(!o)return e(null,n),r;for(var s=function(t){if(o){if(t)return e(t,n),void(o=0);n++,--o||e(null,n)}};void 0!==(i=Xc.shift());)Aa(i,{maxBusyTries:6},s)}((function(t,i){e(t,{files:r,dirs:i})}))})),r):(e(new Error("not tracking")),r)};Sa.cleanup=cu;var uu=tu;Sa.cleanupSync=uu;var pu=e=>{const t=Hc(e,"s-");let r=xa.createWriteStream(t,{flags:$c,mode:384});return Zc(t),r};Sa.createWriteStream=pu;var hu=yu(Sa),du={};Object.defineProperty(du,"__esModule",{value:!0});var fu=async function({command:e,args:t,cwd:r,stdin:i}){return new Promise((n,o)=>{try{const s=vu.execFile(e,t,{cwd:r},(e,t,r)=>{e?o({error:e,stderr:r}):n({stdout:t,stderr:r})});if(void 0!==i){if(!s.stdin)throw new Error("No stdin");s.stdin.write(i),s.stdin.end()}}catch(e){console.error(e),o(e)}})};du.runFilter=fu;var vu=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=mu();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(e);function mu(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return mu=function(){return e},e}function gu(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return gu=function(){return e},e}function yu(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=gu();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}async function bu(e){return new Promise((t,r)=>{Ea.readFile(e,{encoding:"utf-8"},(e,i)=>{e?(console.error(e),r(e)):t(i)})})}function wu(e){e&&atom.notifications.addError(e.name,{detail:e.message,dismissable:!0})}var _u={};Object.defineProperty(_u,"__esModule",{value:!0});var Ou=async function(e,t,r){const i=atom.config.get("ide-haskell.stylishHaskellPath",{scope:r}),n=atom.config.get("ide-haskell.stylishHaskellArguments",{scope:r});return(0,du.runFilter)({command:i,args:n,cwd:t,stdin:e})};_u.format=Ou;var ku={};Object.defineProperty(ku,"__esModule",{value:!0});var Pu=void 0;ku.PrettifyEditorController=Pu;var Mu=c;Pu=class{constructor(e){this.editor=e,this.disposables=new Mu.CompositeDisposable,this.prettify=async()=>{if(atom.config.get("ide-haskell.onSavePrettify",{scope:this.editor.getRootScopeDescriptor()})){const e=this.editor.getGrammar().scopeName.replace(/\./g,"*");if(!atom.config.get("ide-haskell.onSavePrettifyFormats",{scope:this.editor.getRootScopeDescriptor()})[e])return;await(0,Oa.prettifyFile)(this.editor)}};const t=this.editor.getBuffer();this.disposables.add(t.onWillSave(this.prettify))}static supportsGrammar(e){return["source.c2hs","source.cabal","source.hsc2hs","source.haskell","text.tex.latex.haskell","source.hsig"].includes(e)}destroy(){this.disposables.dispose()}},ku.PrettifyEditorController=Pu;var ju={};Object.defineProperty(ju,"__esModule",{value:!0});var Eu=void 0;ju.EditorMarkControl=Eu;Eu=class{constructor(e){this.editor=e,this.editorElement=atom.views.getView(this.editor),this.editorElement.classList.add("ide-haskell")}static supportsGrammar(e){return["source.c2hs","source.cabal","source.hsc2hs","source.haskell","text.tex.latex.haskell","source.hsig"].includes(e)}destroy(){this.editorElement.classList.remove("ide-haskell")}},ju.EditorMarkControl=Eu;var Su={};Object.defineProperty(Su,"__esModule",{value:!0});var xu=void 0;Su.BackendStatusController=xu;var Cu=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=Vu();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs()),Tu=c,Du={};Object.defineProperty(Du,"__esModule",{value:!0});var Au=void 0;Du.StatusIcon=Au;var Iu=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=Nu();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs()),Ru=c;function Nu(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return Nu=function(){return e},e}Au=class{constructor(e){this.props=e,this.disposables=new Ru.CompositeDisposable,Iu.initialize(this),this.disposables.add(atom.tooltips.add(this.element,{class:"ide-haskell-status-tooltip",title:()=>{const e=[];for(const[t,{status:r,detail:i}]of this.props.statusMap.entries())e.push(`\n          <ide-haskell-status-item>\n            <ide-haskell-status-icon data-status="${r}">${t}</ide-haskell-status-icon>\n            <ide-haskell-status-detail>${i||""}</ide-haskell-status-detail>\n          </ide-haskell-status-item>\n          `);return e.join("")}}))}render(){return Iu.dom("ide-haskell-status-icon",{dataset:{status:this.calcCurrentStatus()}})}async update(e){return this.props.statusMap=e.statusMap,Iu.update(this)}async destroy(){await Iu.destroy(this),this.props.statusMap.clear()}calcCurrentStatus(){const e={progress:50,error:20,warning:10,ready:0},t=Array.from(this.props.statusMap.values());if(0===t.length)return"ready";const[r]=t.sort((t,r)=>e[r.status]-e[t.status]);return r.status}},Du.StatusIcon=Au;var Lu={};Object.defineProperty(Lu,"__esModule",{value:!0});var Bu=void 0;Lu.ProgressBar=Bu;var Fu=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=Uu();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs());function Uu(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return Uu=function(){return e},e}function Vu(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return Vu=function(){return e},e}Bu=class{constructor(e){this.props=e,Fu.initialize(this)}render(){const e=this.aveProgress();return isNaN(e)?Fu.dom("progress",{style:{display:"none"}}):0===e?Fu.dom("progress",null):Fu.dom("progress",{value:e.toString(),max:"1"})}async update(e){return this.props.progress!==e.progress?(this.props.progress=e.progress,Fu.update(this)):Promise.resolve()}async destroy(){await Fu.destroy(this)}aveProgress(){return this.props.progress.reduce((e,t)=>e+t,0)/this.props.progress.length}},Lu.ProgressBar=Bu;xu=class{constructor(){this.statusMap=new Map,this.awaiters=new Map,this.emitter=new Tu.Emitter}getAwaiter(e){let t=this.awaiters.get(e);void 0===t&&(t=new Set,this.awaiters.set(e,t));const r=t;return async t=>{let i;try{i=Promise.resolve().then(t),r.add(i),this.updateStatus(e,{status:"progress",detail:""});const n=await i;return r.delete(i),0===r.size&&this.updateStatus(e,{status:"ready",detail:""}),n}catch(t){return i&&r.delete(i),this.updateStatus(e,{status:"warning",detail:""+t}),void console.warn(t)}}}forceBackendStatus(e,t){this.updateStatus(e,t)}onDidUpdate(e){return this.emitter.on("did-update",e)}renderStatusIcon(){return Cu.dom(Du.StatusIcon,{statusMap:this.statusMap})}renderProgressBar(){const e=Array.from(this.statusMap.values()).reduce((e,t)=>("progress"===t.status&&void 0!==t.progress&&e.push(t.progress),e),[]);return Cu.dom(Lu.ProgressBar,{progress:e})}updateStatus(e,t){this.statusMap.set(e,t),this.emitter.emit("did-update",{pluginName:e,status:t})}},Su.BackendStatusController=xu;var zu={};Object.defineProperty(zu,"__esModule",{value:!0});var Wu=void 0;zu.ActionRegistry=Wu;var $u=c,qu={};Object.defineProperty(qu,"__esModule",{value:!0});var Hu=async function(e){let t;const r=document.activeElement;try{return await new Promise(r=>{const i=new Gu.default({items:e,infoMessage:"Actions",itemsClassList:["ide-haskell","mark-active"],elementForItem:e=>{const t=document.createElement("li");return t.innerText=e.title,t},filterKeyForItem:e=>e.title,didCancelSelection:()=>{r(void 0)},didConfirmSelection:e=>{r(e)}});i.element.classList.add("ide-haskell"),t=atom.workspace.addModalPanel({item:i,visible:!0}),i.focus()})}finally{var i;null===(i=t)||void 0===i||i.destroy(),null==r||r.focus()}};qu.selectAction=Hu;var Gu=function(e){return e&&e.__esModule?e:{default:e}}(js);class Qu extends aa.PriorityRegistry{constructor(e){super(),this.pluginManager=e,this.disposables=new $u.CompositeDisposable,this.disposables.add(atom.commands.add("atom-text-editor.ide-haskell",{"ide-haskell:show-actions":async({currentTarget:e})=>{const t=e.getModel(),r=await this.pluginManager.actionRegistry.getActions(t,"context",t.getSelectedBufferRange());if(r&&r.length){const e=await(0,qu.selectAction)(r);e&&await e.apply()}}}))}dispose(){super.dispose(),this.disposables.dispose()}async getActions(e,t,r){for(const{pluginName:i,handler:n,eventTypes:o}of this.providers){if(!o.includes(t))continue;const s=this.pluginManager.getAwaiter(i),a=await s(()=>n(e,r,t));if(void 0!==a&&a.length)return a}}}Wu=Qu,zu.ActionRegistry=Wu;var Ku={};Object.defineProperty(Ku,"__esModule",{value:!0});var Yu=void 0;Ku.TooltipManager=Yu;var Xu=c,Zu={};Object.defineProperty(Zu,"__esModule",{value:!0});var Ju=void 0;Zu.TooltipMessage=Ju;var ep=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=tp();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs());function tp(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return tp=function(){return e},e}Ju=class{constructor(e,t,r){this.source=e,this.tooltipClick=e=>{if(!e.target)return;const t=e.target;if(t.matches("a")){const e=t.href;e&&(0,E.handlePromise)(atom.workspace.open("ide-haskell://hoogle/web/"+e,{searchAllPanes:!0,split:"right",activateItem:!0}))}},Array.isArray(t)?this.message=t.map(e=>ep.dom("div",{key:e,innerHTML:e.toHtml()})):this.message=[ep.dom("div",{key:t,innerHTML:t.toHtml()})],r&&(0,E.handlePromise)(r.then(async e=>(this.actions=e,this.update()))),ep.initialize(this)}render(){var e;return ep.dom("ide-haskell-tooltip-with-actions",null,this.renderTooltip(),null!==(e=this.actions)&&void 0!==e?e:null)}async update(){return ep.update(this)}writeAfterUpdate(){this.element.parentElement&&this.element.parentElement.classList.add("ide-haskell")}renderTooltip(){return this.message.length?ep.dom("ide-haskell-tooltip",{on:{click:this.tooltipClick},dataset:{source:this.source}},this.message):null}},Zu.TooltipMessage=Ju;var rp={};Object.defineProperty(rp,"__esModule",{value:!0});var ip=async function(e,t){if(!t)return;if(!t.length)return;return np.dom("ide-haskell-tooltip-actions",null,t.slice(0,4).map(e=>np.dom("button",{className:"btn btn-xs",on:{click:()=>(0,E.handlePromise)(e.apply())}},e.title)),t.length>4?np.dom("button",{className:"btn btn-xs",on:{click:sp(e)}},"…"):null)};rp.renderActions=ip;var np=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=op();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs());function op(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return op=function(){return e},e}function sp(e){return function(){atom.commands.dispatch(atom.views.getView(e),"ide-haskell:show-actions")}}Yu=class{constructor(e){this.pluginManager=e}async showTooltip(e,t,r){const i=this.pluginManager.controller(e);if(!i)return;let n,o;if(r&&"function"!=typeof r.tooltip)o=r.tooltip,n=r.pluginName;else{const s=i.getEventRange(t);if(!s)return;if(r&&"function"==typeof r.tooltip){n=r.pluginName;const e=this.pluginManager.getAwaiter(n),t=r.tooltip,i=await e(()=>t(s.crange));if(void 0===i)return;o=i}else{const r=await this.pluginManager.tooltipRegistry.defaultTooltipFunction(e,t,s.crange);if(!r)return void i.tooltips.hide(t,void 0,{persistent:!1});({pluginName:n,tooltipData:o}=r)}const a=i.getEventRange(t);if(!a||!s.crange.isEqual(a.crange))return}const{persistent:s=!1}=o;let a;a=Array.isArray(o.text)?o.text.map(E.MessageObject.fromObject):E.MessageObject.fromObject(o.text),i.tooltips.show(Xu.Range.fromObject(o.range),t,n,{persistent:s},new Zu.TooltipMessage(n,a,(0,rp.renderActions)(e,await this.pluginManager.actionRegistry.getActions(e,t,Xu.Range.fromObject(o.range)))))}hideTooltip(e,t,r){const i=this.pluginManager.controller(e);i&&i.tooltips.hide(t,r)}},Ku.TooltipManager=Yu;b=class{constructor(e,t){this.outputPanel=t,this.disposables=new w.CompositeDisposable,this.emitter=new w.Emitter,this.willSaveHandlers=new Set,this.controllers=new Map,this.backendStatusController=new Su.BackendStatusController,this.onWillSaveBuffer=e=>(this.willSaveHandlers.add(e),new w.Disposable(()=>this.willSaveHandlers.delete(e))),this.onDidSaveBuffer=e=>this.emitter.on("did-save-buffer",e),this.onDidStopChanging=e=>this.emitter.on("did-stop-changing",e),this.disposables.add(this.emitter),this.resultsDB=new _.ResultsDB,this.outputPanel.connectResults(this.resultsDB),this.outputPanel.connectBsc(this.backendStatusController),this.actionRegistry=new zu.ActionRegistry(this),this.tooltipRegistry=new oa.TooltipRegistry(this),this.tooltipManager=new Ku.TooltipManager(this),this.configParamManager=new ko.ConfigParamManager(this.outputPanel,e.configParams),this.disposables.add(this.addEditorController(Ks.EditorControl),this.addEditorController(_a.PrettifyEditorController),this.addEditorController(ju.EditorMarkControl),this.tooltipRegistry,this.actionRegistry),"builtin"===atom.config.get("ide-haskell.messageDisplayFrontend")&&(this.checkResultsProvider=new pa.CheckResultsProvider(this)),this.subscribeEditorController()}deactivate(){this.resultsDB.destroy(),this.disposables.dispose(),this.checkResultsProvider&&this.checkResultsProvider.destroy(),(0,E.handlePromise)(this.outputPanel.reallyDestroy()),this.configParamManager.destroy(),this.removeStatusBar(),this.linterSupport&&(this.linterSupport.destroy(),this.linterSupport=void 0)}serialize(){return{configParams:this.configParamManager.serialize()}}async willSaveBuffer(e){return Promise.all(Array.from(this.willSaveHandlers.values()).map(t=>t(e)))}didSaveBuffer(e){return this.emitter.emit("did-save-buffer",e)}didStopChanging(e){return this.emitter.emit("did-stop-changing",e)}togglePanel(){(0,E.handlePromise)(atom.workspace.toggle(this.outputPanel))}controller(e){return this.controllerType(Ks.EditorControl,e)}controllerType(e,t){const r=this.controllers.get(e),i=null==r?void 0:r.get(t);return null==i?void 0:i.controller}setLinter(e){"linter"===atom.config.get("ide-haskell.messageDisplayFrontend")&&(this.linterSupport=new ra.LinterSupport(e,this.resultsDB))}nextError(){"builtin"===atom.config.get("ide-haskell.messageDisplayFrontend")&&this.outputPanel.showNextError()}prevError(){"builtin"===atom.config.get("ide-haskell.messageDisplayFrontend")&&this.outputPanel.showPrevError()}forceBackendStatus(e,t){this.backendStatusController.forceBackendStatus(e,t)}getAwaiter(e){return this.backendStatusController.getAwaiter(e)}addEditorController(e){if(this.controllers.has(e))throw new Error("Duplicate controller factory "+e.toString());const t=new WeakMap;return this.controllers.set(e,t),new w.Disposable(()=>{this.controllers.delete(e);for(const e of atom.workspace.getTextEditors()){const r=t.get(e);r&&r.disposable.dispose()}})}setStatusBar(e){this.statusBarView=new ga.StatusBarView(this.outputPanel,this.backendStatusController),this.statusBarTile=e.addRightTile({item:this.statusBarView.element,priority:100})}removeStatusBar(){this.statusBarTile&&(this.statusBarTile.destroy(),this.statusBarTile=void 0),this.statusBarView&&(this.statusBarView.destroy(),this.statusBarView=void 0)}controllerOnGrammar(e,t){for(const[r,i]of this.controllers.entries()){const n=i.get(e);if(!n&&r.supportsGrammar(t.scopeName)){const t=new r(e,this),n=new w.CompositeDisposable;n.add(new w.Disposable(()=>{i.delete(e),t.destroy()}),e.onDidDestroy(()=>n.dispose())),i.set(e,{controller:t,disposable:n})}else n&&!r.supportsGrammar(t.scopeName)&&n.disposable.dispose()}}subscribeEditorController(){this.disposables.add(atom.workspace.observeTextEditors(e=>{const t=new w.CompositeDisposable;t.add(e.onDidChangeGrammar(t=>{this.controllerOnGrammar(e,t)}),e.onDidDestroy(()=>{t.dispose(),this.disposables.remove(t)})),this.disposables.add(t),this.controllerOnGrammar(e,e.getGrammar())}))}},y.PluginManager=b;var ap={};Object.defineProperty(ap,"__esModule",{value:!0});var lp={};Object.defineProperty(lp,"__esModule",{value:!0});var cp=function(e,t,r){const i=t.name,n=new fp,o=e.resultsDB.registerProvider(void 0!==t.messageTypes?Object.keys(t.messageTypes):[]);return n.add(o),n.add((0,up.consume)(e,t,r)),{setMenu(e,t){const r=atom.menu.add([{label:E.MAIN_MENU_LABEL,submenu:[{label:e,submenu:t}]}]);return n.add(r),r},setStatus:t=>e.forceBackendStatus(i,t),setMessages(e){o.setMessages(e)},addMessageTab:async(t,r)=>e.outputPanel.createTab(t,r),showTooltip:async({editor:t,eventType:r,detail:n,tooltip:o})=>(void 0===r&&(r=(0,E.getEventType)(n)),e.tooltipManager.showTooltip(t,r,{pluginName:i,tooltip:o})),addPanelControl:t=>e.outputPanel.addPanelControl(t),addConfigParam:(t,r)=>e.configParamManager.add(i,t,r),getConfigParam:async t=>e.configParamManager.get(i,t),getOthersConfigParam:async(t,r)=>e.configParamManager.get(t,r),setConfigParam:async(t,r)=>e.configParamManager.set(i,t,r),getEventRange(t,r){let i;i=(0,E.isTEventRangeType)(r)?r:(0,E.getEventType)(r);const n=e.controller(t);if(n)return n.getEventRange(i)},dispose(){n.dispose()}}};lp.instance=cp;var up={};Object.defineProperty(up,"__esModule",{value:!0});var pp=function(e,t,r){const{name:i,menu:n,messageTypes:o,events:s,controls:a,params:l,tooltip:c,commands:u,actions:p}=t,h=new hp.CompositeDisposable;let d;function f(e,t){if(Array.isArray(e)){const r=new hp.CompositeDisposable;for(const i of e)r.add(t(m(i)));return r}return t(m(e))}const v=e.getAwaiter(i);function m(e){return function(...t){(0,E.handlePromise)(v(()=>e(...t)).then(async e=>{if(d&&void 0!==e)if(Array.isArray(e))d.setMessages(e);else{const t=[];for await(const r of e)t.push(r),d.setMessages(t)}}))}}if(n){const e=atom.menu.add([{label:E.MAIN_MENU_LABEL,submenu:[{label:n.label,submenu:n.menu}]}]);h.add(e)}if(o){r.eventsReturnResults&&(d=e.resultsDB.registerProvider(Object.keys(o)));for(const t of Object.keys(o)){const r=o[t];(0,E.handlePromise)(e.outputPanel.createTab(t,r)),h.add(new hp.Disposable((function(){(0,E.handlePromise)(e.outputPanel.removeTab(t))})))}}s&&(s.onWillSaveBuffer&&h.add(f(s.onWillSaveBuffer,e.onWillSaveBuffer)),s.onDidSaveBuffer&&h.add(f(s.onDidSaveBuffer,e.onDidSaveBuffer)),s.onDidStopChanging&&h.add(f(s.onDidStopChanging,e.onDidStopChanging)));if(c){var g;let t,r,n;"function"==typeof c?t=c:({handler:t,priority:r,eventTypes:n}=c),h.add(e.tooltipRegistry.register(i,{priority:null!==(g=r)&&void 0!==g?g:100,handler:t,eventTypes:n}))}if(a)for(const t of a)h.add(e.outputPanel.addPanelControl(t));if(l)for(const t of Object.keys(l)){const r=l[t];h.add(e.configParamManager.add(i,t,r))}if(r.supportsCommands&&u)for(const[e,t]of Object.entries(u))if(void 0!==t)for(const[r,i]of Object.entries(t))h.add(atom.commands.add(e,r,(function(e){m(i)(e.currentTarget)})));if(r.supportsActions&&p){var y;let t,r,n;"function"==typeof p?t=p:({handler:t,priority:r,eventTypes:n}=p),h.add(e.actionRegistry.register(i,{priority:null!==(y=r)&&void 0!==y?y:100,handler:async function(e,r,i){const n=await Promise.resolve(t(e,r,i));if(n&&n.length)return n},eventTypes:n}))}return h};up.consume=pp;var hp=c;function dp(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return dp=function(){return e},e}var fp=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=dp();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(c).CompositeDisposable;Object.keys(lp).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in ap&&ap[e]===lp[e]||Object.defineProperty(ap,e,{enumerable:!0,get:function(){return lp[e]}}))})),Object.keys(up).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in ap&&ap[e]===up[e]||Object.defineProperty(ap,e,{enumerable:!0,get:function(){return up[e]}}))}));var vp=Hp(ap),mp={};Object.defineProperty(mp,"__esModule",{value:!0});var gp=void 0;mp.OutputPanel=gp;var yp=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=Vp();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs()),bp=c,wp={};Object.defineProperty(wp,"__esModule",{value:!0});var _p=void 0;wp.OutputPanelButtons=_p;var Op={};Object.defineProperty(Op,"__esModule",{value:!0});var kp=void 0;Op.Button=kp;var Pp=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=Mp();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs());function Mp(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return Mp=function(){return e},e}kp=class{constructor(e){this.props=e,Pp.initialize(this)}render(){return Pp.dom("ide-haskell-button",{class:this.props.active?"active":"",dataset:{caption:this.props.name,count:this.props.count},on:{click:this.props.onClick}})}async update(e){return this.props=e,Pp.update(this)}async destroy(){await Pp.destroy(this)}},Op.Button=kp;var jp=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=Ep();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs());function Ep(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return Ep=function(){return e},e}_p=class{constructor(e){this.props=e,jp.initialize(this)}render(){return jp.dom("ide-haskell-panel-buttons",null,this.renderButtons())}async update(e){return this.props=e,jp.update(this)}renderButtons(){return this.props.buttons.map(e=>jp.dom(Op.Button,{active:e.name===this.props.activeBtn,name:e.name,count:e.count,onClick:e.onClick}))}},wp.OutputPanelButtons=_p;var Sp={};Object.defineProperty(Sp,"__esModule",{value:!0});var xp=void 0;Sp.OutputPanelCheckbox=xp;var Cp=c,Tp=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=Dp();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs());function Dp(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return Dp=function(){return e},e}xp=class{constructor(e){this.props=e,this.tooltipTitle=()=>this.props.state?this.props.enabledHint:this.props.disabledHint,this.disposables=new Cp.CompositeDisposable,Tp.initialize(this),this.disposables.add(atom.tooltips.add(this.element,{title:this.tooltipTitle}))}render(){return Tp.dom("ide-haskell-checkbox",{class:`${this.props.class}${this.props.state?" enabled":""}`,on:{click:this.props.onSwitched}})}async update(e={}){return this.props={...this.props,...e},Tp.update(this)}async destroy(){await Tp.destroy(this),this.disposables.dispose()}},Sp.OutputPanelCheckbox=xp;var Ap={};Object.defineProperty(Ap,"__esModule",{value:!0});var Ip=void 0;Ap.OutputPanelItems=Ip;var Rp=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=Up();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs()),Np={};Object.defineProperty(Np,"__esModule",{value:!0});var Lp=void 0;Np.OutputPanelItem=Lp;var Bp=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=Fp();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(bs());function Fp(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return Fp=function(){return e},e}function Up(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return Up=function(){return e},e}Lp=class{constructor(e){this.props=e,this.clickPosition=()=>{void 0!==this.props.model.uri&&(0,E.handlePromise)(atom.workspace.open(this.props.model.uri,{searchAllPanes:!0,initialLine:this.props.model.position&&this.props.model.position.row,initialColumn:this.props.model.position&&this.props.model.position.column}))},Bp.initialize(this)}render(){return Bp.dom("ide-haskell-panel-item",{key:this.props.model.hash()},this.renderPosition(),this.renderContext(),Bp.dom("ide-haskell-item-description",{innerHTML:this.props.model.message.toHtml()}))}async update(e){return this.props.model=e.model,Bp.update(this)}async destroy(){await Bp.destroy(this)}renderPosition(){if(void 0!==this.props.model.uri){const e=this.props.model.position?`${this.props.model.uri}: ${this.props.model.position.row+1}, ${this.props.model.position.column+1}`:this.props.model.uri;return Bp.dom("ide-haskell-item-position",{on:{click:this.clickPosition}},e)}return""}renderContext(){return void 0!==this.props.model.context?Bp.dom("ide-haskell-item-context",null,this.props.model.context):""}},Np.OutputPanelItem=Lp;function Vp(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return Vp=function(){return e},e}Ip=class{constructor(e){this.props=e,this.itemMap=new WeakMap,Rp.initialize(this)}render(){return Rp.dom("ide-haskell-panel-items",{class:"native-key-bindings",tabIndex:"-1"},this.renderItems())}async update(e){return this.props=e,Rp.update(this)}async destroy(){await Rp.destroy(this)}async showItem(e){await Rp.update(this);const t=this.itemMap.get(e);t&&(t.component.clickPosition(),t.domNode.scrollIntoView({block:"start",behavior:"smooth"}))}async scrollToEnd(){await Rp.update(this),this.element.scrollTop=this.element.scrollHeight}atEnd(){return this.element.scrollTop>=this.element.scrollHeight-this.element.clientHeight}renderItems(){return(this.props.filter?this.props.model.filter(this.props.filter):this.props.model.results()).map(e=>{const t=Rp.dom(Np.OutputPanelItem,{model:e});return this.itemMap.set(e,t),t})}},Ap.OutputPanelItems=Ip;class zp{constructor(e={fileFilter:!1,activeTab:"error"}){if(this.state=e,this.elements=new Set,this.disposables=new bp.CompositeDisposable,this.tabs=new Map,this.tabUsers=new Map,this.currentResult=0,this.switchFileFilter=()=>{this.state.fileFilter=!this.state.fileFilter,(0,E.handlePromise)(this.updateItems())},this.setButtonsClass(atom.config.get("ide-haskell.buttonsPosition")),yp.initialize(this),atom.config.onDidChange("ide-haskell.buttonsPosition",({newValue:e})=>{this.setButtonsClass(e),(0,E.handlePromise)(this.update())}),"builtin"===atom.config.get("ide-haskell.messageDisplayFrontend"))for(const e of zp.defaultTabs)this.tabs.set(e,{name:e,count:0,onClick:()=>this.activateTab(e),uriFilter:!0,autoScroll:!1});(0,E.handlePromise)(this.update()),this.disposables.add(atom.workspace.onDidChangeActivePaneItem(()=>{this.state.fileFilter&&(0,E.handlePromise)(this.updateItems())})),setImmediate(async()=>{await this.show(),atom.config.get("ide-haskell.autoHideOutput")&&this.hide()})}connectBsc(e){if(this.bsc)throw new Error("BackendStatusController already connected!");this.bsc=e,this.disposables.add(this.bsc.onDidUpdate(()=>(0,E.handlePromise)(this.update()))),(0,E.handlePromise)(this.update())}connectResults(e){if(this.results)throw new Error("Results already connected!");this.results=e;let t=Date.now(),r=new Set;this.disposables.add(this.results.onDidUpdate(e=>{this.currentResult=0,(0,E.handlePromise)(this.updateItems());const i=Date.now();if(i-t<atom.config.get("ide-haskell.switchTabOnCheckInterval"))for(const t of e)r.add(t);else r=new Set(e);!atom.config.get("ide-haskell.autoHideOutput")||this.results&&!this.results.isEmpty(e)?atom.config.get("ide-haskell.switchTabOnCheck")&&this.activateFirstNonEmptyTab(r):this.hide(),t=i})),(0,E.handlePromise)(this.update())}render(){var e,t;return this.results?yp.dom("ide-haskell-panel",{class:this.buttonsClass},yp.dom("ide-haskell-panel-heading",null,(null===(e=this.bsc)||void 0===e?void 0:e.renderStatusIcon())||null,yp.dom(wp.OutputPanelButtons,{buttons:Array.from(this.tabs.values()),activeBtn:this.state.activeTab}),yp.dom(Sp.OutputPanelCheckbox,{class:"ide-haskell-checkbox--uri-filter",state:this.state.fileFilter||!1,onSwitched:this.switchFileFilter,enabledHint:"Show current file messages",disabledHint:"Show all project messages"}),Array.from(this.elements.values()),(null===(t=this.bsc)||void 0===t?void 0:t.renderProgressBar())||null),yp.dom(Ap.OutputPanelItems,{model:this.results,filter:this.itemFilter,ref:"items"})):yp.dom("ide-haskell-panel",null)}async update(){return yp.update(this)}destroy(){this.hide()}async reallyDestroy(){await yp.destroy(this),this.disposables.dispose()}async toggle(){const e=atom.workspace.paneContainerForItem(this);return!e||(0,E.isDock)(e)&&!e.isVisible()?this.show():this.hide()}async show(){await atom.workspace.open(this,{searchAllPanes:!0,activatePane:!1});const e=atom.workspace.paneContainerForItem(this);e&&(0,E.isDock)(e)&&e.show()}hide(){const e=atom.workspace.paneContainerForItem(this);e&&(0,E.isDock)(e)&&atom.workspace.hide(this)}getTitle(){return"IDE-Haskell"}getURI(){return"ide-haskell://output-panel/"}getDefaultLocation(){return atom.config.get("ide-haskell.panelPosition")}addPanelControl(e){let t;if((0,E.isSimpleControlDef)(e)){const{events:r,classes:i,style:n,attrs:o}=e.opts,s={};i&&(s.class=i.join(" ")),n&&(s.style=n),o&&(s.attributes=o),r&&(s.on=r),t=yp.dom(e.element,s)}else t=yp.dom(e.element,e.opts);return this.elements.add(t),(0,E.handlePromise)(this.update()),new bp.Disposable(()=>{this.elements.delete(t),(0,E.handlePromise)(this.update())})}async updateItems(){const e=this.getActiveTab();let t;if(this.state.fileFilter){const e=atom.workspace.getActiveTextEditor();t=e?e.getPath():void 0}let r=!1;if(e){const i=this.tabs.get(e);void 0!==t&&i&&i.uriFilter?this.itemFilter=({uri:r,severity:i})=>i===e&&r===t:this.itemFilter=({severity:t})=>t===e,r=i&&i.autoScroll&&this.refs.items&&this.refs.items.atEnd()||!1}if(this.results)for(const[e,t]of this.tabs.entries())t.count=this.results.filter(({severity:t})=>t===e).length;await this.update(),r&&this.refs.items&&await this.refs.items.scrollToEnd()}activateTab(e){this.state.activeTab=e,(0,E.handlePromise)(this.updateItems())}activateFirstNonEmptyTab(e){for(const t of this.tabs.values()){if(!e.has(t.name))continue;const r=t.count;if(r&&r>0){(0,E.handlePromise)(this.show()),this.activateTab(t.name);break}}}showItem(e){this.activateTab(e.severity),this.refs.items&&(0,E.handlePromise)(this.refs.items.showItem(e))}getActiveTab(){return this.state.activeTab}async createTab(e,{uriFilter:t=!0,autoScroll:r=!1}){if(!zp.defaultTabs.includes(e))return this.tabs.has(e)?this.tabUsers.set(e,this.tabUsers.get(e)+1):(this.tabUsers.set(e,1),this.tabs.set(e,{name:e,count:0,onClick:()=>this.activateTab(e),uriFilter:t,autoScroll:r}),this.state.activeTab&&this.activateTab(this.state.activeTab)),this.update()}async removeTab(e){if(!zp.defaultTabs.includes(e)){if(!this.tabUsers.has(e))throw new Error("Ide-Haskell: Removing nonexistent output panel tab "+e);{let t=this.tabUsers.get(e);if(t-=1,0===t)return this.tabUsers.delete(e),this.tabs.delete(e),this.state.activeTab===e&&(this.state.activeTab=zp.defaultTabs[0]),this.update();this.tabUsers.set(e,t)}}}serialize(){return{...this.state,deserializer:"ide-haskell/OutputPanel"}}showNextError(){if(!this.results)return;const e=this.results.filter(({uri:e})=>void 0!==e);0!==e.length&&(this.currentResult++,this.currentResult>=e.length&&(this.currentResult=0),this.showItem(e[this.currentResult]))}showPrevError(){if(!this.results)return;const e=this.results.filter(({uri:e})=>void 0!==e);0!==e.length&&(this.currentResult--,this.currentResult<0&&(this.currentResult=e.length-1),this.showItem(e[this.currentResult]))}setButtonsClass(e){switch(e){case"top":this.buttonsClass="buttons-top";break;case"left":this.buttonsClass="buttons-left"}}}gp=zp,mp.OutputPanel=gp,zp.defaultTabs=["error","warning","lint"];var Wp=Hp(mp),$p=Hp(c);function qp(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return qp=function(){return e},e}function Hp(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=qp();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}var Gp=$p.CompositeDisposable,Qp=$p.Disposable;let Kp,Yp,Xp,Zp,Jp=!1;function eh(e){return Xp||(Xp=new Wp.OutputPanel(e)),Xp}function th(e={}){return function(){return Jp=!0,t=>{if(!Yp)throw new Error("IDE-Haskell failed to provide UPI instance: pluginManager is undefined");return vp.instance(Yp,t,e)}}}var rh=th();exports.provideUpi3_0=rh;var ih=th({eventsReturnResults:!0});exports.provideUpi3_1=ih;var nh=th({eventsReturnResults:!0,supportsCommands:!0});exports.provideUpi3_2=nh;var oh=th({eventsReturnResults:!0,supportsCommands:!0,supportsActions:!0});function sh(e={}){return function(t){if(Jp=!0,Yp)return vp.consume(Yp,t,e)}}exports.provideUpi3_3=oh;var ah=sh({});exports.consumeUpi3_0=ah;var lh=sh({eventsReturnResults:!0});exports.consumeUpi3_1=lh;g=sh({eventsReturnResults:!0,supportsCommands:!0}),exports.consumeUpi3_2=g;
//# sourceMappingURL=main.js.map
